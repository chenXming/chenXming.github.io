<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>chenXming的个人技术网站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="我的个人技术博客，如果有需要可以通过13716873821@163.com联系我">
<meta property="og:type" content="website">
<meta property="og:title" content="chenXming的个人技术网站">
<meta property="og:url" content="https://chenxming.github.io/page/2/index.html">
<meta property="og:site_name" content="chenXming的个人技术网站">
<meta property="og:description" content="我的个人技术博客，如果有需要可以通过13716873821@163.com联系我">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chenXming">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="chenXming的个人技术网站" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">chenXming的个人技术网站</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">技术博客</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://chenxming.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-iOS中的Flex布局-FlexLib的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/03/08/iOS%E4%B8%AD%E7%9A%84Flex%E5%B8%83%E5%B1%80-FlexLib%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2022-03-08T12:46:25.000Z" itemprop="datePublished">2022-03-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/03/08/iOS%E4%B8%AD%E7%9A%84Flex%E5%B8%83%E5%B1%80-FlexLib%E7%9A%84%E4%BD%BF%E7%94%A8/">iOS-中的Flex布局-FlexLib的使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一-概述"><a href="#一-概述" class="headerlink" title="一. 概述"></a>一. 概述</h3><p>   进行iOS项目开发时，常用的布局方式有两种：<code>Frame</code>布局和<code>AutoLayout</code>，<code>Frame</code>布局没啥可说的，直接设置控件的横纵坐标，并指定宽高。<code>AutoLayout</code>是通过设置控件相对位置的约束进行布局。<code>AutoLayout</code>的本意是好的，但是由于他的语法实在不怎么友好，导致我们在实际项目开发中用的并不多，只能靠<code>Masonry</code>这样的第三方库来使用它。<code>Masonry</code>布局虽然容易理解，但是它的代码量太大，每一个控件都要对其进行block设置。<br>   在前端开发中，Flex布局使用尤为普遍，那么iOS端有没有类似前端Flex布局的方案呢？答案是肯定的，除了在 <code>Weex</code> 以及 <code>React Native</code> 两个著名的跨平台项目里有用到 Flex布局外，<code>AsyncDisplayKit</code> 也同样引入了 Flex布局，它们都是基于 <code>Facebook</code> 的 <code>Yoga</code> 的二次开发。而今天我们要介绍的 <a target="_blank" rel="noopener" href="https://github.com/zhenglibao/FlexLib">FlexLib</a> 同样如此。</p>
<h3 id="二-Flex布局与相关属性介绍"><a href="#二-Flex布局与相关属性介绍" class="headerlink" title="二. Flex布局与相关属性介绍"></a>二. Flex布局与相关属性介绍</h3><p>先来了解一下Flex布局：<br>Flex布局又叫弹性布局,是一种为一维布局而设计的布局方法。一维的意思是你希望内容是按行或者列来布局。你可以使用<code>display:flex</code>来将元素变为弹性布局。我们直接看例子：<br>实现7个item横向排列<br><img src="https://i.loli.net/2021/07/19/lxgMDecCXfFQ9rY.gif" alt="图片"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>flex布局2<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>:  <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: flex-start;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: flex-end;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: wheat;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">border</span>: <span class="number">1px</span> solid royalblue;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item6</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item7</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">flex</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item0 item&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item1 item&quot;</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item2 item&quot;</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item3 item&quot;</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item4 item&quot;</span>&gt;</span>item4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item5 item&quot;</span>&gt;</span>item5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item6 item&quot;</span>&gt;</span>item6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item7 item&quot;</span>&gt;</span>item7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面是前端代码，看不懂没关系，这里重点是借这个例子来熟悉一下Flex布局的一些常用属性。Flex属性分类两类：一类是作用在容器上的，另一类是作用在子Item上的。</p>
<ol>
<li>作用在容器上的属性</li>
</ol>
<ul>
<li><p><code>display:flex</code>: 设置<code>container</code>容器为弹性布局</p>
</li>
<li><p><code>flex-direction</code>:决定主轴的方向,项目横向或是纵向排列<br>取值：row | row-reverse | column | column-reverse;<br><code>row</code>（默认值）：主轴为水平方向，起点在左端。<br><code>row-reverse</code>：主轴为水平方向，起点在右端。<br><code>column</code>：主轴为垂直方向，起点在上沿。<br><code>column-reverse</code>：主轴为垂直方向，起点在下沿。</p>
</li>
<li><p><code>justify-content</code>: 定义Item在主轴上如何对齐。<br>取值：flex-start | flex-end | center | space-between | space-around;<br><code>flex-start</code>（默认值）：左对齐<br><code>flex-end</code>：右对齐<br><code>center</code>： 居中<br><code>space-between</code>：两端对齐，项目之间的间隔都相等。<br><code>space-around</code>：每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍。</p>
</li>
<li><p><code>align-items</code>:定义Item在交叉轴上如何对齐。<br>取值：align-items: flex-start | flex-end | center;<br><code>flex-start</code>：交叉轴的起点对齐。<br><code>flex-end</code>：交叉轴的终点对齐。<br><code>center</code>：交叉轴的中间点对齐。</p>
</li>
<li><p><code>flex-wrap</code>:一条轴线上放不下，决定其是否换行<br>取值: nowrap(不换行) | wrap(换行)</p>
</li>
<li><p><code>align-content</code>:也是控制Flex Item 在交叉轴上的对齐方式，只不过是以一整行作为最小单位。注意，如果Flex Item只有一行，该属性不起作用的。调整 <code>flex-wrap</code> 为 Wrap,效果才显示出来。<br>取值：flex-start | flex-end | center | space-between | space-around;</p>
</li>
</ul>
<ol start="2">
<li>作用在Item上的属性</li>
</ol>
<ul>
<li><p><code>align-self</code>:可以让单个 Flex Item 与其它 Flex Item 有不一样的对齐方式，覆盖 <code>align-items</code>属性。默认值为auto，表示继承Flex容器的<code>align-items</code>属性。</p>
</li>
<li><p><code>flex</code> 属性：flex属性是<code>flex-grow</code>, <code>flex-shrink</code> 和 <code>flex-basis</code>的简写，默认值为<code>0 1 auto</code>。<br><code>flex-grow</code>: 属性定义项目的放大比例，默认为0，即如果存在剩余空间也不放大。 取值越大，占用剩余空间越大。<br><code>flex-shrink</code>: 属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。<br><code>flex-basis</code>:属性指定了flex元素在主轴方向上的初始大小</p>
</li>
</ul>
<p>这里设置<code>item6</code> 与 <code>item7</code> 的flex为1和2，表示当前轴剩余的空间item6占1&#x2F;3,item7占2&#x2F;3.<br>更多的关于flex的属性可以查看这里：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex布局</a></p>
<h3 id="三-FlexLib的使用"><a href="#三-FlexLib的使用" class="headerlink" title="三. FlexLib的使用"></a>三. FlexLib的使用</h3><h4 id="1-使用方式"><a href="#1-使用方式" class="headerlink" title="1.使用方式"></a>1.使用方式</h4><p><code>CocoaPods</code>引入FlexLib:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;FlexLib&#x27;</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<ul>
<li>创建视图控制器继承<code>FlexBaseVC</code>,或者创建视图继承<code>FlexCustomBaseView</code></li>
<li>创建与视图控制器或视图同名的xml文件</li>
<li>在xml文件中添加控件进行布局<br>例子：</li>
</ul>
<p><img src="https://s2.loli.net/2022/03/08/uPgNjW2eUJYDRor.gif" alt="pic"></p>
<p>TestLoginVC.h</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@interface TestLoginVC : FlexBaseVC</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>TestLoginVC.m</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;TestLoginVC.h&quot;</span><br><span class="line"></span><br><span class="line">@interface TestLoginVC ()</span><br><span class="line">&#123;</span><br><span class="line">    UIScrollView* scroll;//自动绑定name属性的值</span><br><span class="line">    UIView* close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation TestLoginVC</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    self.navigationItem.title = @&quot;Touch Demo&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tapTouchAction</span><br><span class="line">&#123;</span><br><span class="line">    UIAlertView *alert = [[UIAlertView alloc] initWithTitle:@&quot;&quot;</span><br><span class="line">                                                    message:@&quot;You pressed&quot;</span><br><span class="line">                                                   delegate:nil</span><br><span class="line">                                          cancelButtonTitle:@&quot;Cancel&quot;</span><br><span class="line">                                          otherButtonTitles:@&quot;OK&quot;,nil];</span><br><span class="line">    </span><br><span class="line">    [alert show];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)didReceiveMemoryWarning &#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>TestLoginVC.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">UIView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">layout</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">    flex:1,</span></span></span><br><span class="line"><span class="string"><span class="tag">    alignItems:center&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">attr</span>=<span class="string">&quot;bgColor:white&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FlexScrollView</span> <span class="attr">name</span>=<span class="string">&quot;scroll&quot;</span>  <span class="attr">layout</span>=<span class="string">&quot;padding:50,flex:1,width:100%,alignItems:center&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;bgColor:white,vertScroll:true,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FlexTouchView</span> <span class="attr">onPress</span>=<span class="string">&quot;tapTouchAction&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;underlayColor:blue&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">UIImageView</span> <span class="attr">layout</span>=<span class="string">&quot;width:100,height:100&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;borderRadius:50,clipsToBounds:true,source:qrcode.png&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">FlexTouchMaskView</span> <span class="attr">attr</span>=<span class="string">&quot;bgColor:red,alpha:0.7&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">UIImageView</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">FlexTouchView</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">UIView</span> <span class="attr">layout</span>=<span class="string">&quot;height:20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FlexTouchView</span> <span class="attr">onPress</span>=<span class="string">&quot;tapTouchAction&quot;</span> <span class="attr">layout</span>=<span class="string">&quot;height:100,width:100%,alignItems:center,justifyContent:center&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;bgColor:#e5e5e5,borderRadius:8,underlayColor:darkGray&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">UILabel</span> <span class="attr">layout</span>=<span class="string">&quot;width:100%&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;fontSize:16,textAlign:center,color:red,text:Please touch me and move\,\r\n这是测试touch功能的控件,linesNum:0&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">FlexTouchView</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">UIView</span> <span class="attr">layout</span>=<span class="string">&quot;height:20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">UILabel</span> <span class="attr">layout</span>=<span class="string">&quot;width:100%&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;fontSize:20,linesNum:0,color:#333333,text:You can press the buttons above to see the effect. We use FlexTouchView to provide more powerful function and better flexibility than button.&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">FlexScrollView</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UIView</span>&gt;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><p>默认视图从上到下进行排列，在视图标签内添加其他视图，相当于为视图添加子视图</p>
</li>
<li><p><code>FlexLib</code>支持两种类型的属性：布局属性(Layout)和视图属性(attr)，布局属性与<code>yoga</code>所支持的属性一致，视图属性除了文档中所列的属性以外，还可以使用FLEXSET宏对现有属性进行扩展。你可以在这里查看它所支持的 <a target="_blank" rel="noopener" href="https://github.com/zhenglibao/FlexLib/wiki/Layout-Attributes">layout attributes</a> 和 <a target="_blank" rel="noopener" href="https://github.com/zhenglibao/FlexLib/wiki/View-Attributes">view attributes</a></p>
</li>
<li><p><code>FlexScrollView</code>(UIScrollView的子类)可以自动管理滚动范围,<code>FlexTouchView</code>类似于UIButton，内置<code>onPress</code>属性，可以设置其触发方法。</p>
</li>
<li><p>可以设置控件的<code>name</code>属性，<code>name</code>属性的值会自动绑定代码中具有相同名称的成员变量，你可以直接在代码中使用它。</p>
</li>
<li><p>你可以预定义一些属性值，将其放入全局xml文件中，在<code>AppDelegate</code>进行初始化</p>
</li>
</ul>
<p>  全局xml文件 <code>system.style</code> 的格式类似这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">styles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;buttonAttrStyle&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;bgColor&quot;</span>&gt;</span>black<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span>&gt;</span>white<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;borderRadius&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;underlayColor&quot;</span>&gt;</span>darkGray<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;shadowColor&quot;</span>&gt;</span>red<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;shadowOffset&quot;</span>&gt;</span>5/5<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;shadowOpacity&quot;</span>&gt;</span>0.2<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;shadowRadius&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;/style &gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;buttonLayoutStyle&quot;</span>&gt;</span><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;height&quot;</span>&gt;</span>44<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;width&quot;</span>&gt;</span>150<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;alignItems&quot;</span>&gt;</span>center<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;justifyContent&quot;</span>&gt;</span>center<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;margin&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-xml">    </span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">styles</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>导入系统样式文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString *path = [[NSBundle mainBundle]pathForResource:@&quot;system&quot; ofType:@&quot;style&quot;];</span><br><span class="line">[[FlexStyleMgr instance] loadClassStyle:path];</span><br></pre></td></tr></table></figure>
<p>使用:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">UILabel</span> <span class="attr">attr</span>=<span class="string">&quot;@:system/buttonAttrStyle&quot;</span> <span class="attr">layout</span>=<span class="string">&quot;@:system/buttonLayoutStyle&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>FlexLib</code>支持运行时更新界面，具体的配置方式那你可以看<a target="_blank" rel="noopener" href="https://github.com/zhenglibao/FlexLib/wiki/Hot-preview">这里</a></p>
</li>
<li><p><code>FlexLib</code>支持Cell高度自动计算，并且适配iPhone X等机型，实际开发中自定义<code>UITableViewCell</code>需要继承<code>FlexBaseTableCell</code>,自定义<code>UICollectionViewCell</code>需要继承<code>FlexCollectionCell</code>。</p>
</li>
</ul>
<h4 id="2-FlexXmlBaseView、FlexFrameView、FlexCustomBaseView-的使用"><a href="#2-FlexXmlBaseView、FlexFrameView、FlexCustomBaseView-的使用" class="headerlink" title="2.FlexXmlBaseView、FlexFrameView、FlexCustomBaseView 的使用"></a>2.FlexXmlBaseView、FlexFrameView、FlexCustomBaseView 的使用</h4><p>在使用<code>xml</code>进行布局时，不可避免的要用到自定义视图，如果自定义视图也想要用xml进行布局，此时需要继承<code>FlexXmlBaseView </code>、<code>FlexFrameView</code>、<code>FlexCustomBaseView</code>这三种视图中的一种。</p>
<h5 id="1-自定义视图使用xml布局"><a href="#1-自定义视图使用xml布局" class="headerlink" title="(1)自定义视图使用xml布局"></a>(1)自定义视图使用xml布局</h5><ul>
<li><p>继承<code>FlexXmlBaseView</code>的视图：能在xml文件中使用,可以通过<code>initWithRootView</code>方式创建，但不能通过<code>initWithFrame</code>创建，也不能能直接设置frame，优点是更加轻量级，不会增加额外的视图层级.</p>
</li>
<li><p>继承<code>FlexFrameView</code>的视图：可以直接设置frame，但是不能用在xml文件中。例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FlexFrameView *frameView = [[FlexFrameView alloc] initWithFlex:@&quot;CustomFrameView&quot; Frame:CGRectMake(0, 0, [UIScreen mainScreen].bounds.size.width, 0) Owner:self];</span><br><span class="line">frameView.flexibleHeight = YES;//设置高度自适应</span><br><span class="line">[_scrollView addSubview:frameView];</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>CustomFrameView.xml</code>是这个视图对应的xml布局文件</p>
</blockquote>
</li>
<li><p>继承<code>FlexCustomBaseView</code>的视图：既可以用在xml中，也可以像传统的UIView派生类那样使用<code>initWithFrame</code>创建，缺点是会额外的增加多余的视图层级.</p>
</li>
</ul>
<blockquote>
<p>注意：继承<code>FlexCustomBaseView</code>或<code>FlexFrameView</code>的视图必须要设置以下两个属性</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//宽和高是否可变？缺省值均为NO</span><br><span class="line">@property(nonatomic,assign) BOOL flexibleWidth;</span><br><span class="line">@property(nonatomic,assign) BOOL flexibleHeight;</span><br></pre></td></tr></table></figure>

<h5 id="2-自定义视图不使用xml布局，但是也想用在xml文件中"><a href="#2-自定义视图不使用xml布局，但是也想用在xml文件中" class="headerlink" title="(2)自定义视图不使用xml布局，但是也想用在xml文件中"></a>(2)自定义视图不使用xml布局，但是也想用在xml文件中</h5><p>此时我们的自定义视图需要满足以下两个条件就可以用于xml文件中：</p>
<ul>
<li>所有的初始化必须在<code>init</code>方法中完成。任何其他的<code>init</code>函数，比如<code>initWith…</code>不会被调用。</li>
<li>你可以用<code>FLEXSET</code>宏扩展视图属性，然后你可以在xml文件中设置属性。</li>
</ul>
<p>直接在父视图中使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">UIView</span> <span class="attr">layout</span>=<span class="string">&quot;flex:1,alignItems:center&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;bgColor:white&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 无xml对应的，自定义View 这么使用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ComplateCustomView</span> <span class="attr">layout</span>=<span class="string">&quot;width:100%,height:80&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UIView</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-其他设置"><a href="#3-其他设置" class="headerlink" title="3.其他设置"></a>3.其他设置</h4><ul>
<li><p>缩放因子<br>在进行页面布局时，如果想让不同尺寸的屏幕共用一套设计，随着屏幕尺寸的变化，页面控件的大小随之缩放，这时候会用到缩放因子。设置缩放因子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 设置缩放因子，使用方法 在xml 布局中 *16 ==&gt; 16*factor + 1</span><br><span class="line">float factor = [UIScreen mainScreen].bounds.size.width/375;</span><br><span class="line">FlexSetScale(factor, 1);</span><br></pre></td></tr></table></figure>
<p>在布局xml中使用,数字前面加上<code>*</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">UILabel</span> <span class="attr">attr</span>=<span class="string">&quot;fontSize: *16&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>这表示：Label的fontSize为<code>16*factor + 1</code></p>
</li>
<li><p>在属性中使用表达式<br>在布局属性和视图属性中添加表达式,属性名前要加<code>$</code>,<code>ScreenWidth</code>是系统预定义的宏，你也可以用自定义的宏。目前支持的运算符<code>+, -, *, /, (, ),</code></p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">UIView</span> <span class="attr">layout</span>=<span class="string">&quot;$width:ScreenWidth*0.6,height:50,alignItems:center,justifyContent:center&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;bgColor:#e5e5e5,borderRadius:6&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">UILabel</span> <span class="attr">attr</span>=<span class="string">&quot;@:system/buttonText,text:表达式计算，屏幕宽度的60%&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">UIView</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>FlexTextView<br>它是另外一个系统提供的类，能够自动根据输入的文字调整其高度，且保证其高度不会超出最小(minHeight)和最大高度(maxHeight)。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FlexTextView</span> <span class="attr">layout</span>=<span class="string">&quot;flex:1,minHeight:40,maxHeight:95&quot;</span> <span class="attr">attr</span>=<span class="string">&quot;borderColor:red,borderWidth:1,borderRadius:4,fontSize:18,color:darkGray,text:这是一个能自动根据字数调整高度的文本输入框,placeholder:我是占位,placeholderColor:red&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四. 总结"></a>四. 总结</h3><p><code>FlexLib</code> 可能对有前端开发经验的同学比较友好，对原生开发同学而言，学习一下他的语法也没坏处。在日常开发中，我们可以有选择的使用这个布局，熟悉了这个布局后，会极大的提升我们页面布局效率，从而让我们将精力集中到更加核心的功能上。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhenglibao/FlexLib">https://github.com/zhenglibao/FlexLib</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2022/03/08/iOS%E4%B8%AD%E7%9A%84Flex%E5%B8%83%E5%B1%80-FlexLib%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="cllniud7y0004xbexgxco2zfb" data-title="iOS-中的Flex布局-FlexLib的使用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-WebViewJavascriptBridge源码解析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/03/04/WebViewJavascriptBridge%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" class="article-date">
  <time class="dt-published" datetime="2022-03-04T12:46:25.000Z" itemprop="datePublished">2022-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/03/04/WebViewJavascriptBridge%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">WebViewJavascriptBridge源码解析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一-概述"><a href="#一-概述" class="headerlink" title="一. 概述"></a>一. 概述</h3><p>做客户端开发免不了要与<code>WebView</code>打交道，特别是对于<code>Hybrid App</code>，在<code>H5</code>所占比重越来越大的背景下，一套好的<code>WebView</code> 与原生交互的API显得尤为重要，当然目前两端都有比较成熟的三方库进行支持。比如Android端的<a target="_blank" rel="noopener" href="https://github.com/lzyzsd">JsBridge</a>,iOS端的<a target="_blank" rel="noopener" href="https://github.com/marcuswestin/WebViewJavascriptBridge">WebViewJavascriptBridge</a>,但是对于其内部原理笔者一直一知半解，导致有时面对问题无从下手，最后决心分析<code>WebViewJavascriptBridge</code>的内部实现原理，一是提升自己的源码阅读水平，其次也希望对以后的工作有所帮助。</p>
<h3 id="二-基本原理"><a href="#二-基本原理" class="headerlink" title="二. 基本原理"></a>二. 基本原理</h3><p><img src="https://s2.loli.net/2021/12/20/Genj8E9uvAxpX5M.png" alt="pic"><br>下载<code>WebViewJavascriptBridge</code>的源码后可以看到其文件并不多，分别对几个文件做简单的介绍，后面详细分析其源码</p>
<ul>
<li><code>WebViewJavascriptBridge_JS</code>: JS桥接文件，通过它实现JS环境的初始化，里面就一个C函数，返回的是JS方法。原生调用的JS方法与对应的方法回调都需要先在这里面进行注册。</li>
<li><code>WKWebViewJavascriptBridge</code> 与 <code>WebViewJavascriptBridge</code>: <code>WKWebView</code>与<code>UIWebView</code>对应的桥接文件。JS调用的原生方法与对应的方法回调都需要先在这里面进行注册。</li>
<li><code>WebViewJavascriptBridgeBase</code>: 桥接基础文件。通过他实现对原生环境的初始化，以及对方法存储容器的初始化，当然还有对<code>WebViewJavascriptBridge_JS</code>里面JS方法的调用。</li>
</ul>
<h3 id="三-源码解析"><a href="#三-源码解析" class="headerlink" title="三. 源码解析"></a>三. 源码解析</h3><p>大体了解了上面几个类的作用，我们通过源码来分析其内部的实现逻辑。我们就以<code>WebViewJavascriptBridge</code>Demo为例。</p>
<h4 id="1-JS调用OC方法"><a href="#1-JS调用OC方法" class="headerlink" title="1.  JS调用OC方法"></a>1.  JS调用OC方法</h4><h5 id="1-OC环境初始化与方法注册"><a href="#1-OC环境初始化与方法注册" class="headerlink" title="(1) OC环境初始化与方法注册"></a>(1) OC环境初始化与方法注册</h5><p>如何实现JS调用OC方法呢，首先要对当前OC环境进行初始化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// ExampleWKWebViewController</span><br><span class="line">_bridge = [WebViewJavascriptBridge bridgeForWebView:webView];</span><br><span class="line">    [_bridge setWebViewDelegate:self];</span><br><span class="line">    </span><br><span class="line">    [_bridge registerHandler:@&quot;testObjcCallback&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123;</span><br><span class="line">        NSLog(@&quot;testObjcCallback called: %@&quot;, data);</span><br><span class="line">        responseCallback(@&quot;Response from testObjcCallback&quot;);</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">// WKWebViewJavascriptBridge</span><br><span class="line">+ (instancetype)bridgeForWebView:(WKWebView*)webView &#123;</span><br><span class="line">    WKWebViewJavascriptBridge* bridge = [[self alloc] init];</span><br><span class="line">    [bridge _setupInstance:webView];</span><br><span class="line">    [bridge reset];</span><br><span class="line">    return bridge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">// WKWebViewJavascriptBridge</span><br><span class="line">- (void) _setupInstance:(WKWebView*)webView &#123;</span><br><span class="line">    _webView = webView;</span><br><span class="line">    _webView.navigationDelegate = self;</span><br><span class="line">    _base = [[WebViewJavascriptBridgeBase alloc] init];</span><br><span class="line">    _base.delegate = self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>[WebViewJavascriptBridge bridgeForWebView:webView];</code>: 看这个方法的调用栈，可以清晰的看到其作用是初始化 <code>WKWebViewJavascriptBridge</code>,进而实例化其对应的<code>WebViewJavascriptBridgeBase</code>,还有绑定各自的代理，最终实现初始化OC调用环境的目的。</p>
</li>
<li><p><code>- (void)registerHandler:(NSString*)handlerName handler:(WVJBHandler)handler;</code> : 如果要实现JS调用原生方法的目的，那么必须对原生方法进行注册，这个就是对应的注册方法。我们来看他内部做了什么:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)registerHandler:(NSString *)handlerName handler:(WVJBHandler)handler &#123;</span><br><span class="line">    _base.messageHandlers[handlerName] = [handler copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单，只不过把当前的Block保存进了<code>messageHandlers</code>这个字典中，以便等JS端调用时,通过方法名称来找到其对应的实现。</p>
</li>
</ul>
<h5 id="2-JS环境初始化与方法触发"><a href="#2-JS环境初始化与方法触发" class="headerlink" title="(2) JS环境初始化与方法触发"></a>(2) JS环境初始化与方法触发</h5><p>OC环境初始化与方法注册完成后，我们来下JS环境的初始化<br>Demo中通过<code>- (void)loadExamplePage:(WKWebView*)webView</code> 方法加载网页到当前的webView，来看下<code>ExampleApp.html</code>中的核心方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setupWebViewJavascriptBridge</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span>) &#123; <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="title class_">WebViewJavascriptBridge</span>); &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>) &#123; <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>.<span class="title function_">push</span>(callback); &#125;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span> = [callback];</span><br><span class="line">      <span class="keyword">var</span> <span class="title class_">WVJBIframe</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">      <span class="title class_">WVJBIframe</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">      <span class="title class_">WVJBIframe</span>.<span class="property">src</span> = <span class="string">&#x27;https://__bridge_loaded__&#x27;</span>;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(<span class="title class_">WVJBIframe</span>);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">removeChild</span>(<span class="title class_">WVJBIframe</span>) &#125;, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setupWebViewJavascriptBridge</span>(<span class="keyword">function</span>(<span class="params">bridge</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> uniqueId = <span class="number">1</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">log</span>(<span class="params">message, data</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> log = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    el.<span class="property">className</span> = <span class="string">&#x27;logLine&#x27;</span></span><br><span class="line">    el.<span class="property">innerHTML</span> = uniqueId++ + <span class="string">&#x27;. &#x27;</span> + message + <span class="string">&#x27;:&lt;br/&gt;&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data)</span><br><span class="line">    <span class="keyword">if</span> (log.<span class="property">children</span>.<span class="property">length</span>) &#123; log.<span class="title function_">insertBefore</span>(el, log.<span class="property">children</span>[<span class="number">0</span>]) &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; log.<span class="title function_">appendChild</span>(el) &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  bridge.<span class="title function_">registerHandler</span>(<span class="string">&#x27;testJavascriptHandler&#x27;</span>, <span class="keyword">function</span>(<span class="params">data, responseCallback</span>) &#123;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;ObjC called testJavascriptHandler with&#x27;</span>, data)</span><br><span class="line">    <span class="keyword">var</span> responseData = &#123; <span class="string">&#x27;Javascript Says&#x27;</span>:<span class="string">&#x27;Right back atcha!&#x27;</span> &#125;</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;JS responding with&#x27;</span>, responseData)</span><br><span class="line">    <span class="title function_">responseCallback</span>(responseData)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;br&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> callbackButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;buttons&#x27;</span>).<span class="title function_">appendChild</span>(<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>))</span><br><span class="line">  callbackButton.<span class="property">innerHTML</span> = <span class="string">&#x27;Fire testObjcCallback&#x27;</span></span><br><span class="line">  callbackButton.<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>()</span><br><span class="line">    <span class="title function_">log</span>(<span class="string">&#x27;JS calling handler &quot;testObjcCallback&quot;&#x27;</span>)</span><br><span class="line">    bridge.<span class="title function_">callHandler</span>(<span class="string">&#x27;testObjcCallback&#x27;</span>, &#123;<span class="string">&#x27;foo&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="title function_">log</span>(<span class="string">&#x27;JS got response&#x27;</span>, response)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>setupWebViewJavascriptBridge(callback)</code>是核心方法，webView加载html后会首先调用这个方法。这个方法需要一个参数<code>callback</code>,也是一个函数。我们来看这个方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function setupWebViewJavascriptBridge(callback) &#123;</span><br><span class="line">    if (window.WebViewJavascriptBridge) &#123; return callback(WebViewJavascriptBridge); &#125;</span><br><span class="line">    if (window.WVJBCallbacks) &#123; return window.WVJBCallbacks.push(callback); &#125;</span><br><span class="line">    window.WVJBCallbacks = [callback];</span><br><span class="line">    var WVJBIframe = document.createElement(&#x27;iframe&#x27;);</span><br><span class="line">    WVJBIframe.style.display = &#x27;none&#x27;;</span><br><span class="line">    WVJBIframe.src = &#x27;https://__bridge_loaded__&#x27;;</span><br><span class="line">    document.documentElement.appendChild(WVJBIframe);</span><br><span class="line">    setTimeout(function() &#123; document.documentElement.removeChild(WVJBIframe) &#125;, 0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
第一次加载网页时 <code>window.WebViewJavascriptBridge</code> 与 <code>window.WVJBCallbacks</code>都是false，把<code>window.WVJBCallbacks</code>赋值为包含callback的数组，此时callback为一个函数，就是后面的<code>function(bridge) ....</code>,接下来创建<code>WVJBIframe</code>,你可以把它理解为一个空白页面，创建它的目的是设置<code>src = &#39;https://__bridge_loaded__&#39;;</code>,</li>
</ul>
<blockquote>
<p>注意这个<code>src</code>属性很关键，当我们设置一个网页的<code>src</code>属性时，这个链接会被我们OC端的webView所捕获，从而调用webView的代理方法<code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code>,</p>
</blockquote>
<p>后面两句代码的的意思是加载当前空白页，以便触发OC的代理方法，然后立马移除。</p>
<ul>
<li><p>接下来我们去<code>WKWebViewJavascriptBridge</code>中看 <code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code> 这个代理方法拦截到请求后做了什么。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSURL *url = navigationAction.request.URL;</span><br><span class="line">__strong typeof(_webViewDelegate) strongDelegate = _webViewDelegate;</span><br><span class="line"></span><br><span class="line">if ([_base isWebViewJavascriptBridgeURL:url]) &#123;</span><br><span class="line">    if ([_base isBridgeLoadedURL:url]) &#123;</span><br><span class="line">        [_base injectJavascriptFile];</span><br><span class="line">    &#125; else if ([_base isQueueMessageURL:url]) &#123;</span><br><span class="line">        [self WKFlushMessageQueue];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [_base logUnkownMessage:url];</span><br><span class="line">    &#125;</span><br><span class="line">    decisionHandler(WKNavigationActionPolicyCancel);</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先判断当前的URL是否是<code>__wvjb_queue_message__</code>或者<code>__bridge_loaded__</code>,刚才触发的URL是 <code>__bridge_loaded__</code><br>会调用<code>WebViewJavascriptBridgeBase</code>的<code>- (void)injectJavascriptFile</code>方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- (void)injectJavascriptFile &#123;</span><br><span class="line">    // 获取JS字符串</span><br><span class="line">    NSString *js = WebViewJavascriptBridge_js();</span><br><span class="line">    [self _evaluateJavascript:js];</span><br><span class="line">    if (self.startupMessageQueue) &#123;</span><br><span class="line">        NSArray* queue = self.startupMessageQueue;</span><br><span class="line">        self.startupMessageQueue = nil;</span><br><span class="line">        for (id queuedMessage in queue) &#123;</span><br><span class="line">            [self _dispatchMessage:queuedMessage];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">- (void) _evaluateJavascript:(NSString *)javascriptCommand &#123;</span><br><span class="line">    [self.delegate _evaluateJavascript:javascriptCommand];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">- (NSString*) _evaluateJavascript:(NSString*)javascriptCommand &#123;</span><br><span class="line">    [_webView evaluateJavaScript:javascriptCommand completionHandler:nil];</span><br><span class="line">    return NULL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过以上方法调用可以看到，最后是把<code>WebViewJavascriptBridge_js();</code> JS方法字符串，通过方法 <code>[_webView evaluateJavaScript:javascriptCommand completionHandler:nil]</code> 注入到了webView中并且执行。从而达到初始化javascript环境的brige的作用。</p>
</li>
<li><p>WebViewJavascriptBridge_js()方法解析</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span> = &#123;</span><br><span class="line">  <span class="attr">registerHandler</span>: registerHandler,</span><br><span class="line">  <span class="attr">callHandler</span>: callHandler,</span><br><span class="line">  <span class="attr">disableJavscriptAlertBoxSafetyTimeout</span>: disableJavscriptAlertBoxSafetyTimeout,</span><br><span class="line">  <span class="attr">_fetchQueue</span>: _fetchQueue,</span><br><span class="line">  <span class="attr">_handleMessageFromObjC</span>: _handleMessageFromObjC</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> messagingIframe;</span><br><span class="line">  <span class="comment">// 要发送给原生的消息列表</span></span><br><span class="line"><span class="keyword">var</span> sendMessageQueue = [];</span><br><span class="line">  <span class="comment">// 存储注册在bridge的JS方法</span></span><br><span class="line"><span class="keyword">var</span> messageHandlers = &#123;&#125;;</span><br><span class="line"><span class="comment">// 要跳转的URL</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">CUSTOM_PROTOCOL_SCHEME</span> = <span class="string">&#x27;https&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">QUEUE_HAS_MESSAGE</span> = <span class="string">&#x27;__wvjb_queue_message__&#x27;</span>;</span><br><span class="line"><span class="comment">//JS方法回调</span></span><br><span class="line"><span class="keyword">var</span> responseCallbacks = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> uniqueId = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> dispatchMessagesWithTimeoutSafety = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// OC调用的JS方法需要用它来进行注册</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registerHandler</span>(<span class="params">handlerName, handler</span>) &#123;</span><br><span class="line">  messageHandlers[handlerName] = handler;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//JS调用OC的方法入口</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">callHandler</span>(<span class="params">handlerName, data, responseCallback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> == <span class="number">2</span> &amp;&amp; <span class="keyword">typeof</span> data == <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    responseCallback = data;</span><br><span class="line">    data = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_doSend</span>(&#123; <span class="attr">handlerName</span>:handlerName, <span class="attr">data</span>:data &#125;, responseCallback);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">disableJavscriptAlertBoxSafetyTimeout</span>(<span class="params"></span>) &#123;</span><br><span class="line">  dispatchMessagesWithTimeoutSafety = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 要发送消息给原生了</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_doSend</span>(<span class="params">message, responseCallback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (responseCallback) &#123;</span><br><span class="line">    <span class="keyword">var</span> callbackId = <span class="string">&#x27;cb_&#x27;</span>+(uniqueId++)+<span class="string">&#x27;_&#x27;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    responseCallbacks[callbackId] = responseCallback;</span><br><span class="line">    message[<span class="string">&#x27;callbackId&#x27;</span>] = callbackId;</span><br><span class="line">  &#125;</span><br><span class="line">  sendMessageQueue.<span class="title function_">push</span>(message);</span><br><span class="line">      <span class="comment">//触发webView 代理，解析JS 的message</span></span><br><span class="line">  messagingIframe.<span class="property">src</span> = <span class="variable constant_">CUSTOM_PROTOCOL_SCHEME</span> + <span class="string">&#x27;://&#x27;</span> + <span class="variable constant_">QUEUE_HAS_MESSAGE</span>;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">// 把消息转成json字符串</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_fetchQueue</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> messageQueueString = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendMessageQueue);</span><br><span class="line">  sendMessageQueue = [];</span><br><span class="line">  <span class="keyword">return</span> messageQueueString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_dispatchMessageFromObjC</span>(<span class="params">messageJSON</span>) &#123;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 原生会调用他，JS用它来达到消息分发</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_handleMessageFromObjC</span>(<span class="params">messageJSON</span>) &#123;</span><br><span class="line">      <span class="title function_">_dispatchMessageFromObjC</span>(messageJSON);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">messagingIframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">messagingIframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">messagingIframe.<span class="property">src</span> = <span class="variable constant_">CUSTOM_PROTOCOL_SCHEME</span> + <span class="string">&#x27;://&#x27;</span> + <span class="variable constant_">QUEUE_HAS_MESSAGE</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(messagingIframe);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(_callWVJBCallbacks, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_callWVJBCallbacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> callbacks = <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>;</span><br><span class="line">  <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;callbacks.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    callbacks[i](<span class="title class_">WebViewJavascriptBridge</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我截选了一些关键代码，首先整个<code>WebViewJavascriptBridge_js</code>是一个JS方法的执行，首先创建了JS端的<code>WebViewJavascriptBridge</code>并赋值给了<code>window</code>,我们来看这个对象的构成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span> = &#123;</span><br><span class="line">  <span class="attr">registerHandler</span>: registerHandler,</span><br><span class="line">  <span class="attr">callHandler</span>: callHandler,</span><br><span class="line">  <span class="attr">disableJavscriptAlertBoxSafetyTimeout</span>: disableJavscriptAlertBoxSafetyTimeout,</span><br><span class="line">  <span class="attr">_fetchQueue</span>: _fetchQueue,</span><br><span class="line">  <span class="attr">_handleMessageFromObjC</span>: _handleMessageFromObjC</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li><p><code>registerHandler</code>:直接对应下面的<code>registerHandler(handlerName, handler)</code> 方法，通过它我们把能被OC调用的JS方法进行注册，看它的实现也是比较简单的</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">registerHandler</span>(<span class="params">handlerName, handler</span>) &#123;</span><br><span class="line">	messageHandlers[handlerName] = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把JS的方法实现以方法名<code>handleName</code>保存在messageHandlers中。</p>
<ul>
<li><code>callHandler</code>: 对应下面<code>callHandler(handlerName, data, responseCallback)</code>方法，通过它我们可以直接发起对OC方法的调用，具体调用逻辑我们在下面进行分析。</li>
<li><code>disableJavscriptAlertBoxSafetyTimeout</code>:回调是否超时开关，默认为false</li>
<li><code>_fetchQueue</code>: 把javascript环境的方法序列化成JSON字符串，并返回给OC端</li>
<li><code>_handleMessageFromObjC</code>:处理OC发给javascript环境的方法,<code>_dispatchMessageFromObjC(messageJSON)</code>这个方法的参数就是OC调用JS的message信息，这个方法对messageJSON进行解析处理，进而调用相应的JS方法。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">messagingIframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">messagingIframe.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">messagingIframe.<span class="property">src</span> = <span class="variable constant_">CUSTOM_PROTOCOL_SCHEME</span> + <span class="string">&#x27;://&#x27;</span> + <span class="variable constant_">QUEUE_HAS_MESSAGE</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(messagingIframe);</span><br></pre></td></tr></table></figure>
<p>这里的src就是https:&#x2F;&#x2F;__wvjb_queue_message__，这段代码的意思是把javascript要发送给OC的消息立即发送出去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(_callWVJBCallbacks, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_callWVJBCallbacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> callbacks = <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>;</span><br><span class="line">  <span class="keyword">delete</span> <span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;callbacks.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    callbacks[i](<span class="title class_">WebViewJavascriptBridge</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>WebViewJavascriptBridge_js</code>的最后是上面的代码，它会调用<code>ExampleApp.html</code>中的callBack方法，也就是它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setupWebViewJavascriptBridge</span>(<span class="keyword">function</span>(<span class="params">bridge</span>) &#123;</span><br><span class="line"> ....</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>继而完成对这个JS环境的初始化与<code>ExampleApp.html</code>的加载。</p>
<h5 id="3-JS调用OC方法流程"><a href="#3-JS调用OC方法流程" class="headerlink" title="(3) JS调用OC方法流程"></a>(3) JS调用OC方法流程</h5><ul>
<li>点击JS按钮触发下面的方法<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bridge.<span class="title function_">callHandler</span>(<span class="string">&#x27;testObjcCallback&#x27;</span>, &#123;<span class="string">&#x27;foo&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>&#125;, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">	<span class="title function_">log</span>(<span class="string">&#x27;JS got response&#x27;</span>, response)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
传递方法名<code>testObjcCallback</code>,消息参数<code>&#123;&#39;foo&#39;: &#39;bar&#39;&#125;</code>,以及OC回调JS的方法<code>function(response) &#123;log(&#39;JS got response&#39;, response)&#125;)</code>,</li>
<li>调用<code>WebViewJavascriptBridge_js</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">callHandler</span>(<span class="params">handlerName, data, responseCallback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> == <span class="number">2</span> &amp;&amp; <span class="keyword">typeof</span> data == <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    responseCallback = data;</span><br><span class="line">    data = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">_doSend</span>(&#123; <span class="attr">handlerName</span>:handlerName, <span class="attr">data</span>:data &#125;, responseCallback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_doSend</span>(<span class="params">message, responseCallback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (responseCallback) &#123;</span><br><span class="line">    <span class="keyword">var</span> callbackId = <span class="string">&#x27;cb_&#x27;</span>+(uniqueId++)+<span class="string">&#x27;_&#x27;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    responseCallbacks[callbackId] = responseCallback;</span><br><span class="line">    message[<span class="string">&#x27;callbackId&#x27;</span>] = callbackId;</span><br><span class="line">  &#125;</span><br><span class="line">  sendMessageQueue.<span class="title function_">push</span>(message);</span><br><span class="line">  messagingIframe.<span class="property">src</span> = <span class="variable constant_">CUSTOM_PROTOCOL_SCHEME</span> + <span class="string">&#x27;://&#x27;</span> + <span class="variable constant_">QUEUE_HAS_MESSAGE</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
可以看到核心方法是<code>_doSend()</code>,入参message是调用OC的方法名与参数，responseCallback是OC回调JS的方法，接下来将这个回调方法保存在responseCallbacks中，key值是<code>callbackId</code>,消息对象message也添加一个<code>callbackId</code>,最后设置<code>messagingIframe</code>的src属性，从而被ebView的代理方法<code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code>拦截。</li>
<li>在上面的代理方法中，拦截到的URL为<code>__wvjb_queue_message__</code>,所以调用方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)WKFlushMessageQueue &#123;</span><br><span class="line">    [_webView evaluateJavaScript:[_base webViewJavascriptFetchQueyCommand] completionHandler:^(NSString* result, NSError* error) &#123;</span><br><span class="line">        if (error != nil) &#123;</span><br><span class="line">            NSLog(@&quot;WebViewJavascriptBridge: WARNING: Error when trying to fetch data from WKWebView: %@&quot;, error);</span><br><span class="line">        &#125;</span><br><span class="line">        [_base flushMessageQueue:result];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">- (NSString *)webViewJavascriptFetchQueyCommand &#123;</span><br><span class="line">    return @&quot;WebViewJavascriptBridge._fetchQueue();&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
WebView触发JS的<code>WebViewJavascriptBridge._fetchQueue()</code>,<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_fetchQueue</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> messageQueueString = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(sendMessageQueue);</span><br><span class="line">	sendMessageQueue = [];</span><br><span class="line">	<span class="keyword">return</span> messageQueueString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
这个方法里面会将<code>sendMessageQueue</code>换成json字符串，然后返回给OC环境，触发<code>[_base flushMessageQueue:result];</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">- (void)flushMessageQueue:(NSString *)messageQueueString&#123;</span><br><span class="line">    if (messageQueueString == nil || messageQueueString.length == 0) &#123;</span><br><span class="line">        NSLog(@&quot;WebViewJavascriptBridge: WARNING: ObjC got nil while fetching the message queue JSON from webview. This can happen if the WebViewJavascriptBridge JS is not currently present in the webview, e.g if the webview just loaded a new page.&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    // JS传递过来的json字符串，我们进行反序列化 得到message数组</span><br><span class="line">    NSLog(@&quot;messageQueueString===%@&quot;,messageQueueString);</span><br><span class="line">    id messages = [self _deserializeMessageJSON:messageQueueString];</span><br><span class="line"></span><br><span class="line">    for (WVJBMessage* message in messages) &#123;</span><br><span class="line">        if (![message isKindOfClass:[WVJBMessage class]]) &#123;</span><br><span class="line">            NSLog(@&quot;WebViewJavascriptBridge: WARNING: Invalid %@ received: %@&quot;, [message class], message);</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        [self _log:@&quot;RCVD&quot; json:message];</span><br><span class="line">        </span><br><span class="line">        NSString* responseId = message[@&quot;responseId&quot;];</span><br><span class="line">        if (responseId) &#123;</span><br><span class="line">            WVJBResponseCallback responseCallback = _responseCallbacks[responseId];</span><br><span class="line">            responseCallback(message[@&quot;responseData&quot;]);</span><br><span class="line">            [self.responseCallbacks removeObjectForKey:responseId];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            WVJBResponseCallback responseCallback = NULL;</span><br><span class="line">            NSString* callbackId = message[@&quot;callbackId&quot;];</span><br><span class="line">            if (callbackId) &#123; // 有回调</span><br><span class="line">                responseCallback = ^(id responseData) &#123;</span><br><span class="line">                    if (responseData == nil) &#123;</span><br><span class="line">                        responseData = [NSNull null];</span><br><span class="line">                    &#125;</span><br><span class="line">                    </span><br><span class="line">                    WVJBMessage* msg = @&#123; @&quot;responseId&quot;:callbackId, @&quot;responseData&quot;:responseData &#125;;</span><br><span class="line">                    [self _queueMessage:msg];</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                responseCallback = ^(id ignoreResponseData) &#123;</span><br><span class="line">                    // Do nothing</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            WVJBHandler handler = self.messageHandlers[message[@&quot;handlerName&quot;]];</span><br><span class="line"></span><br><span class="line">            if (!handler) &#123;</span><br><span class="line">                NSLog(@&quot;WVJBNoHandlerException, No handler for message from JS: %@&quot;, message);</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            //向下传递参数，并且触发block回调（）</span><br><span class="line">            handler(message[@&quot;data&quot;], responseCallback);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
这个方法就是OC端处理JS的核心方法了，将<code>messageQueueString</code>反序列化，得到消息数组<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">       &#123;</span><br><span class="line">       callbackId = &quot;cb_1_1639553291614&quot;;</span><br><span class="line">       data =         &#123;</span><br><span class="line">           foo = bar;</span><br><span class="line">       &#125;;</span><br><span class="line">       handlerName = testObjcCallback;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
有<code>callbackId</code>,表明有消息回调，生成<code>responseCallback</code>Block,这个Block里面将接收的参数与<code>callbackId</code>打包一并发送给JS环境，并调用JS环境的<code>WebViewJavascriptBridge._handleMessageFromObjC(messageJSON);</code>方法将<code>messageJSON</code>进行解析。这里只是Block的实现，并没调用这个Block，调用在下面</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">WVJBHandler handler = self.messageHandlers[message[@&quot;handlerName&quot;]];</span><br><span class="line"></span><br><span class="line">if (!handler) &#123;</span><br><span class="line">    NSLog(@&quot;WVJBNoHandlerException, No handler for message from JS: %@&quot;, message);</span><br><span class="line">    continue;</span><br><span class="line">&#125;</span><br><span class="line">//向下传递参数，并且触发block回调（）</span><br><span class="line">handler(message[@&quot;data&quot;], responseCallback);</span><br></pre></td></tr></table></figure>

<p>根据<code>handlerName</code>找到在<code>messageHandlers</code>保存的方法实现，<code>handler(message[@&quot;data&quot;], responseCallback);</code>进行真正的调用，在OC的注册方法中，调用<code>responseCallback(@&quot;Response from testObjcCallback&quot;);</code> 向JS环境发送回调并传递参数。</p>
<ul>
<li><p>JS环境通过这个<code>_handleMessageFromObjC(messageJSON)</code>方法得到<code>messageJSON</code>,并对其解析。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_dispatchMessageFromObjC</span>(<span class="params">messageJSON</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (dispatchMessagesWithTimeoutSafety) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(_doDispatchMessageFromObjC);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="title function_">_doDispatchMessageFromObjC</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">_doDispatchMessageFromObjC</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//转换为对象</span></span><br><span class="line">    <span class="keyword">var</span> message = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(messageJSON);</span><br><span class="line">    <span class="keyword">var</span> messageHandler;</span><br><span class="line">    <span class="keyword">var</span> responseCallback;</span><br><span class="line">    <span class="comment">// 这个responseId就是JS调用OC方法保存的callbackId</span></span><br><span class="line">    <span class="keyword">if</span> (message.<span class="property">responseId</span>) &#123;</span><br><span class="line">      responseCallback = responseCallbacks[message.<span class="property">responseId</span>];</span><br><span class="line">      <span class="keyword">if</span> (!responseCallback) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">responseCallback</span>(message.<span class="property">responseData</span>);</span><br><span class="line">      <span class="keyword">delete</span> responseCallbacks[message.<span class="property">responseId</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (message.<span class="property">callbackId</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> callbackResponseId = message.<span class="property">callbackId</span>;</span><br><span class="line">        responseCallback = <span class="keyword">function</span>(<span class="params">responseData</span>) &#123;</span><br><span class="line">          <span class="title function_">_doSend</span>(&#123; <span class="attr">handlerName</span>:message.<span class="property">handlerName</span>, <span class="attr">responseId</span>:callbackResponseId, <span class="attr">responseData</span>:responseData &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> handler = messageHandlers[message.<span class="property">handlerName</span>];</span><br><span class="line">      <span class="keyword">if</span> (!handler) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WebViewJavascriptBridge: WARNING: no handler for message from ObjC:&quot;</span>, message);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">handler</span>(message.<span class="property">data</span>, responseCallback);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先将字符串转化为JSON对象，根据responseId(这个responseId就是JS调用OC方法保存的callbackId),找到对应的方法实现，进行调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">  <span class="title function_">log</span>(<span class="string">&#x27;JS got response&#x27;</span>, response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到此就完成了JS调用OC，并且OC回调JS并传递参数的全部过程。</p>
</li>
</ul>
<h4 id="2-OC调用JS方法"><a href="#2-OC调用JS方法" class="headerlink" title="2. OC调用JS方法"></a>2. OC调用JS方法</h4><p>跟上面类似再来看下OC主动调用JS方法的实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[_bridge callHandler:@&quot;testJavascriptHandler&quot; data:@&#123; @&quot;foo&quot;:@&quot;before ready&quot; &#125;];</span><br><span class="line">....</span><br><span class="line"> - (void)callHandler:(NSString *)handlerName data:(id)data &#123;</span><br><span class="line">    [self callHandler:handlerName data:data responseCallback:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)callHandler:(NSString *)handlerName data:(id)data responseCallback:(WVJBResponseCallback)responseCallback &#123;</span><br><span class="line">    [_base sendData:data responseCallback:responseCallback handlerName:handlerName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">  </span><br><span class="line">- (void)sendData:(id)data responseCallback:(WVJBResponseCallback)responseCallback handlerName:(NSString*)handlerName &#123;</span><br><span class="line">    NSMutableDictionary* message = [NSMutableDictionary dictionary];</span><br><span class="line">    </span><br><span class="line">    if (data) &#123;</span><br><span class="line">        message[@&quot;data&quot;] = data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (responseCallback) &#123;</span><br><span class="line">        NSString* callbackId = [NSString stringWithFormat:@&quot;objc_cb_%ld&quot;, ++_uniqueId];</span><br><span class="line">        self.responseCallbacks[callbackId] = [responseCallback copy];</span><br><span class="line">        message[@&quot;callbackId&quot;] = callbackId;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (handlerName) &#123;</span><br><span class="line">        message[@&quot;handlerName&quot;] = handlerName;</span><br><span class="line">    &#125;</span><br><span class="line">    [self _queueMessage:message];</span><br><span class="line">&#125;</span><br><span class="line">....</span><br><span class="line">  </span><br><span class="line">- (void)_dispatchMessage:(WVJBMessage*)message &#123;</span><br><span class="line">    NSString *messageJSON = [self _serializeMessage:message pretty:NO];</span><br><span class="line">    [self _log:@&quot;SEND&quot; json:messageJSON];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\&quot; withString:@&quot;\\\\&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\&quot;&quot; withString:@&quot;\\\&quot;&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\&#x27;&quot; withString:@&quot;\\\&#x27;&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\n&quot; withString:@&quot;\\n&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\r&quot; withString:@&quot;\\r&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\f&quot; withString:@&quot;\\f&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\u2028&quot; withString:@&quot;\\u2028&quot;];</span><br><span class="line">    messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\u2029&quot; withString:@&quot;\\u2029&quot;];</span><br><span class="line">    </span><br><span class="line">    NSString* javascriptCommand = [NSString stringWithFormat:@&quot;WebViewJavascriptBridge._handleMessageFromObjC(&#x27;%@&#x27;);&quot;, messageJSON];</span><br><span class="line">    NSLog(@&quot;javascriptCommand==%@&quot;,javascriptCommand);</span><br><span class="line">    if ([[NSThread currentThread] isMainThread]) &#123;</span><br><span class="line">        [self _evaluateJavascript:javascriptCommand];</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            [self _evaluateJavascript:javascriptCommand];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，跟JS调用OC方法的原理类似，将OC调用JS的方法名与参数封装进message对象，如果有回调函数，将回调函数通过<code>responseCallbacks</code>保存，并生成<code>callbackId</code>,将整个message打包发送给JS环境的<code>WebViewJavascriptBridge._handleMessageFromObjC(messageJSON);</code> 进行解析，解析流程上面介绍过了，这里不再赘述。</p>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四. 总结"></a>四. 总结</h3><p>通过上面流程分析,整个<code>WebViewJavascriptBridge</code> 内部的实现原理就比较清晰了。</p>
<ul>
<li>JS将方法注册到JS环境的bridge，OC调用JS的核心方法就是<code> [_webView evaluateJavaScript:javascriptCommand completionHandler:nil];</code>,JS环境收到消息后，通过方法<code>WebViewJavascriptBridge._handleMessageFromObjC();</code>将消息进行解析，调用注册在bridge的方法。</li>
<li>OC将方法注册到OC环境的bridge，JS调用OC的核心逻辑是，设置空白网页的<code>src</code>属性，从而被webView的代理方法<code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code>，OC通过核心方法<code>- (void)flushMessageQueue:(NSString *)messageQueueString</code>将传递数据进行解析。</li>
<li>两边都是通过方法名找到对应的方法实现，然后通过ID来查找回调函数。</li>
</ul>
<p>多阅读源码是好的一方面可以提升自己源码阅读水平，另一方面可以学习作者的一些好的设计思路。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/marcuswestin/WebViewJavascriptBridge">https://github.com/marcuswestin/WebViewJavascriptBridge</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lzyzsd/JsBridge">https://github.com/lzyzsd/JsBridge</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903472718938126#heading-9">https://juejin.cn/post/6844903472718938126#heading-9</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2022/03/04/WebViewJavascriptBridge%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" data-id="cllniud7w0002xbex7n296jts" data-title="WebViewJavascriptBridge源码解析" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-iOS逆向之从砸壳到重签名" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/14/iOS%E9%80%86%E5%90%91%E4%B9%8B%E4%BB%8E%E7%A0%B8%E5%A3%B3%E5%88%B0%E9%87%8D%E7%AD%BE%E5%90%8D/" class="article-date">
  <time class="dt-published" datetime="2021-11-14T12:46:25.000Z" itemprop="datePublished">2021-11-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/14/iOS%E9%80%86%E5%90%91%E4%B9%8B%E4%BB%8E%E7%A0%B8%E5%A3%B3%E5%88%B0%E9%87%8D%E7%AD%BE%E5%90%8D/">iOS-逆向之从砸壳到重签名</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><p>笔者做了多年的业务开发，以前对逆向知之甚少，好像我们做iOS的开发者对应用本身的安全问题总不是那么上心，总以为Apple自身的加密签名机制足够安全了，我们除了关心业务网络安全，对自身App包的安全重视度总是不够。然而一旦我们的包被有心人破解，那么无论是对自身业务还是用户数据都是致命的。真正开始研究逆向，才发现我们App是如此的不堪一击。所以研究逆向其实是研究<code>Hacker</code>是如何攻破我们的应用，从而更好地保护自身应用安全。</p>
<p>研究逆向，首当其冲的就是重签名，重签名就是用自己的证书签名别人的应用，从而进行分发。重签名说白了就是套壳别人的应用，挺火的微信双开，其实就是对微信进行了重签名。而重签名首先要做的就是对应用砸壳。</p>
<h3 id="二、手机越狱与应用砸壳"><a href="#二、手机越狱与应用砸壳" class="headerlink" title="二、手机越狱与应用砸壳"></a>二、手机越狱与应用砸壳</h3><p>我们从App store 下载的应用是经过苹果加密签名过的，是无法进行重签名的。所以重签名首先要做的就是对应用进行砸壳，而砸壳需要你有一台越狱手机。</p>
<h4 id="1-手机越狱"><a href="#1-手机越狱" class="headerlink" title="1. 手机越狱"></a>1. 手机越狱</h4><p>目前主流的越狱平台有PP助手、爱思助手做到比较好，提供一键越狱功能。我自己使用的爱思助手，下载爱思助手电脑版，选择【工具箱】-【一键越狱】，此时会匹配你当前手机版本的越狱工具，选择工具进行越狱。<br><img src="https://i.loli.net/2021/11/16/Fn7jSBbR4AQDvsk.png" alt="pic"><br>我使用的是 iphone SE，系统版本是14.4，按照提示完成越狱就OK了。</p>
<blockquote>
<p>需要注意，这种越狱方式是不完美的越狱，当你重启手机后会重新变回非越狱状态，需要重新走一遍越狱流程。不过对于我们研究逆向足够了。</p>
</blockquote>
<p>还没完，越狱完成后需要安装一个插件：<code>Apple File Conduit&quot;2&quot;</code>,安装这个插件的目的是，让我们的电脑端能访问设备的根文件目录，安装方式也很简单，可以参考这篇文章<a target="_blank" rel="noopener" href="https://www.i4.cn/news_detail_1623.html">Apple File Conduit”2”安装</a>，这里不再赘述。当我们安装完成后，爱思助手连接手机，可以看到在【文件管理】中多了个栏目【文件系统(越狱)】，这就是越狱状态下的系统根目录。</p>
<p><img src="https://i.loli.net/2021/11/16/fgXzYoLWwFBKDsT.png" alt="pic"></p>
<h4 id="2-ipa应用砸壳"><a href="#2-ipa应用砸壳" class="headerlink" title="2. ipa应用砸壳"></a>2. ipa应用砸壳</h4><p>首先了解什么是应用砸壳：我们提交到App Store发布的App都是经过Apple加密的，这样可以确保安装到我们手机的应用都是苹果审核授权的，当然通过企业级证书或者开发者证书生成的App是不需要砸壳的。对于App Store加密的应用，我们无法通过Hopper等反编译静态分析，也无法class-dump，在逆向分析过程中，需要对加密的二进制文件进行解密才可以进行静态分析，这一过程就是大家熟知的砸壳。<br>砸壳主要有两种方式：</p>
<ul>
<li>静态砸壳<br>静态砸壳就是在已经掌握和了解到了壳应用的加密算法和逻辑后,在不运行壳应用程序的前提下将壳应用程序进行解密处理。静态脱壳的方法难度大，而且加密方发现应用被破解后，就可能会改用更加高级和复杂的加密技术。</li>
<li>动态砸壳<br>动态砸壳就是从运行在进程内存空间中的可执行程序映像(image)入手，来将内存中的内容进行转储(dump)处理来实现脱壳处理。这种方法实现起来相对简单，且不必关心使用的是何种加密技术。所以目前市面上的砸壳工具都是基于动态砸壳进行的。动态砸壳有多种工具：<code>Clutch</code>、<code>dumpdecrypted</code>、<code>CrackerXI App</code>,前两种对系统要求较严格，而且年久失修很容易砸壳失败，我们直接介绍最方便的第三种方式：利用<code>CrackerXI App</code>进行砸壳。</li>
</ul>
<h5 id="1-在Cydia中下载CrackerXI-App"><a href="#1-在Cydia中下载CrackerXI-App" class="headerlink" title="(1) 在Cydia中下载CrackerXI App"></a>(1) 在<code>Cydia</code>中下载<code>CrackerXI App</code></h5><p><code>Cydia</code>类似于越狱前的App Store，越狱后我们所有的软件都是通过<code>Cydia</code>来进行安装。打开<code>Cydia</code>后，选择【软件源】-右上角【编辑】-点击【添加】，输入<code>http://apt.wxhbts.com/</code>,【添加源】等待添加完成。添加软件源完成后，搜索<code>CrackerXI App</code>,点击安装完成后【重启springboard】，回到桌面，可以看到桌面上安装完成了<code>CrackerXI+</code>App.</p>
<p><img src="https://i.loli.net/2021/11/16/8gV7njrLvoHaOql.png" alt="pic"></p>
<h5 id="2-砸壳"><a href="#2-砸壳" class="headerlink" title="(2) 砸壳"></a>(2) 砸壳</h5><p>提前在App Store 下载好你要砸壳的App，打开<code>CrackerXI+</code>,选择【AppList】然后点击你要砸壳的应用，在弹框中选择【YES，Full IPA】，此时会打开我们要砸壳的应用进行砸壳，完成后会看到一个砸壳后的文件地址<code>/var/mobile/Documents/CrackerXI/*****.ipa</code>,这个文件就是我们砸壳后的ipa包。</p>
<p><img src="https://i.loli.net/2021/11/16/wniqXrAOcyC5ovE.png" alt="pic"></p>
<p>这个路径怎么查找相信聪明的你已经知道了，去爱思助手-【文件管理】-【文件系统(越狱)】查找到这个ipa，导出到桌面目录就完成了。</p>
<p><img src="https://i.loli.net/2021/11/16/nzHuATBo6t5CcIG.png" alt="pic"></p>
<h4 id="3-验证"><a href="#3-验证" class="headerlink" title="(3) 验证"></a>(3) 验证</h4><p>完成上面的操作后，我们需要验证一下拿到的ipa是否是被砸壳的。把<code>.ipa</code>包扩展名改为<code>.zip</code>,解压后得到<code>Payload</code>文件夹，右键【显示包内容】- 找到可执行文件.</p>
<p><img src="https://i.loli.net/2021/11/16/nZ6ybLfHYM35gcN.png" alt="pic"></p>
<p>终端输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">otool -l 值执行文件名 | grep crypt</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/11/16/PGAbWtg8v9ZOmHI.png" alt="pic"></p>
<p>可以看到<code>cryptid</code>的值为0，说明砸壳成功。</p>
<h3 id="三、重新签名"><a href="#三、重新签名" class="headerlink" title="三、重新签名"></a>三、重新签名</h3><p>Apple 应用的分发一般有一下几种方式：</p>
<ul>
<li>最常用的是从App store下载应用。这种下发方式不受设备数的限制，只要上线App store 的应用，都会被Apple进行签名加密.</li>
<li>第二种方式是申请企业账号，把我们的应用通过企业账号进行签名，从而绕过App store恼人的审核机制，达到分发应用的目的。这种方法分发数目也不受限制.</li>
<li>第三种是通过<code>TestFlight</code>进行测试版本的分发，他分为内部测试人员与外部测试人员。通过分发外部测试人员，最多能给1万名用户进行分发安装.</li>
<li>第四种开发人员通过添加设备ID安装应用，最多可以注册100台设备.</li>
</ul>
<p>不同的开发者账号对应着App不同的分发方式，我们申请完成开发者账号后，创建应用Id，然后创建其对应证书，描述文件等一系列动作，实际已经决定了它的分发方式了。可以这样理解：每一个应用Id后面对应一套证书，这套证书决定了你应用的分发方式。重签名就是为当前的应用换一套应用Id与证书，从而达到分发应用的目的。现实的需求是，如果你上线App Store的应用，想通过企业账号的形式进行分发，而你又没有源码，或是想探究一下应用双开，那么重签名就派上用场了。我们介绍两种重签名的方式：</p>
<h4 id="1-Xcode-重签名"><a href="#1-Xcode-重签名" class="headerlink" title="1.Xcode 重签名"></a>1.Xcode 重签名</h4><h5 id="1-新建同名的工程文件"><a href="#1-新建同名的工程文件" class="headerlink" title="(1) 新建同名的工程文件"></a>(1) 新建同名的工程文件</h5><blockquote>
<p>注意这里的同名并不是Bundle Identifier 相同，而是跟你砸壳解压ipa文件，Payload里面的包相同的名称</p>
</blockquote>
<p>还需要注意，如果你重签名的工程中是通过<code>AppDelegate</code>来监听App的生命周期的话，那么需要在新版的Xcode中移除<code>SceneDelegate</code>这个类,重新使用<code>AppDelegate</code>来监听App的生命周期。重新配置完成工程后，真机运行，把描述文件安装到手机里。</p>
<p><img src="https://i.loli.net/2021/11/16/erThQYGUxa9bfcu.png" alt="pic"></p>
<h5 id="2-替换编译的App包"><a href="#2-替换编译的App包" class="headerlink" title="(2) 替换编译的App包"></a>(2) 替换编译的App包</h5><p>找到我们砸壳过的Payload文件夹中包，对我们编译的包进行替换</p>
<p><img src="https://i.loli.net/2021/11/16/eTchXtqCyoOEgxK.png" alt="pic"></p>
<h5 id="3-对二进制文件中的FrameWork进行重签名"><a href="#3-对二进制文件中的FrameWork进行重签名" class="headerlink" title="(3) 对二进制文件中的FrameWork进行重签名"></a>(3) 对二进制文件中的FrameWork进行重签名</h5><blockquote>
<p>其实在这一步之前还需要对包内的<code>PlugIns</code>插件以及<code>Watch</code>相关组件进行删除，我们逆向包里面没有这些组件，所以省略了。</p>
</blockquote>
<p>进入Framework 文件夹，利用<code>CodeSign</code>对Framework进行证书签名,注意要对所有FrameWork进行重签名。</p>
<p><img src="https://i.loli.net/2021/11/16/WYCEPiMxvwleSr9.png" alt="pic"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codesign -fs &quot;复制的你自己的证书名字&quot; 要重签的FrameWork名称</span><br></pre></td></tr></table></figure>
<blockquote>
<p>证书的名字就是你真机测试的证书的名称，如果不知道可以去钥匙串中查看</p>
</blockquote>
<p><img src="https://i.loli.net/2021/11/16/SGFYDK2MEWeOHv5.png" alt="pic"></p>
<blockquote>
<p><code>iPhone Developer: *** ** (********)</code> 就是证书名称</p>
</blockquote>
<h5 id="4-重签名后运行"><a href="#4-重签名后运行" class="headerlink" title="(4) 重签名后运行"></a>(4) 重签名后运行</h5><p><img src="https://i.loli.net/2021/11/16/O1cVJ9sMx5p4DIy.png" alt="pic"></p>
<p>这样我们就在没有源码的情况下，完成了对应用的重签名。</p>
<h4 id="2-使用脚本文件重签名"><a href="#2-使用脚本文件重签名" class="headerlink" title="2. 使用脚本文件重签名"></a>2. 使用脚本文件重签名</h4><p>利用<code>shell</code>脚本进行重签名的原理，跟上面的签名原理相同，只不过把重签步骤给脚本化了。</p>
<h5 id="1-创建空工程（工程名随便），并且进行真机运行"><a href="#1-创建空工程（工程名随便），并且进行真机运行" class="headerlink" title="(1) 创建空工程（工程名随便），并且进行真机运行"></a>(1) 创建空工程（工程名随便），并且进行真机运行</h5><h5 id="2-在工程根目录下创建APP文件夹，在文件中放入我们砸壳后的ipa包"><a href="#2-在工程根目录下创建APP文件夹，在文件中放入我们砸壳后的ipa包" class="headerlink" title="(2) 在工程根目录下创建APP文件夹，在文件中放入我们砸壳后的ipa包"></a>(2) 在工程根目录下创建APP文件夹，在文件中放入我们砸壳后的ipa包</h5><p><img src="https://i.loli.net/2021/11/16/buoc65inTJjavSk.png" alt="pic"></p>
<h5 id="3-在工程中添加脚本"><a href="#3-在工程中添加脚本" class="headerlink" title="(3) 在工程中添加脚本"></a>(3) 在工程中添加脚本</h5><p>在工程<code>Build Phases</code>中新建脚本文件<br><img src="https://i.loli.net/2021/11/16/hVz8MxojlmFdYP6.png" alt="pic"></p>
<p>在<code>Run Script</code>中添加脚本</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># Type a script or drag a script file from your workspace to insert its path.</span><br><span class="line"># Type a script or drag a script file from your workspace to insert its path.</span><br><span class="line"># $&#123;SRCROOT&#125; 为工程文件所在的目录</span><br><span class="line">TEMP_PATH=<span class="string">&quot;$&#123;SRCROOT&#125;/Temp&quot;</span></span><br><span class="line">#资源文件夹,放三方APP的</span><br><span class="line">ASSETS_PATH=<span class="string">&quot;$&#123;SRCROOT&#125;/APP&quot;</span></span><br><span class="line"><span class="meta">#ipa包路径</span></span><br><span class="line">TARGET_IPA_PATH=<span class="string">&quot;$&#123;ASSETS_PATH&#125;/*.ipa&quot;</span></span><br><span class="line"></span><br><span class="line">#新建Temp文件夹</span><br><span class="line">rm -rf <span class="string">&quot;$TEMP_PATH&quot;</span></span><br><span class="line">mkdir -p <span class="string">&quot;$TEMP_PATH&quot;</span></span><br><span class="line"></span><br><span class="line"># --------------------------------------</span><br><span class="line"># <span class="number">1.</span> 解压IPA 到Temp下</span><br><span class="line">unzip -oqq <span class="string">&quot;$TARGET_IPA_PATH&quot;</span> -d <span class="string">&quot;$TEMP_PATH&quot;</span></span><br><span class="line"># 拿到解压的临时APP的路径</span><br><span class="line">TEMP_APP_PATH=$(<span class="built_in">set</span> -- <span class="string">&quot;$TEMP_PATH/Payload/&quot;</span>*.app;echo <span class="string">&quot;$1&quot;</span>)</span><br><span class="line"># 这里显示打印一下 TEMP_APP_PATH变量</span><br><span class="line">echo <span class="string">&quot;TEMP_APP_PATH: $TEMP_APP_PATH&quot;</span></span><br><span class="line"></span><br><span class="line"># -------------------------------------</span><br><span class="line"># <span class="number">2.</span> 把解压出来的.app拷贝进去</span><br><span class="line">#BUILT_PRODUCTS_DIR 工程生成的APP包路径</span><br><span class="line">#TARGET_NAME target名称</span><br><span class="line">TARGET_APP_PATH=<span class="string">&quot;$BUILT_PRODUCTS_DIR/$TARGET_NAME.app&quot;</span></span><br><span class="line">echo <span class="string">&quot;TARGET_APP_PATH: $TARGET_APP_PATH&quot;</span></span><br><span class="line"></span><br><span class="line">rm -rf <span class="string">&quot;$TARGET_APP_PATH&quot;</span></span><br><span class="line">mkdir -p <span class="string">&quot;$TARGET_APP_PATH&quot;</span></span><br><span class="line">cp -rf <span class="string">&quot;$TEMP_APP_PATH/&quot;</span> <span class="string">&quot;$TARGET_APP_PATH/&quot;</span></span><br><span class="line"></span><br><span class="line"># -------------------------------------</span><br><span class="line"># <span class="number">3.</span> 为了是重签过程简化，移走extension和watchAPP. 此外个人免费的证书没办法签extension</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;Removing AppExtensions&quot;</span></span><br><span class="line">rm -rf <span class="string">&quot;$TARGET_APP_PATH/PlugIns&quot;</span></span><br><span class="line">rm -rf <span class="string">&quot;$TARGET_APP_PATH/Watch&quot;</span></span><br><span class="line"></span><br><span class="line"># -------------------------------------</span><br><span class="line"># <span class="number">4.</span> 更新 Info.plist 里的BundleId</span><br><span class="line">#  设置 <span class="string">&quot;Set :KEY Value&quot;</span> <span class="string">&quot;目标文件路径.plist&quot;</span></span><br><span class="line">/usr/libexec/PlistBuddy -c <span class="string">&quot;Set :CFBundleIdentifier $PRODUCT_BUNDLE_IDENTIFIER&quot;</span> <span class="string">&quot;$TARGET_APP_PATH/Info.plist&quot;</span></span><br><span class="line"></span><br><span class="line"># <span class="number">5.</span>给可执行文件上权限</span><br><span class="line">#添加ipa二进制的执行权限,否则xcode会告知无法运行</span><br><span class="line">#这个操作是要找到第三方app包里的可执行文件名称，因为info.plist的 <span class="string">&#x27;Executable file&#x27;</span> key对应的是可执行文件的名称</span><br><span class="line">#我们grep 一下,然后取最后一行, 然后以cut 命令分割，取出想要的关键信息。存到APP_BINARY变量里</span><br><span class="line">APP_BINARY=`plutil -convert xml1 -o - $TARGET_APP_PATH/Info.plist|grep -A1 Exec|tail -n1|cut -f2 -d\&gt;|cut -f1 -d\&lt;`</span><br><span class="line"></span><br><span class="line">#这个为二进制文件加上可执行权限 +X</span><br><span class="line">chmod +x <span class="string">&quot;$TARGET_APP_PATH/$APP_BINARY&quot;</span></span><br><span class="line"></span><br><span class="line"># -------------------------------------</span><br><span class="line"># <span class="number">6.</span> 重签第三方app Frameworks下已存在的动态库</span><br><span class="line">TARGET_APP_FRAMEWORKS_PATH=<span class="string">&quot;$TARGET_APP_PATH/Frameworks&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;$TARGET_APP_FRAMEWORKS_PATH&quot;</span> ];</span><br><span class="line">then</span><br><span class="line">#遍历出所有动态库的路径</span><br><span class="line"><span class="keyword">for</span> FRAMEWORK in <span class="string">&quot;$TARGET_APP_FRAMEWORKS_PATH/&quot;</span>*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">echo <span class="string">&quot;FRAMEWORK : $FRAMEWORK&quot;</span></span><br><span class="line">#签名</span><br><span class="line">/usr/bin/codesign --force --sign <span class="string">&quot;$EXPANDED_CODE_SIGN_IDENTITY&quot;</span> <span class="string">&quot;$FRAMEWORK&quot;</span></span><br><span class="line">done</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>运行后完成对其重签名.</p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>对应用的砸壳和重签名仅仅是逆向的入门，后面我们会继续探讨关于逆向的其他技术。再次声明：研究逆向的目的是为了更好的保护我们的应用，而不是用在非法用途上。</p>
<p>参考文献：</p>
<p><a target="_blank" rel="noopener" href="http://blog.cnbang.net/tech/3386/">http://blog.cnbang.net/tech/3386/</a><br><a target="_blank" rel="noopener" href="https://www.i4.cn/news_3.html">https://www.i4.cn/news_3.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.i4.cn/news_detail_1623.html">https://www.i4.cn/news_detail_1623.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/11/14/iOS%E9%80%86%E5%90%91%E4%B9%8B%E4%BB%8E%E7%A0%B8%E5%A3%B3%E5%88%B0%E9%87%8D%E7%AD%BE%E5%90%8D/" data-id="cllniud810009xbexd27v2egl" data-title="iOS-逆向之从砸壳到重签名" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-浅谈UIView的刷新与绘制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/20/%E6%B5%85%E8%B0%88UIView%E7%9A%84%E5%88%B7%E6%96%B0%E4%B8%8E%E7%BB%98%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2021-10-20T12:46:25.000Z" itemprop="datePublished">2021-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/20/%E6%B5%85%E8%B0%88UIView%E7%9A%84%E5%88%B7%E6%96%B0%E4%B8%8E%E7%BB%98%E5%88%B6/">iOS-浅谈UIView的刷新与绘制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://i.loli.net/2021/10/20/UXuCDP245d3NJFp.jpg" alt="topPic"></p>
<h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><p><code>UIView</code>是我们在做iOS开发时每天都会接触到的类，几乎所有跟页面显示相关的控件也都继承自它。但是关于<code>UIView</code>的布局、显示、以及绘制原理等方面笔者一直一知半解，只有真正了解了它的原理才能更好的服务我们的开发。并且在市场对iOS开发者要求越来越高的大环境下，对App页面流畅度的优化也是对高级及以上开发者必问的面试题，这就需要我们要对<code>UIView</code>有更深的认知。</p>
<h3 id="一-UIView-与-CALayer"><a href="#一-UIView-与-CALayer" class="headerlink" title="一.UIView 与 CALayer"></a>一.UIView 与 CALayer</h3><p><code>UIView</code>：一个视图（UIView）就是在屏幕上显示的一个矩形块（比如图片，文字或者视频），它能够拦截类似于鼠标点击或者触摸手势等用户输入。视图在层级关系中可以互相嵌套，一个视图可以管理它的所有子视图的位置,在iOS当中，所有的视图都从一个叫做UIView的基类派生而来，UIView可以处理触摸事件，可以支持基于Core Graphics绘图，可以做仿射变换（例如旋转或者缩放），或者简单的类似于滑动或者渐变的动画。</p>
<p><code>CALayer</code>:<code>CALayer</code>类在概念上和<code>UIView</code>类似，同样也是一些被层级关系树管理的矩形块，同样也可以包含一些内容（像图片，文本或者背景色），管理子图层的位置。它们有一些方法和属性用来做动画和变换。和UIView最大的不同是CALayer不处理用户的交互。</p>
<p><code>CALayer</code>并不清楚具体的响应链（iOS通过视图层级关系用来传送触摸事件的机制），于是它并不能够响应事件，即使它提供了一些方法来判断一个触点是否在图层的范围之内。</p>
<h4 id="1-UIView-与-CALayer的关系"><a href="#1-UIView-与-CALayer的关系" class="headerlink" title="1. UIView 与 CALayer的关系"></a>1. UIView 与 CALayer的关系</h4><p>每一个<code>UIView</code>都有一个<code>CALayer</code>实例的图层属性，也就是所谓的<code>backing layer</code>，视图的职责就是创建并管理这个图层，以确保当子视图在层级关系中添加或者被移除的时候，他们关联的图层也同样对应在层级关系树当中有相同的操作.</p>
<blockquote>
<p>两者的关系：实际上这些背后关联的图层(Layer)才是真正用来在屏幕上显示和做动画，UIView仅仅是对它的一个封装，提供了一些iOS类似于处理触摸的具体功能，以及Core Animation底层方法的高级接口。</p>
</blockquote>
<p>这里引申出面试常问的一个问题：<strong>为什么iOS要基于UIView和CALayer提供两个平行的层级关系呢？为什么不用一个简单的层级来处理所有事情呢？</strong></p>
<p>原因在于要做职责分离（单一职责原则），这样也能避免很多重复代码。在iOS和Mac OS两个平台上，事件和用户交互有很多地方的不同，基于多点触控的用户界面和基于鼠标键盘有着本质的区别，这就是为什么iOS有<code>UIKit</code>和<code>UIView</code>，但是Mac OS有<code>AppKit</code>和<code>NSView</code>的原因。他们功能上很相似，但是在实现上有着显著的区别。把这种功能的逻辑分开并封装成独立的Core Animation框架，苹果就能够在iOS和Mac OS之间共享代码，使得对苹果自己的OS开发团队和第三方开发者去开发两个平台的应用更加便捷。</p>
<h4 id="2-CALayer的一些常用属性"><a href="#2-CALayer的一些常用属性" class="headerlink" title="2. CALayer的一些常用属性"></a>2. CALayer的一些常用属性</h4><h5 id="contents属性"><a href="#contents属性" class="headerlink" title="contents属性"></a><code>contents</code>属性</h5><p><code>CALayer</code>的contents属性可以让我们为layer图层设置一张图片，我们看下它的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/* An object providing the contents of the layer, typically a CGImageRef,</span><br><span class="line"> * but may be something else. (For example, NSImage objects are</span><br><span class="line"> * supported on Mac OS X 10.6 and later.) Default value is nil.</span><br><span class="line"> * Animatable. */</span><br><span class="line"></span><br><span class="line">@property(nullable, strong) id contents;</span><br></pre></td></tr></table></figure>
<p>这个属性的类型被定义为id，意味着它可以是任何类型的对象。在这种情况下，你可以给contents属性赋任何值，你的app都能够编译通过。但是,如果你给contents赋的不是CGImage，那么你得到的图层将是空白的。事实上，你真正要赋值的类型应该是CGImageRef，它是一个指向CGImage结构的指针，UIImage有一个CGImage属性，它返回一个CGImageRef，但是要使用它还需要进行强转:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.contents = (__bridge id _Nullable)(image.CGImage);</span><br></pre></td></tr></table></figure>
<h5 id="contentGravity属性"><a href="#contentGravity属性" class="headerlink" title="contentGravity属性"></a><code>contentGravity</code>属性</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* A string defining how the contents of the layer is mapped into its</span><br><span class="line"> * bounds rect. Options are `center&#x27;, `top&#x27;, `bottom&#x27;, `left&#x27;,</span><br><span class="line"> * `right&#x27;, `topLeft&#x27;, `topRight&#x27;, `bottomLeft&#x27;, `bottomRight&#x27;,</span><br><span class="line"> * `resize&#x27;, `resizeAspect&#x27;, `resizeAspectFill&#x27;. The default value is</span><br><span class="line"> * `resize&#x27;. Note that &quot;bottom&quot; always means &quot;Minimum Y&quot; and &quot;top&quot;</span><br><span class="line"> * always means &quot;Maximum Y&quot;. */</span><br><span class="line"></span><br><span class="line">@property(copy) CALayerContentsGravity contentsGravity;</span><br></pre></td></tr></table></figure>
<p>如果我们为图层<code>layer</code>设置contents为一张图片，那么可以使用这个属性来让图片自适应layer的大小，它类似于UIView的<code>contentMode</code>属性，但是它是一个NSString类型，而不是像对应的UIKit部分，那里面的值是枚举。contentsGravity可选的常量值有以下一些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kCAGravityCenter</span><br><span class="line">kCAGravityTop</span><br><span class="line">kCAGravityBottom</span><br><span class="line">kCAGravityLeft</span><br><span class="line">kCAGravityRight</span><br><span class="line">kCAGravityTopLeft</span><br><span class="line">kCAGravityTopRight</span><br><span class="line">kCAGravityBottomLeft</span><br><span class="line">kCAGravityBottomRight</span><br><span class="line">kCAGravityResize</span><br><span class="line">kCAGravityResizeAspect</span><br><span class="line">kCAGravityResizeAspectFill</span><br></pre></td></tr></table></figure>
<p>例如，如果要让图片等比例拉伸去自适应layer的大小可以直接这样设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.contentsGravity = kCAGravityResizeAspect;</span><br></pre></td></tr></table></figure>
<h5 id="contentsScale属性"><a href="#contentsScale属性" class="headerlink" title="contentsScale属性"></a><code>contentsScale</code>属性</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/* Defines the scale factor applied to the contents of the layer. If</span><br><span class="line"> * the physical size of the contents is &#x27;(w, h)&#x27; then the logical size</span><br><span class="line"> * (i.e. for contentsGravity calculations) is defined as &#x27;(w /</span><br><span class="line"> * contentsScale, h / contentsScale)&#x27;. Applies to both images provided</span><br><span class="line"> * explicitly and content provided via -drawInContext: (i.e. if</span><br><span class="line"> * contentsScale is two -drawInContext: will draw into a buffer twice</span><br><span class="line"> * as large as the layer bounds). Defaults to one. Animatable. */</span><br><span class="line"></span><br><span class="line">@property CGFloat contentsScale</span><br></pre></td></tr></table></figure>
<p><code>contentsScale</code>属性定义了<code>contents</code>设置图片的像素尺寸和视图大小的比例，默认情况下它是一个值为1.0的浮点数。这个属性其实属于支持Retina屏幕机制的一部分，它的值等于当前设备的物理尺寸与逻辑尺寸的比值。如果contentsScale设置为1.0，将会以每个点1个像素绘制图片，如果设置为2.0，则会以每个点2个像素绘制图片。当用代码的方式来处理<code>contents</code>设置图片的时候，一定要手动的设置图层的contentsScale属性，否则图片在Retina设备上就显示得不正确啦。代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layer.contentsScale = [UIScreen mainScreen].scale;</span><br></pre></td></tr></table></figure>
<h5 id="maskToBounds属性"><a href="#maskToBounds属性" class="headerlink" title="maskToBounds属性"></a><code>maskToBounds</code>属性</h5><p><code>maskToBounds</code>属性的功能类似于UIView的<code>clipsToBounds</code>属性，如果设置为YES，则会将超出layer范围的图片进行裁剪.</p>
<h5 id="contentsRect属性"><a href="#contentsRect属性" class="headerlink" title="contentsRect属性"></a><code>contentsRect</code>属性</h5><p><code>contentsRect</code>属性在我们的日常开发中用的不多，它的主要作用是可以让我们显示<code>contents</code>所设置图片的一个子区域。它是单位坐标取值在0到1之间。默认值是{0, 0, 1, 1}，这意味着整个图片默认都是可见的，如果我们指定一个小一点的矩形，比如{0,0,0.5,0.5},那么layer显示的只有图片的左上角，也就是1&#x2F;4的区域。</p>
<blockquote>
<p>实际上给layer的contents赋CGImage的值不是唯一的设置其寄宿图的方法。我们也可以直接用Core Graphics直接绘制。通过继承UIView并实现-drawRect:方法来自定义绘制，如果单独使用<code>CALayer</code>那么可以实现其代理(CALayerDelegate)方法<code>- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx;</code>在这里面进行自主绘制。实际的方法绘制流程我们在下面进行探讨。</p>
</blockquote>
<h3 id="二-View的布局与显示"><a href="#二-View的布局与显示" class="headerlink" title="二.View的布局与显示"></a>二.View的布局与显示</h3><h4 id="1-图像显示原理"><a href="#1-图像显示原理" class="headerlink" title="1.图像显示原理"></a>1.图像显示原理</h4><p>在开始介绍图像的布局与显示之前，我们有必要先了解下图像的显示原理，也就是我们创建一个显示控件是怎么通过CPU与GPU的运算显示在屏幕上的。这个过程大体分为刘六个阶段：<br><img src="https://i.loli.net/2021/09/16/cjktXl87QqGrnRv.png" alt="绘制"></p>
<ul>
<li><strong>布局</strong> ：首先一个视图由CPU进行Frame布局，准备视图(view)和图层(layer)的层级关系,以及设置图层属性（位置，背景色，边框）等等。</li>
<li><strong>显示</strong>：view的显示图层(layer)，它的寄宿图片被绘制的阶段。所谓的寄宿图，就是上面我们提到过的layer所显示的内容。它有两种设置形式：一种是直接设置<code>layer.contents</code>，赋值一个<code>CGImageRef</code>;第二种是重写UIView的<code>drawRect:</code>或<code>CALayerDelegate</code>的<code>drawLayer:inContext:</code>方法，实现自定义绘制。注意：如果实现了这两个方法，会额外的消耗CPU的性能。</li>
<li><strong>准备</strong>：这是Core Animation准备发送数据到渲染服务的阶段。这个阶段主要对视图所用的图片进行解码以及图片的格式转换。PNG或者JPEG压缩之后的图片文件会比同质量的位图小得多。但是在图片绘制到屏幕上之前，必须把它扩展成完整的未解压的尺寸（通常等同于图片宽 x 长 x 4个字节）。为了节省内存，iOS通常直到真正绘制的时候才去解码图片。</li>
<li><strong>提交</strong>：CPU会将处理视图和图层的层级关系打包，通过IPC（内部处理通信）通道提交给渲染服务，渲染服务由OpenGL ES和GPU组成。</li>
<li><strong>生成帧缓存</strong>：渲染服务首先将图层数据交给OpenGL ES进行纹理生成和着色，生成前后帧缓存。再根据显示硬件的刷新频率，一般以设备的VSync信号和CADisplayLink为标准，进行前后帧缓存的切换。</li>
<li><strong>渲染</strong> ：将最终要显示在画面上的后帧缓存交给GPU，进行采集图片和形状，运行变换，应用纹理和混合，最终显示在屏幕上。</li>
</ul>
<blockquote>
<p>注意：当图层被成功打包，发送到渲染服务器之后，CPU仍然要做如下工作：为了显示屏幕上的图层，Core Animation必须对渲染树种的每个可见图层通过OpenGL循环转换成纹理三角板。由于GPU并不知晓Core Animation图层的任何结构，所以必须要由CPU做这些事情。</p>
</blockquote>
<p>前四个阶段都在软件层面处理（通过CPU），第五阶段也有CPU参与，只有最后一个完全由GPU执行。而且，你真正能控制只有前两个阶段：布局和显示，Core Animation框架在内部处理剩下的事务，你也控制不了它。所以接下来我们来重点分析布局与显示阶段。</p>
<h4 id="2-布局"><a href="#2-布局" class="headerlink" title="2.布局"></a>2.布局</h4><p><code>布局</code>：布局就是一个视图在屏幕上的位置与大小。UIView有三个比较重要的布局属性：<code>frame</code>，<code>bounds</code>和<code>center</code>.UIView提供了用来通知系统某个view布局发生变化的方法，也提供了在view布局重新计算后调用的可重写的方法。</p>
<h5 id="layoutSubviews-方法"><a href="#layoutSubviews-方法" class="headerlink" title="layoutSubviews()方法"></a><code>layoutSubviews()</code>方法</h5><p><code>layoutSubviews()</code>:当一个视图“认为”应该重新布局自己的子控件时，它便会自动调用自己的layoutSubviews方法，在该方法中“刷新”子控件的布局.这个方法并没有系统实现，需要我们重新这个方法，在里面实现子控件的重新布局。这个方法很开销很大，因为它会在每个子视图上起作用并且调用它们相应的<code>layoutSubviews</code>方法.系统会根据当前<code>run loop</code>的不同状态来触发<code>layoutSubviews</code>调用的机制,并不需要我们手动调用。以下是他的触发时机：</p>
<ul>
<li>直接修改 view 的大小时会触发</li>
<li>调用<code>addSubview</code>会触发子视图的<code>layoutSubviews</code></li>
<li>用户在 UIScrollView 上滚动（layoutSubviews 会在<code>UIScrollView</code>和它的父<code>view</code>上被调用）</li>
<li>用户旋转设备</li>
<li>更新视图的 constraints<br>这些方式都会告知系统<code>view</code>的位置需要被重新计算，继而会调用<code>layoutSubviews</code>.当然也可以直接触发<code>layoutSubviews</code>的方法。</li>
</ul>
<h5 id="setNeedsLayout-方法"><a href="#setNeedsLayout-方法" class="headerlink" title="setNeedsLayout()方法"></a><code>setNeedsLayout()</code>方法</h5><p><code>setNeedsLayout()</code>方法的调用可以触发<code>layoutSubviews</code>,调用这个方法代表向系统表示视图的布局需要重新计算。不过调用这个方法只是为当前的视图打了一个<code>脏标记</code>，告知系统需要在下一次<code>run loop</code>中重新布局这个视图。也就是调用<code>setNeedsLayout()</code>后会有一段时间间隔，然后触发<code>layoutSubviews</code>.当然这个间隔不会对用户造成影响，因为永远不会长到对界面造成卡顿。</p>
<h5 id="layoutIfNeeded-方法"><a href="#layoutIfNeeded-方法" class="headerlink" title="layoutIfNeeded()方法"></a><code>layoutIfNeeded()</code>方法</h5><p><code>layoutIfNeeded()</code>方法的作用是告知系统，当前打了<code>脏标记</code>的视图需要立即更新，不要等到下一次<code>run loop</code>到来时在更新,此时该方法会立即触发<code>layoutSubviews</code>方法。当然但如果你调用了<code>layoutIfNeeded</code>之后，并且没有任何操作向系统表明需要刷新视图，那么就不会调用<code>layoutsubview</code>.这个方法在你需要依赖新布局，无法等到下一次 <code>run loop</code>的时候会比<code>setNeedsLayout</code>有用。</p>
<h4 id="3-显示"><a href="#3-显示" class="headerlink" title="3.显示"></a>3.显示</h4><p>和布局的方法类似，显示也有触发更新的方法，它们由系统在检测到更新时被自动调用，或者我们可以手动调用直接刷新。</p>
<h5 id="drawRect-方法"><a href="#drawRect-方法" class="headerlink" title="drawRect:方法"></a><code>drawRect:</code>方法</h5><p>在上面我们提到过，如果要设置视图的寄宿图，除了直接设置<code>view.layer.contents</code>属性，还可以自主进行绘制。绘制的方法就是实现view的<code>drawRect:</code>方法。这个方法类似于布局的<code>layoutSubviews</code>方法，它会对当前View的显示进行刷新，不同的是它不会触发后续对视图的子视图方法的调用。跟<code>layoutSubviews</code>一样，我们不能直接手动调用<code>drawRect:</code>方法，应该调用间接的触发方法，让系统在 <code>run loop</code> 中的不同结点自动调用。具体的绘制流程我们在本文第三节进行介绍。</p>
<h5 id="setNeedsDisplay-方法"><a href="#setNeedsDisplay-方法" class="headerlink" title="setNeedsDisplay()方法"></a><code>setNeedsDisplay()</code>方法</h5><p>这个方法类似于布局中的<code>setNeedsLayout</code>。它会给有内容更新的视图设置一个内部的标记，但在视图重绘之前就会返回。然后在下一个<code>run loop</code>中，系统会遍历所有已标标记的视图，并调用它们的<code>drawRect:</code>方法。大部分时候，在视图中更新任何 UI 组件都会把相应的视图标记为“dirty”，通过设置视图“内部更新标记”，在下一次<code>run loop</code>中就会重绘，而不需要显式的调用<code>setNeedsDisplay</code>. </p>
<h3 id="三-UIView的系统绘制与异步绘制流程"><a href="#三-UIView的系统绘制与异步绘制流程" class="headerlink" title="三.UIView的系统绘制与异步绘制流程"></a>三.UIView的系统绘制与异步绘制流程</h3><h4 id="UIView的绘制流程"><a href="#UIView的绘制流程" class="headerlink" title="UIView的绘制流程"></a>UIView的绘制流程</h4><p>接下来我们看下<code>UIView</code>的绘制流程<br><img src="https://i.loli.net/2021/09/16/VSO2jzHUb1tlJPE.png" alt="绘制"></p>
<ul>
<li>UIView调用setNeedsDisplay,这个方法我们已经介绍过了，它并不会立即开始绘制。</li>
<li>UIView 调用<code>setNeedsDisplay</code>，实际会调用其layer属性的同名方法，此时相当于给layer打上绘制标记。</li>
<li>在当前<code>run loop</code> 将要结束的时候，才会调用CALayer的display方法进入到真正的绘制当中</li>
<li>在CALayer的display方法中,会判断<code>layer</code>的代理方法<code>displayLayer:</code>是否被实现，如果代理没有实现这个方法，则进入系统绘制流程，否则进入异步绘制入口。</li>
</ul>
<h4 id="系统绘制"><a href="#系统绘制" class="headerlink" title="系统绘制"></a>系统绘制</h4><p><img src="https://i.loli.net/2021/09/16/oaQ1j8ACevryIXG.png" alt="xitong"></p>
<ul>
<li><p>在系统绘制开始时，在CALayer内部会创建一个绘制上下文，这个上下文可以理解为<code>CGContextRef</code>,我们在<code>drawRect:</code>方法中获取到的<code>currentRef</code>就是它。</p>
</li>
<li><p>然后layer会判断是否有delegate，没有delegate就调用<code>CALayer</code>的<code>drawInContext</code>方法，如果有代理，并且你实现了CALayerDelegate协议中的<code>-drawLayer:inContext:</code>方法或者UIView中的<code>-drawRect:</code>方法（其实就是前者的包装方法），那么系统就会调用你实现的这两个方法中的一个。</p>
<blockquote>
<p>关于这里的代理我的理解是：如果你直接使用的UIView，那么layer的代理就是当前view，你直接实现<code>-drawRect:</code>，然后在这个方法里面进行自主绘制; 如果你用的是单独创建的<code>CALayer</code>，那么你需要设置<code>layer.delegate = self;</code> 当然这里的self就是持有layer的视图或是控制器了，这时你需要实现<code>-drawLayer:inContext:</code>方法，然后在这个方法里面进行绘制。</p>
</blockquote>
</li>
<li><p>最后CALayer把位图传给GPU去渲染，也就是将生成的 bitmap 位图赋值给 layer.content 属性。</p>
<blockquote>
<p>注意：使用CPU进行绘图的代价昂贵，除非绝对必要，否则你应该避免重绘你的视图。提高绘制性能的秘诀就在于尽量避免去绘制。</p>
</blockquote>
</li>
</ul>
<h4 id="异步绘制"><a href="#异步绘制" class="headerlink" title="异步绘制"></a>异步绘制</h4><h5 id="什么是异步绘制"><a href="#什么是异步绘制" class="headerlink" title="什么是异步绘制?"></a>什么是异步绘制?</h5><p>通过上面的介绍我们熟悉了系统绘制流程，系统绘制就是在主线程中进行上下文的创建，控件的自主绘制等，这就导致了主线程频繁的处理UI绘制的工作，如果要绘制的元素过多，过于频繁，就会造成卡顿。而异步绘制就是把复杂的绘制过程放到后台线程中执行，从而减轻主线程负担，来提升UI流畅度。</p>
<h5 id="异步绘制流程"><a href="#异步绘制流程" class="headerlink" title="异步绘制流程"></a>异步绘制流程</h5><p><img src="https://i.loli.net/2021/09/16/xze9EgrtG1c4hVH.png" alt="pic"><br>上面很明显的展示了异步绘制过程：</p>
<ul>
<li>从上图看，异步绘制的入口在<code>layer</code>的代理方法<code>displayLayer:</code>，如果要进行异步绘制，我们必须在自定义view中实现这个方法</li>
<li>在<code>displayLayer:</code>方法中我们开辟子线程</li>
<li>在子线程中我们创建绘制上下文，并借助<code>Core Graphics</code> 相关API完成自主绘制</li>
<li>完成绘制后生成Image图片</li>
<li>最后回到主线程，把Image图片赋值给layer的contents属性。</li>
</ul>
<p>当然我们在日常开发中还要考虑线程的管理与绘制时机等问题，使用第三方库<code>YYAsyncLayer</code>可以让我们把注意力放在具体的绘制上,具体的使用流程可以点<a target="_blank" rel="noopener" href="https://github.com/ibireme/YYAsyncLayer">这里</a>去查看.</p>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四.总结"></a>四.总结</h3><p>我们知道，当我们实现了<code>CALayerDelegate</code>协议中的<code>-drawLayer:inContext:</code>方法或者UIView中的<code>-drawRect:</code>方法，图层就创建了一个绘制上下文，这个上下文需要的大小的内存可从这个算式得出：图层宽X图层高X4字节，宽高的单位均为像素。对于一个在Retina iPad上的全屏图层来说，这个内存量就是 2048X15264字节，相当于12MB内存，图层每次重绘的时候都需要重新抹掉内存然后重新分配。可见使用<code>Core Graphics</code>利用CPU进行绘制代价是很高的，那么如何进行高效的绘图呢？<a target="_blank" rel="noopener" href="https://github.com/qunten/iOS-Core-Animation-Advanced-Techniques">iOS-Core-Animation-Advanced-Techniques</a>给出了答案，我们在日常开发中完全可以使用<code>Core Animation</code>的<code>CAShapeLayer</code>代替<code>Core Graphics</code>进行图形的绘制，具体的方法这里就不介绍了，感兴趣的可以自行去查看。</p>
<p>参考引用：<br><a target="_blank" rel="noopener" href="https://github.com/qunten/iOS-Core-Animation-Advanced-Techniques">iOS-Core-Animation-Advanced-Techniques</a><br><a target="_blank" rel="noopener" href="https://github.com/ibireme/YYAsyncLayer">YYAsyncLayer</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903567610871816">https://juejin.cn/post/6844903567610871816</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/10/20/%E6%B5%85%E8%B0%88UIView%E7%9A%84%E5%88%B7%E6%96%B0%E4%B8%8E%E7%BB%98%E5%88%B6/" data-id="cllniud86000fxbexfxus90rr" data-title="iOS-浅谈UIView的刷新与绘制" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-从客户端到前端入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/18/%E4%BB%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%B0%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2021-09-18T12:46:25.000Z" itemprop="datePublished">2021-09-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/18/%E4%BB%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%B0%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8/">从客户端到前端入门总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一-概述"><a href="#一-概述" class="headerlink" title="一. 概述"></a>一. 概述</h3><p>笔者是客户端研发出身，如果只有一门技术傍身，不足以胜任市场对客户端研发的要求，于是想学习大前端技术栈。但苦于日常工作繁琐，一直没有机会学习（其实就是自身懒惰）。直到工作需要，需要写一个微信小程序，这才下决心学习前端技术。其实如果想入门前端，从微信小程序入手不失为一个好的方法。初次接触微信小程序，它的数据双向绑定机制，让写习惯了客户端的我叹为观止。目前我入门前端的技术路径是：客户端—微信小程序—混合App—H5。一些我自己的经验总结出来，希望对你有所帮助。当然阅读这篇文章的前提是，你已经了解了基本的Html、CSS、JS语法。</p>
<h3 id="二-环境与工具"><a href="#二-环境与工具" class="headerlink" title="二. 环境与工具"></a>二. 环境与工具</h3><h4 id="1-前端环境搭建"><a href="#1-前端环境搭建" class="headerlink" title="1. 前端环境搭建"></a>1. 前端环境搭建</h4><p> 笔者使用的Mac电脑，所有的环境搭建工作都是基于Mac电脑来操作的。首先安装<code>node.js</code>与<code>npm</code>: </p>
<h5 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a><code>node.js</code></h5><p><code>node</code> 是一个基于 V8 引擎的 Javascript 运行环境，它使得 Javascript 可以运行在服务端，直接与操作系统进行交互，与文件控制、网络交互、进程控制等。简单的说node.js就是运行在服务端的 JavaScript。你可能会有疑问，我写前端页面为甚么需要一个运行在服务端的的JS环境。其实我们这里使用<code>node</code>最关键是需要安装<code>npm</code>. </p>
<h5 id="npm"><a href="#npm" class="headerlink" title="npm"></a><code>npm</code></h5><p><code>npm</code>是node.js的包管理工具（package manager），为啥我们需要一个包管理工具呢？因为我们在Web开发时，会用到很多别人写的JavaScript代码。如果我们要使用别人写的某个包，每次都根据名称搜索一下官方网站，下载代码、解压、再使用，非常繁琐。于是一个集中管理的工具应运而生：大家都把自己开发的模块打包后放到npm官网上，如果要使用，直接通过npm安装就可以直接用。他类似于iOS开发中的<code>Cocoapods</code>,Android开发中的<code>Maven</code>,这样就好理解了。<br><code>node</code>下载地址点击<a target="_blank" rel="noopener" href="https://nodejs.org/en/download/">这里</a>,按照步骤安装完成后，终端输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<p>查看安装版本，出现下面的版本号说明安装成功。<br><img src="https://i.loli.net/2021/11/10/YtBAx7QXrlZomia.png" alt="node"></p>
<blockquote>
<p>注意如果提示<code>-bash: node: command not found</code>,说明还需要配置一下环境变量。配置方式也很简单，在Finder中查找文件夹，输入路径<code>/private/etc</code>,找到<code>profile</code>文件，加上一下语句</p>
</blockquote>
<p><img src="https://i.loli.net/2021/11/10/ruPpjdZT36oUQXe.png" alt="pic"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NODE_HOME=<span class="string">&quot;node安装路径(bin路径的父级路径)&quot;</span> </span><br><span class="line">export PATH=$PATH:$NODE_HOME/bin</span><br></pre></td></tr></table></figure>
<p><code>node</code>安装路径(bin路径的父级路径):你可以通过命令<code>which node</code> 命令来查看。例如我的本地路径是<code>/usr/local/bin/node</code>，那么可以这样设置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NODE_HOME=<span class="string">&quot;/usr/local&quot;</span></span><br><span class="line">export PATH=$PATH:$NODE_HOME/bin</span><br></pre></td></tr></table></figure>
<p>重新保存文件后，再次输入<code>node -v</code> 验证一下。下面是一些<code>npm</code>常用命令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本地安装模块</span></span><br><span class="line">npm install &lt;<span class="title class_">Module</span> <span class="title class_">Name</span>&gt;</span><br><span class="line"><span class="comment">// 全局安装模块</span></span><br><span class="line">npm install &lt;<span class="title class_">Module</span> <span class="title class_">Name</span>&gt; -g</span><br><span class="line"><span class="comment">// 搜索模块</span></span><br><span class="line">npm search  &lt;<span class="title class_">Module</span> <span class="title class_">Name</span>&gt;</span><br><span class="line"><span class="comment">// 更新模块</span></span><br><span class="line">npm update &lt;<span class="title class_">Module</span> <span class="title class_">Name</span>&gt;</span><br><span class="line"><span class="comment">//卸载模块</span></span><br><span class="line">npm uninstall &lt;<span class="title class_">Module</span> <span class="title class_">Name</span>&gt;</span><br><span class="line"><span class="comment">// 安装项目的全部依赖</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h5 id="yarn"><a href="#yarn" class="headerlink" title="yarn:"></a><code>yarn</code>:</h5><p><code>yarn</code>是一个由 Facebook 贡献的 Javascript 包管理器。<code>yarn</code>是为了弥补<code>npm</code>的一些缺陷而出现的。在日常开发中你可以使用<code>npm</code>也可以使用<code>yarn</code>进行包的管理，只不过相比<code>npm</code>而言，它的速度更快，并提供了离线模式。关于它我们不会过多的介绍，你可以去它的<a target="_blank" rel="noopener" href="https://yarn.bootcss.com/">中文网站查看</a>.它的安装方式也很简单，直接通过<code>Homebrew</code>进行安装，命令 <code>brew install yarn</code>. 它的一些常用指令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化一个新项目</span></span><br><span class="line">yarn init</span><br><span class="line"><span class="comment">// 添加依赖包</span></span><br><span class="line">yarn add [package]</span><br><span class="line"><span class="comment">// 添加依赖包的某个版本</span></span><br><span class="line">yarn add [package]@[version]</span><br><span class="line"><span class="comment">// 升级依赖包</span></span><br><span class="line">yarn upgrade [package]</span><br><span class="line"><span class="comment">// 移除依赖包</span></span><br><span class="line">yarn remove [package]</span><br><span class="line"><span class="comment">// 安装项目的全部依赖</span></span><br><span class="line">yarn install 或者 yarn</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以在项目中混用<code>yarn</code>与<code>npm</code>,但是最好不要这样。</p>
</blockquote>
<h4 id="2-开发工具选择"><a href="#2-开发工具选择" class="headerlink" title="2. 开发工具选择"></a>2. 开发工具选择</h4><p><img src="https://i.loli.net/2021/11/10/2edVWoarEFI3hqc.png" alt="pic1"><br>前端的开发工具基本就两个选择<code>Visual Studio Code</code> 或者 <code>WebStorm</code>,两者选择哪一个都可以，我个人更喜欢<code>Visual Studio Code</code>,其实选择它最主要原因是免费且开源，而且有强大的插件库。</p>
<p><code>VSCode</code>安装插件：<br><img src="https://i.loli.net/2021/11/10/k7JjQaONiLX3duC.png" alt="chanjian"></p>
<p>选择[扩展]-[搜索插件]-安装即可<br>下面是我使用的一些常用的<code>VSCode</code>插件：</p>
<p>(1) <code>vue vscode snippets</code><br>它是Vue项目代码的骨架插件，例如输入<code>vbase</code>,会直接生成以下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>相似的还有<code>vdata</code>、<code>vmethod</code>、<code>vfor</code>等操作<br>(2) <code>Auto Close Tag</code> 自动闭合HTML标签<br>(3) <code>Auto Rename Tag</code> 修改HTML标签时，自动修改匹配的标签<br>(4) <code>Color Highlight</code> 颜色值在代码中高亮显示<br>(5) <code>HTML CSS Class Completion</code> CSS class提示插件<br>(6) <code>Vetur</code> Vue多功能集成插件，包括：语法高亮，智能提示，emmet，错误提示，格式化，自动补全，debugger。vscode官方钦定Vue插件，Vue开发者必备<br>(7) <code>VSCode-icons</code> 文件图标，方便定位文件<br>(8) <code>Color Highlight</code> 颜色值在代码中高亮显示<br>(9) <code>HTML CSS Support</code> 智能提示CSS类名以及id<br>(10) <code>Beautify</code> 格式化代码工具,美化javascript，JSON，CSS，Sass，和HTML<br>(11) <code>Open in Browser</code> 直接在浏览器中打开你当前的文件</p>
<h3 id="三-Vue项目搭建与开发事项"><a href="#三-Vue项目搭建与开发事项" class="headerlink" title="三.Vue项目搭建与开发事项"></a>三.Vue项目搭建与开发事项</h3><p>目前前端几大主流框架<code>React</code>、<code>Vue</code>、<code>Angular</code>，三个框架各有优劣，个人感觉<code>Vue</code>的入门难度最小，而且有良好的中文教程和广泛的第三方支持，如果要入门前端技术，从<code>Vue</code>入手是比较明智的。</p>
<h4 id="1-Vue项目搭建"><a href="#1-Vue项目搭建" class="headerlink" title="1.Vue项目搭建"></a>1.Vue项目搭建</h4><p> 使用<code>Vue CLI</code>脚手架构建Vue项目</p>
<h5 id="1-使用-npm-或-yarn-全局安装-Vue-CLI"><a href="#1-使用-npm-或-yarn-全局安装-Vue-CLI" class="headerlink" title="(1). 使用 npm 或 yarn 全局安装 Vue CLI"></a>(1). 使用 npm 或 yarn 全局安装 Vue CLI</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br><span class="line"># OR</span><br><span class="line">yarn global add @vue/cli</span><br></pre></td></tr></table></figure>
<p>如果页面报错如下<br><img src="https://i.loli.net/2021/11/10/nNaUIyz4SseQYFj.png" alt="error"><br>说明执行权限不够，可以在在前面加<code>sudo</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g @vue/cli</span><br></pre></td></tr></table></figure>
<p>执行完成后输入命令<code>vue -V</code>查看Vue&#x2F;Cli 版本，出现如下提示说明安装成功。<br><img src="https://i.loli.net/2021/11/10/ST7sfJjglQRiqnH.png" alt="pic"></p>
<h5 id="2-在工程所在目录创建项目"><a href="#2-在工程所在目录创建项目" class="headerlink" title="(2). 在工程所在目录创建项目"></a>(2). 在工程所在目录创建项目</h5><p>执行以下命令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vue create my-project</span><br><span class="line"># OR</span><br><span class="line">vue ui</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>vue create</code> 是使用命令行创建项目，<code>vue ui</code>是以图形化界面创建和管理项目。</p>
</blockquote>
<h5 id="3-配置工程"><a href="#3-配置工程" class="headerlink" title="(3). 配置工程"></a>(3). 配置工程</h5><p>输入创建命令后提示：<br><img src="https://i.loli.net/2021/11/10/EYkWr4fGVaxzKN2.png" alt="pic"></p>
<p>此时会判断你的npm&#x2F;yarn源的连接速度，询问你是否切换至淘宝镜像，我们输入<code>n</code>,继续</p>
<p><img src="https://i.loli.net/2021/11/10/eHkg1rnTScWNwUq.png" alt="pic"></p>
<p>提示：项目是使用默认配置（Vue2还是Vue3 都包含babel, eslint)还是手动选择，我们选择手动配置，继续</p>
<p><img src="https://i.loli.net/2021/11/10/nvDGP8U4YO9o6F1.png" alt="pic"></p>
<ul>
<li>Choose Vue version: 选择Vue的版本 选择</li>
<li>Babel :将脚手架中浏览器不认识的一切东西翻译为浏览器认识的 选择 </li>
<li>TypeScript : 强类型的 JaveScript</li>
<li>Progressive Web App (PWA) Support : 渐进式App，主要用于兼容移动端</li>
<li>Router : Vue 路由管理 选择</li>
<li>Vuex: Vue的状态管理器 选择</li>
<li>CSS Pre-processors : CSS 预处理器，可选择使用 less、sass、stylus等预处理器 选择</li>
<li>Linter &#x2F; Formatter :代码检测和格式化</li>
<li>Unit Testing: 单元测试</li>
<li>E2E Testing: 端到端测试<br>选中好后继续<blockquote>
<p>按方向键是进行上下移动，空格是选中&#x2F;取消，回车是确定当前所选内容，继续下一步操作</p>
</blockquote>
</li>
</ul>
<p><img src="https://i.loli.net/2021/11/10/ZpsCIj1zbF4QdLE.png" alt="pic"></p>
<p>提示：选择Vue版本，我们选择Vue3版本，继续</p>
<p><img src="https://i.loli.net/2021/11/10/f4z6ipqFWZOehrb.png" alt="pic"></p>
<p>提示：路由方式是否使用history模式。一般都是单页面开发不选择history，输入<code>n</code>继续</p>
<p><img src="https://i.loli.net/2021/11/10/FJT42kyLUNSqmBp.png" alt="pic"></p>
<p>提示：选择CSS预处理器</p>
<ul>
<li>node-sass 是自动编译，实时的</li>
<li>dart-sass 需要保存后才会生效</li>
<li>Less 最终会通过编译处理输出css到浏览器，Less 既可以在客户端上运行，也可在服务端运行 (借助 node.js)</li>
<li>Stylus 主要用来给<code>node</code>项目进行CSS预处理支持，Stylus功能上更为强壮，和Js联系更加紧密，可创建健壮的、动态的的CSS</li>
</ul>
<p>我们选择 Sass&#x2F;SCSS (with node-sass)，继续</p>
<p><img src="https://i.loli.net/2021/11/10/cMnHVuzxEFPhrja.png" alt="pic"></p>
<p>提示：Babel, ESLint是使用独立文件，还是在package.json一个文件中保存所有配置信息。选择第一个，继续</p>
<p><img src="https://i.loli.net/2021/11/10/TQdX1ukVg2yMrn5.png" alt="pic"></p>
<p>提示：是否为以后创建的项目保存我们当前所选的这些配置，我们选择<code>否</code>,开始自动创建项目</p>
<p><img src="https://i.loli.net/2021/11/10/aUPtNG51bKImMJB.png" alt="pic"></p>
<p>项目创建完成后，cd到当前工程目录下，执行<code>yarn serve</code>,就可以运行当前项目了。</p>
<p><img src="https://i.loli.net/2021/11/10/Dy6GpxAHu1o7TZS.png" alt="pic"></p>
<p>在浏览器中输入上面的地址就可看到我们当前创建的<code>Vue</code>工程了</p>
<p><img src="https://i.loli.net/2021/11/10/PFRNUhJDEWA1fe9.png" alt="pic"></p>
<p>至此，我们整个工程创建完成。接下来总结一下在移动Web开发中常用的三方库。</p>
<h4 id="2-第三方库使用总结"><a href="#2-第三方库使用总结" class="headerlink" title="2.第三方库使用总结"></a>2.第三方库使用总结</h4><h5 id="1-移动Web布局库"><a href="#1-移动Web布局库" class="headerlink" title="(1).移动Web布局库"></a>(1).移动Web布局库</h5><p>我们在进行移动Web页面开发时，需要对页面进行布局，常用的布局方式有用rem来作单位，配合h5新的meta属性来适配屏幕做开发的，也有直接使用三方库<code>postcss-px-to-viewport</code>来进行页面布局的。我们直接使用第二种方式：<br>使用yarn进行安装,cd 到工程目录后执行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn add -D postcss-px-to-viewport</span><br></pre></td></tr></table></figure>
<p>执行完成后，在<code>postcss.config.js</code>中进行参数配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: &#123;<span class="string">&#x27;postcss-px-to-viewport&#x27;</span>: &#123;</span><br><span class="line">    <span class="attr">unitToConvert</span>: <span class="string">&#x27;px&#x27;</span>,<span class="comment">// 要转化的单位</span></span><br><span class="line">    <span class="attr">viewportWidth</span>: <span class="number">375</span>,<span class="comment">// UI设计稿的宽度</span></span><br><span class="line">    <span class="attr">unitPrecision</span>: <span class="number">5</span>,<span class="comment">// 转换后的精度，即小数点位数</span></span><br><span class="line">    <span class="attr">propList</span>: [<span class="string">&#x27;!*&#x27;</span>],<span class="comment">// 指定转换的css属性的单位，*代表全部css属性的单位都进行转换</span></span><br><span class="line">    <span class="attr">viewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>,<span class="comment">// 指定需要转换成的视窗单位，默认vw</span></span><br><span class="line">    <span class="attr">fontViewportUnit</span>: <span class="string">&#x27;vw&#x27;</span>,<span class="comment">// 指定字体需要转换成的视窗单位，默认vw</span></span><br><span class="line">    <span class="attr">selectorBlackList</span>: [],<span class="comment">// 指定不转换为视窗单位的类名，</span></span><br><span class="line">    <span class="attr">minPixelValue</span>: <span class="number">1</span>,<span class="comment">// 默认值1，小于或等于1px则不进行转换</span></span><br><span class="line">    <span class="attr">mediaQuery</span>: <span class="literal">false</span>,<span class="comment">// 是否在媒体查询的css代码中也进行转换，默认false</span></span><br><span class="line">    <span class="attr">replace</span>: <span class="literal">true</span>,<span class="comment">// 是否转换后直接更换属性值</span></span><br><span class="line">    <span class="attr">exclude</span>: [],<span class="comment">// 设置忽略文件，用正则做目录名匹配</span></span><br><span class="line">    <span class="attr">landscape</span>: <span class="literal">false</span>,<span class="comment">// 是否处理横屏情况</span></span><br><span class="line">    <span class="attr">landscapeUnit</span>: <span class="string">&#x27;vw&#x27;</span>,<span class="comment">//横屏单位</span></span><br><span class="line">    <span class="attr">landscapeWidth</span>: <span class="number">568</span><span class="comment">//横屏宽度</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-UI库"><a href="#2-UI库" class="headerlink" title="(2). UI库"></a>(2). UI库</h5><p><img src="https://i.loli.net/2021/11/10/rkTnEjFPyeB82Al.png" alt="pic"></p>
<p>在进行移动Web开发中，第三方UI库的使用是少不了的，我们最常用的有<code>vant</code>、<code>Element UI</code>等，我们以<code>vant</code>来说明,进行工程目录执行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Vue <span class="number">2</span> 项目，安装 Vant <span class="number">2</span>：</span><br><span class="line">npm i vant -S</span><br><span class="line"></span><br><span class="line"># Vue <span class="number">3</span> 项目，安装 Vant <span class="number">3</span>：</span><br><span class="line">npm i vant@next -S</span><br><span class="line"></span><br><span class="line"># 通过 yarn 安装vant3</span><br><span class="line">yarn add vant@next</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意对于Vue2和Vue3项目引入方式是不一样的，我们是Vue3项目，因此执行<code>npm i vant@next -S</code>或者<code>yarn add vant@next</code></p>
</blockquote>
<p>安装完成后就可以引入组件了，也需要注意，Vue2与Vue3的配置方式也是不同的，具体可以去查看<a target="_blank" rel="noopener" href="https://youzan.github.io/vant/#/zh-CN/quickstart">Vant官网</a>查看，这里不在赘述。</p>
<h5 id="3-网络请求库"><a href="#3-网络请求库" class="headerlink" title="(3). 网络请求库"></a>(3). 网络请求库</h5><p>在项目中进行网络请求时，最常用的第三方库是<code>axios</code>,他的引入方式也很简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install axios</span><br><span class="line">OR </span><br><span class="line">$ yarn add axios</span><br></pre></td></tr></table></figure>
<p>对于Vue2项目而言安装完成后在mian.js中引用axios，并绑到原型链上。使用插件的时候，一般要在入口文件main.js中引入，因为mian.js是项目首先运行的文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> ‘axios’</span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$http</span> = axios</span><br></pre></td></tr></table></figure>
<p>它的用法很简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;/user?ID=12345&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// post 请求</span></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&#x27;/user&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">&#x27;Fred&#x27;</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">&#x27;Flintstone&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="comment">// 执行多个并发请求</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserAccount</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserPermissions</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345/permissions&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.<span class="title function_">all</span>([<span class="title function_">getUserAccount</span>(), <span class="title function_">getUserPermissions</span>()])</span><br><span class="line">  .<span class="title function_">then</span>(axios.<span class="title function_">spread</span>(<span class="keyword">function</span> (<span class="params">acct, perms</span>) &#123;</span><br><span class="line">    <span class="comment">// 两个请求现在都执行完成</span></span><br><span class="line">  &#125;));</span><br></pre></td></tr></table></figure>
<p>但是对于Vue3项目而言，除了引入<code>axios</code>外，还需要引入<code>vue-axios</code>,引入方式：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save axios vue-axios</span><br></pre></td></tr></table></figure>

<p><code>vue-axios</code>是将axios集成到Vue.js的小包装器，可以像插件一样进行安装。在mian.js中引用axios，vue-axios，通过全局方法<code>Vue.use()</code>使用插件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">VueAxios</span> <span class="keyword">from</span> <span class="string">&#x27;vue-axios&#x27;</span><span class="comment">// Vue3 使用 axios 需要配合 vue-axios 一起使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局引入组件</span></span><br><span class="line"><span class="title function_">createApp</span>(<span class="title class_">App</span>).<span class="title function_">use</span>(<span class="title class_">VueAxios</span>, axios).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;App&#x27;</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">axios</span>.<span class="title function_">get</span>(api).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// or</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(api).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-项目中的图片使用"><a href="#4-项目中的图片使用" class="headerlink" title="(4).项目中的图片使用"></a>(4).项目中的图片使用</h5><p>在开发项目时，免不了要使用到图片，目前项目常用的矢量图片库非阿里的<code>iconfont</code>莫属了，它最大的好处是你可以像调整文字一样，设置图片的颜色和大小，而不用担心图片失真问题。它的使用方式也很简单：<br>把我们要使用的图片添加到项目中，然后点击下载到本地<br><img src="https://i.loli.net/2021/11/10/r5BnDHy1XCfsGYE.png" alt="pic"><br>它有三种引入方式分别是：<code>unicode 引用</code>、<code>font-class 引用</code>、<code>symbol 引用</code>,我们只介绍<code>symbol 引用</code>,这也是官方最推荐的引用方式，相比前两种有如下特点：</p>
<ul>
<li>支持多色图标了，不再受单色限制。</li>
<li>通过一些技巧，支持像字体那样，通过font-size,color来调整样式。</li>
<li>兼容性较差，支持 ie9+,及现代浏览器。</li>
<li>浏览器渲染svg的性能一般，还不如png。<br>使用步骤如下：</li>
</ul>
<h6 id="第一步：拷贝下载文件iconfont-js到项目目录"><a href="#第一步：拷贝下载文件iconfont-js到项目目录" class="headerlink" title="第一步：拷贝下载文件iconfont.js到项目目录"></a>第一步：拷贝下载文件<code>iconfont.js</code>到项目目录</h6><p>在需要用到iconfont 的地方引入这个js文件目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;../utils/iconfont&#x27;;</span><br></pre></td></tr></table></figure>
<h6 id="第二步：加入通用css代码（引入一次就行）"><a href="#第二步：加入通用css代码（引入一次就行）" class="headerlink" title="第二步：加入通用css代码（引入一次就行）"></a>第二步：加入通用css代码（引入一次就行）</h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">    <span class="selector-class">.icon</span> &#123;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">1em</span>; <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">       <span class="attribute">vertical-align</span>: -<span class="number">0.15em</span>;</span><br><span class="line">       fill: currentColor;</span><br><span class="line">       <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<h6 id="第三步：挑选相应图标并获取类名，应用于页面："><a href="#第三步：挑选相应图标并获取类名，应用于页面：" class="headerlink" title="第三步：挑选相应图标并获取类名，应用于页面："></a>第三步：挑选相应图标并获取类名，应用于页面：</h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg class=&quot;<span class="attribute">icon</span>&quot; aria-hidden=&quot;true&quot;&gt;</span><br><span class="line">    &lt;use xlink:href=<span class="string">&quot;#icon-xxx&quot;</span>&gt;&lt;/use&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>#icon-xxx</code> 就是你选的图片类名<br>如果要调整大小、颜色、位置等</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">  <span class="attribute">position</span>:relative;</span><br><span class="line">  <span class="attribute">display</span>:inline-block;</span><br><span class="line">  <span class="attribute">top</span>: <span class="built_in">calc</span>(<span class="number">12px</span> + <span class="number">0.15rem</span>);</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：加入的图片最好是去掉填充色的,然后你才能修改颜色,否则设置颜色不生效。</p>
</blockquote>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四.总结"></a>四.总结</h3><p>转眼做前端已经小半年了，越学习越感觉前端内容的复杂，越感觉自己所学知识的浅薄，写这篇文章也算是对这段时间的总结。这篇文章面向的是前端初学者，还请大神勿喷。当然由于作者水平有限，难免出现纰漏，如有问题还请不吝赐教。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://github.com/evrone/postcss-px-to-viewport/blob/HEAD/README_CN.md">postcss-px-to-viewport</a><br><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN">element UI</a><br><a target="_blank" rel="noopener" href="https://www.kancloud.cn/yunye/axios/234845">axios</a><br><a target="_blank" rel="noopener" href="https://www.iconfont.cn/?spm=a313x.7781069.1998910419.d4d0a486a">iocnfont</a><br><a target="_blank" rel="noopener" href="https://v3.cn.vuejs.org/">https://v3.cn.vuejs.org/</a><br><a target="_blank" rel="noopener" href="https://cli.vuejs.org/zh/guide/">https://cli.vuejs.org/zh/guide/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/09/18/%E4%BB%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%B0%E5%89%8D%E7%AB%AF%E5%85%A5%E9%97%A8/" data-id="cllniud84000cxbexfppk09r9" data-title="从客户端到前端入门总结" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-混合开发入门 Vue结合Android:iOS开发仿京东项目App学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/13/%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%20Vue%E7%BB%93%E5%90%88Android:iOS%E5%BC%80%E5%8F%91%E4%BB%BF%E4%BA%AC%E4%B8%9C%E9%A1%B9%E7%9B%AEApp%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-08-13T12:46:25.000Z" itemprop="datePublished">2021-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/13/%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%20Vue%E7%BB%93%E5%90%88Android:iOS%E5%BC%80%E5%8F%91%E4%BB%BF%E4%BA%AC%E4%B8%9C%E9%A1%B9%E7%9B%AEApp%E5%AD%A6%E4%B9%A0/">混合开发入门 Vue结合Android/iOS开发仿京东项目App</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>三端把后台数据进行处理并且优雅的展示给用户<br>混合 Naitive 跟 web 技术进行开发移动应用</p>
</blockquote>
<h3 id="一-目前主流的混合开发方案"><a href="#一-目前主流的混合开发方案" class="headerlink" title="一.目前主流的混合开发方案"></a>一.目前主流的混合开发方案</h3><ol>
<li>faceBook :React、ReactNative</li>
<li>阿里： Week</li>
<li>google：flutter</li>
<li>小程序开发</li>
<li>移动应用混合开发框架</li>
<li>PWA（Porgress Web App）<br>本课程：使用Vue框架 配合 android + iOS 的跨语言通信原理<br>项目效果：<a target="_blank" rel="noopener" href="http://imooc.hybrid.lgdsunday.club/">http://imooc.hybrid.lgdsunday.club/</a><br>需要掌握内容：Scss Vue全家桶 vue-cli3 脚手架、Vue动画 webpack打包、组件化思想、<br>混合开发原理 跨语言通信机制<br>前端项目的部署</li>
</ol>
<h3 id="二-混合开发原理"><a href="#二-混合开发原理" class="headerlink" title="二.混合开发原理"></a>二.混合开发原理</h3><blockquote>
<p>混合开发又叫 Hybrid App,混合了Native 和 web技术进行开发的应用<br>方案：</p>
</blockquote>
<ol>
<li><p>基于 WebView UI (JSBridge)的方案 主流方案：淘宝、微信、饿了么等，使用JSBridge进行与原生的通信,使用webView 进行页面渲染，本课程使用</p>
</li>
<li><p>基于 Native UI （ReactNative、weex）:赋予web原生能力基础上，通过JSBridge 将JS 解析成虚拟节点树，来传递Native ，并使用Native进行渲染</p>
</li>
<li><p>小程序方案（微信、支付宝）：对JSbridge 进行定制，各类JS逻辑与UI渲染层，形成了特殊的开发环境，加强web与Native 的融合程度，提升渲染效果。</p>
</li>
</ol>
<h3 id="三-Hybrid-App-的技术原理"><a href="#三-Hybrid-App-的技术原理" class="headerlink" title="三.Hybrid App 的技术原理"></a>三.Hybrid App 的技术原理</h3><ol>
<li>Hybrid App 的本质<blockquote>
<p>在原生App中 使用 webView作为容器，来承载一个web页面<br>（苹果要求原生页面与web页面的比重最少为2：8）上架结果取决于交互体验。</p>
</blockquote>
</li>
</ol>
<p>Hybrid App的核心：原生与 web端的双向通信层（跨语言解决方案）JSBridge</p>
<p>什么是 JSBridge : 一座用javaScript搭建起来的桥梁，一端是web，一端是Native</p>
<p>目的： 让Native 可以调用web的javaScript 代码，让web可以调用Native 的原生代码<br>展示架构：<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成63）&#x2F;截屏2021-07-28 下午5.23.58.png<br>2. Android 与 Web 通讯</p>
<p>(1). 配置<code>X5WebView</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">private void init (Context context) &#123;</span><br><span class="line">    this.mContext = context;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 基础配置</span><br><span class="line">     */</span><br><span class="line">    initWebViewSettings();</span><br><span class="line">    initWebViewClient();</span><br><span class="line">    initChromeClient();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构建 JSBridge 对象，这里提供的 JSBridge 字符串会被挂载到</span><br><span class="line">     * 网页中的 window 对象下面。</span><br><span class="line">     *</span><br><span class="line">     * 在网页中我们可以使用 window.AndroidJSBridge 拿到这个android 注入到web端的对象</span><br><span class="line">     */</span><br><span class="line">    addJavascriptInterface(</span><br><span class="line">            new MyJaveScriptInterface(mContext, this),</span><br><span class="line">            &quot;AndroidJSBridge&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 对 webview 进行基础配置</span><br><span class="line"> */</span><br><span class="line">private void initWebViewSettings () &#123;</span><br><span class="line">    WebSettings webSettings = getSettings();</span><br><span class="line">    /**</span><br><span class="line">     * 允许加载的网页执行 JavaScript 方法</span><br><span class="line">     */</span><br><span class="line">    webSettings.setJavaScriptEnabled(true);</span><br><span class="line">    /**</span><br><span class="line">     * 设置网页不允许缩放</span><br><span class="line">     */</span><br><span class="line">    webSettings.setSupportZoom(false);</span><br><span class="line">    webSettings.setBuiltInZoomControls(false);</span><br><span class="line">    webSettings.setDisplayZoomControls(true);</span><br><span class="line">    /**</span><br><span class="line">     * 设置网页缓存方式为不缓存，方便我们的调试</span><br><span class="line">     */</span><br><span class="line">    webSettings.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 设置 webviewClient ，如果不进行这层设置，则网页打开默认会使用</span><br><span class="line"> * 系统中的浏览器进行打开，而不是在本 APP 中进行打开。</span><br><span class="line"> */</span><br><span class="line">private void initWebViewClient () &#123;</span><br><span class="line">    setWebViewClient(new WebViewClient()&#123;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 监听网页中的url加载事件</span><br><span class="line"> */</span><br><span class="line">private void initChromeClient () &#123;</span><br><span class="line">    setWebChromeClient(new WebChromeClient()&#123;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * alert()</span><br><span class="line">         * 监听alert弹出框，使用原生弹框代替alert。</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        public boolean onJsAlert(WebView webView, String s, String s1, JsResult jsResult) &#123;</span><br><span class="line"></span><br><span class="line">                AlertDialog.Builder builder = new AlertDialog.Builder(mContext);</span><br><span class="line">                builder.setMessage(s1);</span><br><span class="line">                builder.setNegativeButton(&quot;确定&quot;, null);</span><br><span class="line">                builder.create().show();</span><br><span class="line">            jsResult.confirm();</span><br><span class="line"></span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(2). 初始化使用腾讯X5内核webView控件 <code>X5WebView</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private X5WebView mWebView;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化 webview</span><br><span class="line">     */</span><br><span class="line">    private void init () &#123;</span><br><span class="line">        mWebView = findViewById(R.id.web_view);</span><br><span class="line">        mWebView.loadUrl(Constants.WEB_URL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 原生端调用 web 方法，方法必须是挂载到 web 端 window 对象下面的方法。</span><br><span class="line">     * 调用 JS 中的方法：onFunction1</span><br><span class="line">     */</span><br><span class="line">    public void onJSFunction1 (View v) &#123;</span><br><span class="line">        mWebView.evaluateJavascript(&quot;javascript:onFunction(&#x27;android调用JS方法&#x27;)&quot;, new ValueCallback&lt;String&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onReceiveValue(String s) &#123;</span><br><span class="line">                AlertDialog.Builder builder = new AlertDialog.Builder(MainActivity.this);</span><br><span class="line">                builder.setMessage(s);</span><br><span class="line">                builder.setNegativeButton(&quot;确定&quot;, null);</span><br><span class="line">                builder.create().show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3). 定义一些  Native 的接口供JS 调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">public class MyJaveScriptInterface &#123;</span><br><span class="line"></span><br><span class="line">    private Context mContext;</span><br><span class="line">    private X5WebView mWebView;</span><br><span class="line"></span><br><span class="line">    public MyJaveScriptInterface(Context context, X5WebView x5WebView) &#123;</span><br><span class="line">        this.mContext = context;</span><br><span class="line">        this.mWebView = x5WebView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * window.AndroidJSBridge.androidTestFunction1(&#x27;xxxx&#x27;)</span><br><span class="line">     * 调用该方法，APP 会弹出一个 Alert 对话框，</span><br><span class="line">     * 对话框中的内容为 JavaScript 传入的字符串</span><br><span class="line">     * @param str  android 只能接收基本数据类型参数</span><br><span class="line">     *             ，不能接收引用类型的数据（Object、Array）。</span><br><span class="line">     *             JSON.stringify(Object) -&gt; String</span><br><span class="line">     */</span><br><span class="line">    @JavascriptInterface</span><br><span class="line">    public void androidTestFunction1 (String str) &#123;</span><br><span class="line">        AlertDialog.Builder builder = new AlertDialog.Builder(mContext);</span><br><span class="line">        builder.setMessage(str);</span><br><span class="line">        builder.setNegativeButton(&quot;确定&quot;, null);</span><br><span class="line">        builder.create().show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 调用该方法，方法会返回一个返回值给 javaScript 端</span><br><span class="line">     * @return 返回值的内容为：&quot;androidTestFunction2方法的返回值&quot;</span><br><span class="line">     */</span><br><span class="line">    @JavascriptInterface</span><br><span class="line">    public String androidTestFunction2 () &#123;</span><br><span class="line">        return &quot;androidTestFunction2方法的返回值&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意点：<br>需要安装 npm 跟 node，然后安装 http-server（简单的，命令行 http服务器） : 提供给客户端一个可访问的地址。<br>安装命令<code>npm install http-server -g</code><br>使用：</p>
<ul>
<li>cd index.html 目录下</li>
<li>执行命令<code>http-server</code>,得到运行地址,</li>
<li>拿到地址后 拷贝到浏览器地址，运行（在 android 9.0 的设备上，如果要加载 http 协议的网页，那么需要对 app 进行安全访问设置。））</li>
<li>res&#x2F;xml&#x2F;network_security_config.xml 进行配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;network-security-config&gt;</span><br><span class="line">    &lt;domain-config cleartextTrafficPermitted=&quot;true&quot;&gt;</span><br><span class="line">        &lt;!-- 访问 网页的 IP 地址 --&gt;</span><br><span class="line">        &lt;domain includeSubdomains=&quot;true&quot;&gt;192.168.0.100&lt;/domain&gt;</span><br><span class="line">    &lt;/domain-config&gt;</span><br><span class="line">&lt;/network-security-config&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>IOS 与 Web 通讯</li>
</ol>
<p>原理： 通过webView 组件 向window中 注入JSBridge 对象，web通过这个对象 调用原生的方法。</p>
<ol start="4">
<li>两端与Web通讯的相互对比<br>相同点：</li>
</ol>
<ul>
<li><p>都是通过webView来完成网页的加载的</p>
</li>
<li><p>都是通过向window 注入对象的方式来提供可被web端调用的方法</p>
</li>
<li><p>都可以调用 Web端挂载到window对象下的方法<br>不同点</p>
</li>
<li><p>注入对象的不同：Android 可提供注入对象的名称，IOS 固定为webkit</p>
</li>
<li><p>JS 调用 Native 方式不同：面向 Android 可直接获取注入对象，调用方法。面向 IOS 为相对固定写法（window.webkit.messageHandlers.方法名.postMessage(入参对象)）</p>
</li>
<li><p>传递数据格式不同：面向 Android 只能接受 基本数据 类型数据。面向 IOS 可以接受任意类型数据。</p>
</li>
<li><p>返回值不同：面向 Android 可以直接接收返回值。面向 IOS 没有办法直接获取返回值（可以通过回调方法的方式进行）。</p>
</li>
</ul>
<h3 id="三-Hybrid-App前段基础知识点"><a href="#三-Hybrid-App前段基础知识点" class="headerlink" title="三.Hybrid App前段基础知识点"></a>三.Hybrid App前段基础知识点</h3><h4 id="1-Flex布局"><a href="#1-Flex布局" class="headerlink" title="1. Flex布局"></a>1. Flex布局</h4><p>子项目属性</p>
<ul>
<li>order：项目在容器中的排列顺序，数值越小排名越靠前。</li>
<li>flex-grow：通过一个数值来定义项目的放大比例，默认为0，即存在剩余空间也不进行放大</li>
<li>align-self：使一个项目与其他项目在交叉轴上拥有不同的对齐方式。</li>
</ul>
<h4 id="2-Scss预处理器"><a href="#2-Scss预处理器" class="headerlink" title="2. Scss预处理器"></a>2. Scss预处理器</h4><ul>
<li>scss 是sass 3.0后的称呼，强化了CSS的辅助工具，在Css的语法那个增加了额外的功能（嵌套、变量、运算、函数）</li>
<li>它无法被浏览器直接识别，webpack 已经帮我们转成CSS了。</li>
</ul>
<p>（1）嵌套</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">   &lt;p classs=&quot;box-desc&quot;&gt; 测试scss&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>scss</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.box &#123;</span><br><span class="line">   &amp;-box &#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用 <code>&amp;</code> 符号 表示其直接父标签，&amp; &#x3D;&#x3D; box</p>
<p>(2) 变量</p>
<ul>
<li>用来存储 css 中复用的一些信息<br>定义一个变量：$titleSize:32px; 使用<code>$</code>符号 直接定义变量。在scss 中直接使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;-box &#123;</span><br><span class="line">font-size:$titleSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(3)函数运算</p>
<ul>
<li>允许用户定义函数，计算想要的结果</li>
</ul>
<p>定义函数需要<code>@</code>符号，变量值使用 <code>$</code>标记</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@function doublePx ($px) &#123;</span><br><span class="line">  @return  $px *2 + px;</span><br><span class="line">&#125;</span><br><span class="line">$titleSize: doublePx(16);</span><br></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;-box &#123;</span><br><span class="line">font-size:$titleSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其他关于Scss 去官网查看</p>
<h4 id="3-Webpack-模块打包器"><a href="#3-Webpack-模块打包器" class="headerlink" title="3. Webpack 模块打包器"></a>3. Webpack 模块打包器</h4><ul>
<li>是JavaScript 应用程序的静态模块打包器</li>
<li>把开发时的多个模块合并成一个或者指定的几个文件</li>
</ul>
<p>webpack 官方图<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成75）&#x2F;截屏2021-08-09 下午4.39.05.png</p>
<p>浏览器在加载我们代码文件时，不可能下载多个模块或文件，这样或增加浏览器请求次数，延缓页面加载时间，<br>并且还会有sass文件不被浏览器解析，这时就用到了webpack，用来打包这些资源模块。<br>把开发时候的各种文件打包成有限的几个模块。</p>
<h4 id="4-vue-cli3-脚手架"><a href="#4-vue-cli3-脚手架" class="headerlink" title="4. @vue&#x2F;cli3 脚手架"></a>4. @vue&#x2F;cli3 脚手架</h4><ul>
<li>基于webpack 构建的，带有基础webpack配置脚手架的工具</li>
<li>可以用 vue&#x2F;cli 快速生成一个 Vue 项目的基础结构</li>
</ul>
<p>使用  @vue&#x2F;cli3</p>
<ul>
<li>npm 安装 @vue&#x2F;cli3：(sudo) npm install @vue&#x2F;cli -g 全局安装</li>
<li>vue create 项目名称，直接创建Vue 项目<br>实际安装创建<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成76）&#x2F;截屏2021-08-09 下午4.49.12.png<br>(1) 输入命令行后创建Vue项目</li>
<li>默认配置</li>
<li>手动选择配置<br>(2)选择手动<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成77）&#x2F;截屏2021-08-09 下午4.50.27.png</li>
</ul>
<p>手动选择项目所依赖的模块(按空格选择)</p>
<ul>
<li>’Babel‘:必选 帮助我们把JS代码降级，可以把ES6代码编译成ES5</li>
<li>’TypeScript‘:  不选</li>
<li>’PWA‘ ： Processive Web App Support：渐进式的增强Web应用 不选</li>
<li>’Router‘ : Vue 中的路由 选择</li>
<li>’Vuex‘ ： Vue 中的状态管理器 选择</li>
<li>’CSS Pre-process‘ : 选择</li>
<li>‘Linter &#x2F; Formatter’:代码风格检测器 保留 选择</li>
<li>’Unit Testing‘ 测试相关</li>
<li>‘E2E Testing’ 测试相关</li>
</ul>
<p>(3) 是否选择<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成78）&#x2F;截屏2021-08-09 下午4.56.09.png<br>’Use history mode for routur?‘ 选择Y，生产环境下配置争取的服务器地址</p>
<p>（4）选择代码风格的配置 选择 ’ESlint+Standard config‘<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成79）&#x2F;截屏2021-08-09 下午4.59.11.png</p>
<p>(5) 选择代码检测，是否在保存 还是 提交的时候，选择保存时候<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成80）&#x2F;截屏2021-08-09 下午5.00.28.png</p>
<p>（6）<br>这些依赖工具的配置文件 是希望各自拥有一个 还是 统一处理，选择第一个<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成82）&#x2F;截屏2021-08-09 下午5.01.25.png<br>（7）是否保存为 预设配置，Y、N</p>
<p>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成83）&#x2F;截屏2021-08-09 下午5.02.21.png</p>
<p>预设可添加名字<br>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成84）&#x2F;截屏2021-08-09 下午5.03.11.png</p>
<p>（8）cd 到项目下， 通过’npm  run serve‘ 进行启动项目，根据路径进行访问。一个本地路径，一个局域网路径</p>
<p>&#x2F;var&#x2F;folders&#x2F;75&#x2F;0xr1m5c13f7b5qsm139djwjmwm3q06&#x2F;T&#x2F;TemporaryItems&#x2F;（screencaptureui正在存储文稿，已完成85）&#x2F;截屏2021-08-09 下午5.05.02.png</p>
<h4 id="5-rem兼容性设置"><a href="#5-rem兼容性设置" class="headerlink" title="5.rem兼容性设置"></a>5.rem兼容性设置</h4><p>我们想要一套代码设配多种不同像素的设备。<br>达到效果：</p>
<blockquote>
<p>相同的文字、图片大小，在不同的设备上应该展示不同的像素值</p>
</blockquote>
<p>使用 rem：相对于<html>标签 fontSize 大小的单位</p>
<ol>
<li>根据屏幕宽度定义根元素fontSize大小</li>
<li>定义一个函数，把像素转换我rem。 输入像素，转换为rem</li>
</ol>
<p>fontSize 计算规则</p>
<ol>
<li>动态计算fontSize 大小<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// ES6 语法，直接原先需要在支持ES6 的浏览器中，比如chrome</span><br><span class="line">// 定义最大的 fontSize，避免屏幕分辨率过大导致 fonSize 过大</span><br><span class="line">    const MAX_FONT_SIZE = 42;</span><br><span class="line">    //监听 HTML文档被解析完成的事件</span><br><span class="line">    document.addEventListener(&#x27;DOMContentLoaded&#x27;,() =&gt; &#123;</span><br><span class="line">    // 获取 html 标签</span><br><span class="line">const html = document.querySelector(&#x27;html&#x27;);</span><br><span class="line">// 屏幕的宽度除以10，获取根元素 fontSize 标准</span><br><span class="line">let fontSize = window.innerWidth / 10;</span><br><span class="line">// 获取到的fontSize 标准不允许超过我们定义的最大值</span><br><span class="line">fontSize = fontSize &gt; MAX_FONT_SIZE ? MAX_FONT_SIZE : fontSize;</span><br><span class="line">// 定义根元素 fontSize 的大小</span><br><span class="line">html.style.fontSize = fontSize + &#x27;px&#x27;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>函数转换 px -&gt; rem<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* 如果 设计图以 iPhone 6、6S、7、8  375* 667逻辑像素为设计基础</span><br><span class="line">            定义预计根元素 fontSize */</span><br><span class="line">            $rootFontSize: 375 / 10;</span><br><span class="line">            /* 定义像素转换为 rem 函数 */</span><br><span class="line">            @function px2rem ($px) &#123;</span><br><span class="line">                @return $px / $rootFontSize + rem;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>npm  run serve 后报错：</p>
<blockquote>
<p>报错 Failed to resolve loader: sass-loader 。webpack 需要使用这个sass-loader 工具去转换scss文件。</p>
</blockquote>
<p>安装：<code>npm install sass-loader node-sass --save-dev</code>  安装 <code>sass-loader</code> 与 <code>node-sass</code><br> <code>--save-dev</code> :开发环境</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/08/13/%E6%B7%B7%E5%90%88%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%20Vue%E7%BB%93%E5%90%88Android:iOS%E5%BC%80%E5%8F%91%E4%BB%BF%E4%BA%AC%E4%B8%9C%E9%A1%B9%E7%9B%AEApp%E5%AD%A6%E4%B9%A0/" data-id="cllniud88000ixbex1w7ce5ir" data-title="混合开发入门 Vue结合Android/iOS开发仿京东项目App" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Web开发常用布局方式总结" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/05/Web%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/" class="article-date">
  <time class="dt-published" datetime="2021-08-05T12:46:25.000Z" itemprop="datePublished">2021-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/05/Web%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/">Web开发常用布局方式总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://i.loli.net/2021/07/30/dJZ16rK9hPsRuYa.png" alt="网络图片"></p>
<h3 id="一-概述"><a href="#一-概述" class="headerlink" title="一.概述"></a>一.概述</h3><p>无论是前端还是客户端开发都离不开页面的展示，而页面是由布局和各种组件构成的。布局好比是建筑里的框架，而组件则相当于建筑里的砖瓦。组件按照布局的要求依次排列，就组成了用户所看见的界面。比如Android开发者常用的布局方式有:线性布局(LinearLayout)、相对布局(RelativeLayout)、绝对布局(AbsoluteLayout)、网格布局(GridLayout)等，IOS开发者常用的布局方式：手写Frame、自动布局(AutoLayout)、xib、storyboard等方式，我们这里主要介绍前端的布局方式。虽然目前大多数网站的构建都是通过成熟的框架搭建的，但是作为前端开发的基础，学习了解一下布局还是很有必要的。</p>
<blockquote>
<p>页面布局(Layout):就是对页面的文字、图形或表格进行排布、设计.                                                                                               — 知乎</p>
</blockquote>
<p>研究布局的目的是让我们的页面尽可能的还原UI设计给我们的设计图，适配各种尺寸的屏幕，使其在各种尺寸屏幕上能很好地显示出我们的视图。<br><br>我们来看下我们Web开发中常用的几种布局类型：</p>
<h3 id="二-布局类型"><a href="#二-布局类型" class="headerlink" title="二.布局类型"></a>二.布局类型</h3><h4 id="1-普通流布局"><a href="#1-普通流布局" class="headerlink" title="1. 普通流布局"></a>1. 普通流布局</h4><p>这是页面默认布局的方式 ，每个元素都有默认空间，每个元素都是在父元素的左上角出现的,页面中的块元素都是按照从上到下的方式出现，每个块元素独占一行,页面中行内元素都是从左到右的方式排列.<br>每个元素都有一个默认的 <code>display</code> 值，这与元素的类型有关。对于大多数元素它们的默认值通常是 <code>block</code> 或 <code>inline</code> 。一个 <code>block</code> 元素通常被叫做块级元素。一个 <code>inline</code> 元素通常被叫做行内元素。比如 <code>div</code> 是一个标准的块级元素,页面在进行渲染时候，遇到块级元素会另起一行，而行内元素会在当前行进行展示。举个简单的例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">html</span><br><span class="line">&lt;head&gt;</span><br><span class="line">      &lt;title&gt;标题&lt;/title&gt;</span><br><span class="line">      &lt;style&gt;</span><br><span class="line">          * &#123;</span><br><span class="line">              padding: 0;</span><br><span class="line">              margin: 0;</span><br><span class="line">              box-sizing: border-box;</span><br><span class="line">          &#125;</span><br><span class="line">          body &#123;</span><br><span class="line">              background-color: white;</span><br><span class="line">          &#125;</span><br><span class="line">          div &#123;</span><br><span class="line">              border: 1px solid red;</span><br><span class="line">          &#125;</span><br><span class="line">          span &#123;</span><br><span class="line">              border: 1px solid green;</span><br><span class="line">          &#125;</span><br><span class="line">          body :nth-child(4) &#123;</span><br><span class="line">              display: inline-block;</span><br><span class="line">              background-color:salmon;</span><br><span class="line">          &#125;</span><br><span class="line">      &lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">      &lt;div&gt;这是一个div块元素&lt;/div&gt;</span><br><span class="line">      &lt;span&gt;这是一个行内元素&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;这是另一个行内元素&lt;/span&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          这是行内块元素</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div&gt;这是还是一个div块元素&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/07/17/br5YuPDcfsxNqCQ.png" alt="图片1"></p>
<ul>
<li>可以看到<code>div</code>元素是单独占一行的，而行内元素<code>span</code>不会换行。其他常用的块级元素包括 <code>p</code>、 <code>h1——h6</code>、<code>form</code> 以及Html5中的新元素： <code>header</code> 、 <code>footer</code> 、 <code>section</code> 等等。常用的行内元素<code>a</code>、<code>input</code>、<code>img</code>、<code>label</code>等。</li>
<li><code>display</code> 的取值除了为<code>block</code> 跟<code>inline</code> 外还可以取值<code>inline-block</code>,它表示行内块元素，如果一个块元素的display属性取值为inline-block，那么他就不在换行，比如我们这里的第二个div元素。如果一个行内元素display取值为inline-block那么它就具有了块元素的一些特性，例如我们可以改变它的尺寸。</li>
<li>另一个常用的<code>display</code>值是 <code>none</code>。一些特殊元素的默认<code>display</code> 值是它，例如 <code>script</code> 。 <code>display:none</code> 通常被 JavaScript 用来在不删除元素的情况下隐藏或显示元素。它和 <code>visibility</code> 属性不一样。把 <code>display</code> 设置成 <code>none</code> 元素不会占据它本来应该显示的空间，但是设置成 <code>visibility: hidden;</code> 还会占据空间。</li>
<li><code>display</code> 还有一些其他取值，可以看<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/display">这里</a></li>
</ul>
<h4 id="2-浮动布局"><a href="#2-浮动布局" class="headerlink" title="2. 浮动布局"></a>2. 浮动布局</h4><p>属性：<code>float</code><br>取值：<br><code>none</code>: 默认，无浮动<br><code>left</code>: 左浮动，让元素在父元素的左边，或者挨着已有的浮动元素<br><code>right</code>: 右浮动,让元素在父元素的右边，或者挨着已有的浮动元素<br>我们看下它如何使用,正常情况下的布局：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>正常布局<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>:  <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: wheat;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.left</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: rosybrown;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.right</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: saddlebrown;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.last</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;last&quot;</span>&gt;</span>后面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/07/17/Bep5WITECQFUHLX.png" alt="图片2"></p>
<p>现在我们分别给<code>.left</code> 跟<code>.right</code> 添加浮动属性,添加下面代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: saddlebrown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/07/17/wuzxBqjHRVLFAhc.png" alt="图片3"></p>
<p>看下页面效果，左右两个模块倒是符合我们的预期，但是<code>container</code>元素的背景没有了，我们检查下元素，可以看到<code>container</code>的高度变成了0，<code>last</code>只展示了文字，背景没有了。这就说到float属性的特点了：</p>
<p>特点：</p>
<ul>
<li>元素将被排除在文档流之外，不在占据页面的空间。其他未浮动元素将会向前占位。</li>
<li>浮动元素会 停靠在父元素的 左边或者 右边，或者其他浮动元素的边缘上。</li>
<li>文本行内文字都是采用环绕方式排列的，不会被浮动元素压地下，而是会巧妙的避开浮动元素。<br>解决浮动带来的影响<br>(1)可以直接设置父元素的高度，比如直接添加<code>height:300px;</code><br>(2)为父元素设置<code>overflow</code> 取值 <code>hidden</code>或者<code>auto</code><br>(3)使用<code>clear</code>属性，取值<code>both</code>可以解决左右浮动带来的影响。这里注意：这里要给<code>contariner</code>容器添加子元素<br>(4)在容器内添加一个CSS伪元素，并将其clear属性设置为both。<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;clear:both&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
或者是<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="attribute">display</span>: table;</span><br><span class="line">  <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
看下效果，符合我们的预期了<br><img src="https://i.loli.net/2021/07/17/28EibO71xIPY3lR.png" alt="tupian3"></li>
</ul>
<blockquote>
<p>实际上浮动最主要的作用:是可以使块级元素在一行内显示。并且可以使文字可以环绕浮动元素进行排列。</p>
</blockquote>
<h4 id="3-定位布局"><a href="#3-定位布局" class="headerlink" title="3. 定位布局"></a>3. 定位布局</h4><ul>
<li>属性：<code>position</code>，默认值:<code>static</code>,根据其取值的的不同分为:<br>相对定位：<code>position:relative</code>;<br>绝对定位：<code>position:absolute</code>;<br>固定定位:<code>position:fixed</code>;<br>只要是元素的<code>position</code> 属性取值不为<code>static</code>,那么这个元素就被称为已定位元素。这里需要注意，后面在介绍这几种定位时，已定位元素会对他本身的位置有所影响。</li>
<li>偏移属性： <code>top</code>、<code>left</code>、<code>right</code>、<code>bottom</code>，取值是以px为单位的数值,取值可以是正数也可以是负数,分别对应不同方向的偏移<br><code>top</code>:取值为正，向下移动，取值为负数，向上移动<br><code>bottom</code>:取值为正，向上移动，负值 向下移动。<br><code>left</code>:取值为正，右移动，负值 左移动<br><code>right</code>:取值为正 左移动，负值 右移动</li>
</ul>
<p>如何记忆：可以参考下面的图例，取值为正数时，都是向元素的内部进行靠拢，取值为负数时候都是向远离元素的位置移动。<br><img src="https://i.loli.net/2021/07/17/1O7TKfMU9tA4xIk.png" alt="tupian4"></p>
<h5 id="1-相对定位relative"><a href="#1-相对定位relative" class="headerlink" title="(1)相对定位relative"></a>(1)相对定位<code>relative</code></h5><p>元素相对于他原来的位置进行距离偏移<br><br>用法：<code>position:relative;</code>配合 top、left、right、bottom进行位置的微调<br>我们还是以上面的正常文档流布局为例,现在我们想让右侧块跟左侧块在一行显示，并且在左侧块的右边显示，实现下图的效果<br><img src="https://i.loli.net/2021/07/17/ekcMd5yK9CYXmiF.png" alt="pic5"></p>
<p>那么我们可以设置<code>.right</code>的布局如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">100px</span>; </span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50px</span>; </span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: saddlebrown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-绝对定位absolute"><a href="#2-绝对定位absolute" class="headerlink" title="(2)绝对定位absolute"></a>(2)绝对定位<code>absolute</code></h5><blockquote>
<p>元素会相对于离他最近的已定位的(三种定位方式的一中)祖先元素去实现位置的初始化跟偏移,祖先元素就是本元素的父级元素。如果没有已定位的祖先元素，那就相对于body去实现位置的初始化跟偏移。绝对定位元素会变成块级元素。</p>
</blockquote>
<p>用法：<code>position:absolute;</code>配合 top、left、right、bottom进行位置的微调<br>现在我们想让右侧块块叠加在左侧块之上显示，实现下图的效果；<br><img src="https://i.loli.net/2021/07/17/3c1Qj6TrxStGFwp.png" alt="pic7"><br>那么我们可以设置<code>.right</code>的布局如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: saddlebrown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以看到当子元素元素的postion属性设置为<code>absolute</code>后 原先父元素的高度变化了，说明<code>.right</code>脱离了文档流，不再占据页面空间。注意这里<code>top: 50px;</code>的改变是相对于body改变的，其初始化位置为文档流的左上角，因为其父元素<code>container</code>并不是已定位的元素。</li>
</ul>
<h5 id="3-固定定位fixed"><a href="#3-固定定位fixed" class="headerlink" title="(3)固定定位fixed"></a>(3)固定定位<code>fixed</code></h5><p>固定定位（position:fixed）元素会相对于视窗来定位，这意味着即便页面滚动，它还是会停留在相同的位置。和 relative 一样， top 、 right 、 bottom 和 left 属性都可用。</p>
<p>我们还是拿上面的例子，我们将<code>last</code>固定在页面的右下角，设置<code>last</code>的CSS如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.last</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">70px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">75px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意<code>position:fixed</code>的元素也会脱离文档流。</li>
</ul>
<h5 id="4-定位补充"><a href="#4-定位补充" class="headerlink" title="(4)定位补充"></a>(4)定位补充</h5><blockquote>
<p>一旦将元素设置 已定位元素(position的取值不为static)，元素可能会出现堆叠效果，堆叠效果的属性：<code>z-index</code>,取值：无单位的数子，数子越大越靠上</p>
</blockquote>
<p>我们以上面绝对定位的例子来说明，设置了<code>right</code>为绝对定位后,<code>right</code>在<code>left</code>的上面，此时如果想让<code>left</code>在上,<code>right</code>在下，实现下面效果<br><img src="https://i.loli.net/2021/07/17/HRLazrMiAbXlwNG.png" alt="pic8"></p>
<p>设置<code>left</code>的CSS代码</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">10</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：只有已经定位的元素可以使用z-index，如果不设置<code>position: relative;</code>是没有效果的，父子元素之间无法调整堆叠效果，子元素压在父上。</li>
</ul>
<h4 id="4-flex布局"><a href="#4-flex布局" class="headerlink" title="4. flex布局"></a>4. flex布局</h4><p>flex布局又叫弹性布局,是一种为一维布局而设计的布局方法。一维的意思是你希望内容是按行或者列来布局。你可以使用<code>display:flex</code>来将元素变为弹性布局。我们直接看例子：<br>实现7个item横向排列<br><img src="https://i.loli.net/2021/07/19/lxgMDecCXfFQ9rY.gif" alt="图片"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>flex布局2<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>:  <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: flex-start;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: flex-end;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: wheat;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">border</span>: <span class="number">1px</span> solid royalblue;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">line-height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item6</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-class">.item7</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">flex</span>: <span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item0 item&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item1 item&quot;</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item2 item&quot;</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item3 item&quot;</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item4 item&quot;</span>&gt;</span>item4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item5 item&quot;</span>&gt;</span>item5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item6 item&quot;</span>&gt;</span>item6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item7 item&quot;</span>&gt;</span>item7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的代码基本基本涵盖了我们常用的flex的属性</p>
<ul>
<li><p><code>display:flex</code>: 设置<code>container</code>容器为弹性布局</p>
</li>
<li><p><code>flex-direction</code>:决定主轴的方向,项目横向或是纵向排列<br>取值：row | row-reverse | column | column-reverse;<br><code>row</code>（默认值）：主轴为水平方向，起点在左端。<br><code>row-reverse</code>：主轴为水平方向，起点在右端。<br><code>column</code>：主轴为垂直方向，起点在上沿。<br><code>column-reverse</code>：主轴为垂直方向，起点在下沿。</p>
</li>
<li><p><code>justify-content</code>: 定义Item在主轴上如何对齐。<br>取值：flex-start | flex-end | center | space-between | space-around;<br><code>flex-start</code>（默认值）：左对齐<br><code>flex-end</code>：右对齐<br><code>center</code>： 居中<br><code>space-between</code>：两端对齐，项目之间的间隔都相等。<br><code>space-around</code>：每个项目两侧的间隔相等。所以，项目之间的间隔比项目与边框的间隔大一倍。</p>
</li>
<li><p><code>align-items</code>:定义Item在交叉轴上如何对齐。<br>取值：align-items: flex-start | flex-end | center;<br><code>flex-start</code>：交叉轴的起点对齐。<br><code>flex-end</code>：交叉轴的终点对齐。<br><code>center</code>：交叉轴的中间点对齐。</p>
</li>
<li><p><code>flex-wrap</code>:一条轴线上放不下，决定其是否换行<br>取值: nowrap(不换行) | wrap(换行)</p>
</li>
<li><p>flex 属性：flex属性是<code>flex-grow</code>, <code>flex-shrink</code> 和 <code>flex-basis</code>的简写，默认值为0 1 auto。<br><code>flex-grow</code>: 属性定义项目的放大比例，默认为0，即如果存在剩余空间，也不放大。 取值越大，占用剩余空间越大。<br><code>flex-shrink</code>: 属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。<br><code>flex-basis</code>:属性指定了flex元素在主轴方向上的初始大小</p>
</li>
</ul>
<p>这里设置<code>item6</code> 与 <code>item7</code> 的flex为1和2，表示当前轴剩余的空间item6占1&#x2F;3,item7占2&#x2F;3.</p>
<p>我们访问<a target="_blank" rel="noopener" href="https://caniuse.com/?search=gri">caniuse</a>查看浏览器对它支持情况,可以看到目前绝大多数浏览器是支持这个属性的。<br><img src="https://i.loli.net/2021/07/17/CRA5flzGYXjuh8L.png" alt="pic9"><br>更多的关于flex的属性可以查看这里：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html">flex布局</a></p>
<h4 id="5-grid布局"><a href="#5-grid布局" class="headerlink" title="5. grid布局"></a>5. grid布局</h4><p>grid布局又叫网格布局,讲到布局，我们就会想到 <code>flex</code>布局，甚至有人认为既然有<code>flex</code>布局了，似乎没有必要去了解<code>Grid</code>布局。但<code>flex</code>布局和<code>Grid</code>布局有实质的区别，那就是<code>flex</code> 布局是一维布局，<code>Grid</code>布局是二维布局。<code>flex</code>布局一次只能处理一个维度上的元素布局，一行或者一列。<code>Grid</code>布局是将容器划分成了“行”和“列”，产生了一个个的网格，我们可以将网格元素放在与这些行和列相关的位置上，从而达到我们布局的目的。看下面的例子<br><img src="https://i.loli.net/2021/07/17/oMTE3SOqPmNGD8b.gif" alt="图片"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>grid2布局<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>:  <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: grid;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(<span class="number">4</span>,<span class="number">1</span>fr);</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-auto-rows</span>: <span class="built_in">minmax</span>(<span class="number">100px</span>,auto);</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: skyblue;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">1px</span> solid cyan;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item0</span>&#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: slateblue;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">1</span>/<span class="number">2</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">1</span>/<span class="number">5</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item1</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: slategray;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item2</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: springgreen;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">2</span>/<span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item3</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: teal;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">3</span>/<span class="number">4</span>;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item4</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: wheat;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">2</span>/<span class="number">4</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">4</span>/<span class="number">5</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item5</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#BEE7E9</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">3</span>/<span class="number">4</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">1</span>/<span class="number">3</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item6</span>&#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#E6CEAC</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">3</span>/<span class="number">4</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">3</span>/<span class="number">4</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.item7</span>&#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#ECAD9E</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-row</span>: <span class="number">4</span>/<span class="number">5</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">grid-column</span>: <span class="number">1</span>/<span class="number">5</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item0 item&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item1 item&quot;</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item2 item&quot;</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item3 item&quot;</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item4 item&quot;</span>&gt;</span>item4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item5 item&quot;</span>&gt;</span>item5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item6 item&quot;</span>&gt;</span>item6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item7 item&quot;</span>&gt;</span>item7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面的代码基本基本涵盖了我们常用的grid的属性</p>
<ul>
<li><code>display: grid </code>: 设置<code>container</code>容器为网格布局</li>
<li><code>grid-template-columns</code>与<code>grid-template-rows</code>:分别设置网格的列宽与行高，取值有多中形式例如：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 声明了三列，宽度分别为 200px 100px 200px */</span></span><br><span class="line"><span class="attribute">grid-template-columns</span>: <span class="number">200px</span> <span class="number">100px</span> <span class="number">200px</span>;</span><br><span class="line"><span class="comment">/*  声明了两行，行高分别为 50px 50px  */</span></span><br><span class="line"><span class="attribute">grid-template-rows</span>: <span class="number">50px</span> <span class="number">50px</span>;</span><br></pre></td></tr></table></figure>
或者是这样像我们的例子中使用<code>repeat()</code>函数进行赋值，该函数接受两个参数，第一个参数是重复的次数，第二个参数是所要重复的值。我们的例子中<code>grid-template-columns: repeat(4,1fr);</code> 出现了一个新的单位<code>fr</code>，<code>fr</code>代表网格容器中可用空间的一等份，类似于flex的<code>flex-grow</code>。如果这样取值<code>grid-template-columns: 200px 1fr 2fr</code> 表示第一个列宽设置为 200px，后面剩余的宽度分为两部分，宽度分别为剩余宽度的 1&#x2F;3 和 2&#x2F;3。</li>
<li><code>grid-auto-rows</code> 与 <code>grid-auto-columns</code>: 表示超出我们没有定义网络的宽度跟高度取值。例如上面的例子<code>grid-template-columns: repeat(4,1fr);</code> 我们只是显示的指定了列的个数，以及宽度，并没有指定行高，那么grid会取<code>grid-auto-rows: minmax(100px,auto);</code>的值来作为行高。<code>minmax()</code>函数产生一个长度范围，表示长度就在这个范围之中都可以应用到网格项目中，它接受两个参数，分别为最小值和最大值。</li>
<li><code>grid-gap</code>: 表示网格间的间隙大小，也可以单独这行跟列的间隙：<code>grid-row-gap</code> 属性、<code>grid-column-gap</code>.</li>
<li><code>grid-row</code>和 <code>grid-column</code>: 表示单个项目的四个边框的起始网格线跟结束网格线，从而确定单个网格的大小跟位置。我们将项目化分为四行四列的网格，那么横向网格线为从1-5，纵向网格线也为从1-5，这里item0的取值<code>grid-row: 1/2;grid-column: 1/5;</code>表示：行高从第一根网格线到第二跟网格线，列宽度：从第一根网格线到第五根网格线。</li>
</ul>
<p>看下它的浏览器支持情况,总体兼容性还不错，但在IE10以下不支持.<br><img src="https://i.loli.net/2021/07/17/iVIE5vw3Pzbcog6.png" alt="pic10"></p>
<p>更多的关于grid的属性可以查看这里：<a target="_blank" rel="noopener" href="https://shanyue.tech/post/Grid-Guide/">grid布局</a></p>
<h3 id="三、布局的应用"><a href="#三、布局的应用" class="headerlink" title="三、布局的应用"></a>三、布局的应用</h3><p>通过上面的学习我们了解了Web开发常用的几种布局方式，下面我们将这些布局方式来应用到我们的实际开发中，我们就以最常见的几种布局方式来说明</p>
<h4 id="1-双栏目布局实现"><a href="#1-双栏目布局实现" class="headerlink" title="1.双栏目布局实现"></a>1.双栏目布局实现</h4><p>双栏布局在我么的Web开发中间经常用到，例如下面的CSDN的内容详情页。主要特点：一侧栏固定，另一侧栏宽度自适应。<br><img src="https://i.loli.net/2021/07/17/3LVDjbcOHaA6pJr.gif" alt="pic21"><br>我们使用<code>float+margin</code>的方式去实现，左侧栏浮动，右侧设置左外边距。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>双栏目布局<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            * &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>:  <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.left</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">float</span>: left;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: rosybrown;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.right</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin-left</span>: <span class="number">210px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: saddlebrown;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.last</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: red;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;clear:both&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;last&quot;</span>&gt;</span>后面内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>实现效果<br><img src="https://i.loli.net/2021/07/17/XZYbipRNOQGW7sV.gif" alt="pic34"><br>注意要给<code>container</code>添加为内容空的子元素<code>&lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;</code>，清除浮动带来的影响。</p>
<h4 id="2-三栏目布局实现"><a href="#2-三栏目布局实现" class="headerlink" title="2.三栏目布局实现"></a>2.三栏目布局实现</h4><p>三栏布局也是我们经常遇到的布局方式，它的特点主要是：两边定宽，中间自适应。有多种方式实现三栏布局，我们这里介绍其中四种方式<br><img src="https://i.loli.net/2021/07/17/7mFMngJZElqbLYV.png" alt="buj"></p>
<h5 id="1-position-margin-实现"><a href="#1-position-margin-实现" class="headerlink" title="(1)position + margin 实现"></a>(1)position + margin 实现</h5><p>实现思路：</p>
<ul>
<li>设置父元素为相对定位，左右两栏采用绝对定位，分别固定于页面的左右两侧</li>
<li>中间的主体栏用左右margin值撑开距离<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">     <span class="comment">/*父元素设置相对定位，否则左右栏会相对Body元素进行位置的偏移*/</span></span><br><span class="line">     <span class="attribute">position</span>: relative;</span><br><span class="line">     <span class="attribute">background-color</span>:wheat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span> &#123;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">     <span class="attribute">margin-left</span>: <span class="number">110px</span>;</span><br><span class="line">     <span class="attribute">margin-right</span>: <span class="number">110px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:royalblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">     <span class="attribute">position</span>: absolute;</span><br><span class="line">     <span class="attribute">top</span>: <span class="number">0px</span>;</span><br><span class="line">     <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:salmon;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:sandybrown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>尾部内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
看下实现效果<br><img src="https://i.loli.net/2021/07/17/tdal8eDmBGPvqzF.gif" alt="yup"></li>
</ul>
<h5 id="2-圣杯布局"><a href="#2-圣杯布局" class="headerlink" title="(2)圣杯布局"></a>(2)圣杯布局</h5><p>实现思路：</p>
<ul>
<li>中间元素占据第一位置优先渲染，设置该元素 width 为 100%</li>
<li>左中右三个元素分别左浮动,并且进行清除浮动带来的影响</li>
<li>左元素设置左边距为-100%以使得左元素上升一行并且处于最左位置，右元素设置左边距为自身宽度的负值使得右元素上升一行处于最右位置。</li>
<li>设置父元素的左右 padding 为左右两个元素留出空间，以展示中间元素内容。</li>
<li>设置左右元素为相对定位，左元素的 left 和右元素的 right 为内边距的宽度的负值。<br>代码实现<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右边<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;clear: both;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;last&quot;</span>&gt;</span>后面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
CSS<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">     <span class="comment">/* 设置body的最小宽度 */</span></span><br><span class="line">     <span class="attribute">min-width</span>: <span class="number">800px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">     <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">210px</span>;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span> &#123;</span><br><span class="line">     <span class="attribute">float</span>: left;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:royalblue;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="selector-class">.left</span> &#123;</span><br><span class="line">     <span class="attribute">float</span>: left;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:salmon;</span><br><span class="line">     <span class="comment">/*左边距为-100%以使得左元素上升一行并且处于最左位置*/</span></span><br><span class="line">     <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">     <span class="comment">/*相对定位*/</span></span><br><span class="line">     <span class="attribute">position</span>: relative;</span><br><span class="line">     <span class="attribute">left</span>: -<span class="number">210px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">     <span class="attribute">float</span>: left;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>:sandybrown;</span><br><span class="line">     <span class="comment">/*元素设置左边距为自身宽度的负值使得右元素上升一行处于最右位置*/</span></span><br><span class="line">     <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</span><br><span class="line">     <span class="comment">/*相对定位*/</span></span><br><span class="line">     <span class="attribute">position</span>: relative;</span><br><span class="line">     <span class="attribute">right</span>: -<span class="number">210px</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.last</span> &#123;</span><br><span class="line">     <span class="attribute">background-color</span>:thistle;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
效果<br><img src="https://i.loli.net/2021/07/18/puQyVd3aTiEUnxB.gif" alt="pic2"></li>
</ul>
<h5 id="3-双飞翼布局"><a href="#3-双飞翼布局" class="headerlink" title="(3)双飞翼布局"></a>(3)双飞翼布局</h5><p>实现思路：</p>
<ul>
<li>中间采用嵌套子元素方法,宽度自适应</li>
<li>左中右三个元素分别左浮动,并且进行清除浮动带来的影响</li>
<li>左元素设置左边距为-100%以使得左元素上升一行并且处于最左位置，右元素设置左边距为自身宽度的负值使得右元素上升一行处于最右位置。</li>
<li>设置中间元素的子元素左右边距为左右元素留空位，以展示中间元素内容。<br>代码实现<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;clear: both;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;last&quot;</span>&gt;</span>尾部<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
CSS<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">   <span class="attribute">min-width</span>: <span class="number">800px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span>&#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="comment">/* 整个容器大小 */</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.container</span> <span class="selector-class">.middle</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="comment">/* 设置左右边距 */</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">160px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:slateblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span>&#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span>&#123;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>:saddlebrown;</span><br><span class="line">    <span class="attribute">margin-left</span>: -<span class="number">150px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.last</span> &#123;</span><br><span class="line">     <span class="attribute">background-color</span>: tomato;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
效果<br><img src="https://i.loli.net/2021/07/18/KJkQLDloabB3CN5.gif" alt="pic"></li>
</ul>
<blockquote>
<p>圣杯布局跟双飞翼布局的实现上，在前部分是一样的。同样都是左右栏定宽，中间栏自适应。采用浮动和负边距使左右栏与中间栏并排。不同之处大部分在于中间元素的的展示方式上。圣杯布局采用父元素设置内边距的方法，左右元素设置相对定位辅助。而双飞翼布局在中间采用嵌套子元素方法，通过设置子元素外边距来展示。</p>
</blockquote>
<h5 id="4-flex布局实现"><a href="#4-flex布局实现" class="headerlink" title="(4)flex布局实现"></a>(4)flex布局实现</h5><p>对比前面两中实现直接实用flex布局能够比较容易的实现三栏布局</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span>左侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;middle&quot;</span>&gt;</span>中间<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span>右侧<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>CCS</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">     <span class="attribute">display</span>: flex;</span><br><span class="line">     <span class="attribute">flex-direction</span>: row;</span><br><span class="line">     <span class="attribute">justify-content</span>: center;</span><br><span class="line">     <span class="attribute">align-items</span>: flex-start;</span><br><span class="line">     <span class="attribute">background-color</span>: wheat;</span><br><span class="line">     <span class="comment">/* height: 100vh; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">     <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: saddlebrown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.middle</span> &#123;</span><br><span class="line">     <span class="comment">/* 宽度沾满剩下的整个区域 */</span></span><br><span class="line">     <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">     <span class="attribute">height</span>: <span class="number">200px</span>;</span><br><span class="line">     <span class="attribute">background-color</span>: seagreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/07/18/Tkq2yYlcrpfA375.gif" alt="pic"></p>
<h4 id="3-响应式布局"><a href="#3-响应式布局" class="headerlink" title="3.响应式布局"></a>3.响应式布局</h4><blockquote>
<p>响应式布局是<a target="_blank" rel="noopener" href="https://ethanmarcotte.com/">Ethan Marcotte</a>在2010年5月份提出的一个概念，简而言之，就是一个网站能够兼容多个终端——而不是为每个终端做一个特定的版本。这个概念是为解决移动互联网浏览而诞生的。</p>
</blockquote>
<p><img src="https://i.loli.net/2021/07/18/23bFRDmB9eruoVh.gif" alt="saumang"><br>例如<a target="_blank" rel="noopener" href="https://www.samsungeshop.com.cn/">三星</a>网站的设计,当我们改变浏览器大小时，页面的布局会发生相应的改变，那么这些变化是如何实现的呢?我们介绍三种实现方式</p>
<h5 id="1-媒体查询CSS3-Media-Query"><a href="#1-媒体查询CSS3-Media-Query" class="headerlink" title="(1)媒体查询CSS3-Media Query"></a>(1)媒体查询<code>CSS3-Media Query</code></h5><p>使用 <code>@media</code>查询，可以针对不同的媒体类型定义不同的样式。当你重置浏览器大小的过程中，页面也会根据浏览器的宽度和高度重新渲染页面。<br>语法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> mediatype <span class="keyword">and</span>|<span class="keyword">not</span>|<span class="keyword">only</span> (media feature) &#123;</span><br><span class="line">    CSS-<span class="selector-tag">Code</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>mediatype</code>: 媒体类型, 例如：<code>screen</code>:计算机屏幕（默认值），<code>tv</code>:电视类型设备 等</li>
<li><code>and|not|only</code> :逻辑操作符<br><code>and</code>:用来把多个媒体属性组合起来，合并到同一条媒体查询中<br><code>not</code>:用来对一条媒体查询的结果进行取反<br><code>only</code>:表示仅在媒体查询匹配成功时应用指定样式</li>
<li><code>media feature</code>: 多数媒体属性，带有“min-”和“max-”前缀，用于表达“大于等于”和“小于等于”。例如<code>width | min-width | max-width</code>,<code>height | min-height | max-height</code>,<code>aspect-ratio | min-aspect-ratio | max-aspect-ratio</code>等</li>
</ul>
<p>适配进行响应式开发时往往需要针对不同的屏幕添加多个断点,看个例子<br><img src="https://i.loli.net/2021/07/18/G5ItQOL2gyZ3uEa.gif" alt="toppic"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item0&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item1&quot;</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item2&quot;</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item3&quot;</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item4&quot;</span>&gt;</span>item4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item5&quot;</span>&gt;</span>item5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item6&quot;</span>&gt;</span>item6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item7&quot;</span>&gt;</span>item7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>CSS</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=&quot;UTF-<span class="number">8</span>&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; <span class="attribute">content</span>=&quot;<span class="attribute">width</span>=device-<span class="attribute">width</span>, initial-scale=<span class="number">1</span>, maximum-scale=<span class="number">1</span>, user-scalable=no&quot;&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    * &#123;</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-tag">body</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: white;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 当屏幕尺寸大于等于1025 样式 */</span></span><br><span class="line">    <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">1025px</span>)&#123;</span><br><span class="line">        <span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: wheat;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.item</span> &#123;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid skyblue;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">30px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** iPad 屏幕尺寸大于等于768 小于等于1024 竖屏**/</span></span><br><span class="line">    <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>) <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">1024px</span>) &#123;</span><br><span class="line">        <span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>: rosybrown;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.item</span> &#123;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid skyblue;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">20px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/** iPhone 屏幕尺寸小于等于767 竖屏样式**/</span></span><br><span class="line">    <span class="keyword">@media</span> <span class="keyword">only</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">767px</span>)&#123;</span><br><span class="line">        <span class="selector-tag">body</span> &#123;</span><br><span class="line">            <span class="attribute">background-color</span>:royalblue;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="selector-class">.item</span> &#123;</span><br><span class="line">            <span class="attribute">float</span>: left;</span><br><span class="line">            <span class="attribute">border</span>: <span class="number">1px</span> solid skyblue;</span><br><span class="line">            <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">            <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">            <span class="attribute">text-align</span>: center;</span><br><span class="line">            <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&gt;</code>这句代码的作用是禁止用户进行手动的放大缩小页面</li>
<li>设置了三个断点，根据不同的屏幕宽度展示不同的样式。</li>
<li>还需要注意<code>@media</code> 不支持IE9及以下的浏览器，如果要支持需要添加额外的代码<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--[if lt IE 9]&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src=&quot;https://cdn.staticfile.org/html5shiv/r29/html5.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src=&quot;https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="comment">  &lt;![endif]--&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-grid实现响应式布局"><a href="#2-grid实现响应式布局" class="headerlink" title="(2)grid实现响应式布局"></a>(2)grid实现响应式布局</h5><p>第二种方式主要是利用<code>grid</code>的特性来实现响应布局。假如有这样的需求：我们不希望Item过小，需要有最小宽度限制，并且当视口宽度增加时我们不希望看到右侧有空白区域的出现。实现下面效果<br><img src="https://i.loli.net/2021/07/19/OjiARqy4adXSsfK.gif" alt="pic"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  	 <span class="tag">&lt;<span class="name">title</span>&gt;</span>响应式布局2<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">           * &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">           <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">               <span class="attribute">background-color</span>: white;</span></span><br><span class="line"><span class="language-css">           &#125;</span></span><br><span class="line"><span class="language-css">		   <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">display</span>: grid;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">grid-template-columns</span>: <span class="built_in">repeat</span>(auto-fit, <span class="built_in">minmax</span>(<span class="number">300px</span>, <span class="number">1</span>fr));</span></span><br><span class="line"><span class="language-css">				<span class="attribute">grid-gap</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">grid-auto-rows</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">		   &#125;</span></span><br><span class="line"><span class="language-css">		   <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">border</span>: <span class="number">1px</span> solid skyblue;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">				<span class="attribute">line-height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">          &#125;	</span></span><br><span class="line"><span class="language-css">       </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item0&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item1&quot;</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item2&quot;</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item3&quot;</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item4&quot;</span>&gt;</span>item4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item5&quot;</span>&gt;</span>item5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item6&quot;</span>&gt;</span>item6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item item7&quot;</span>&gt;</span>item7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>关于<code>grid</code>的属性我们再上面已经介绍过了这里不再赘述。唯一没有介绍的是<code>auto-fit</code>关键字，<code>repeat()</code>函数的作用是重复创建多个Item，第一个参数数个数，第二个是大小，这里取值<code>auto-fit</code>的意思是数量是自适应的，只要容纳得下，就会往上排列。</li>
</ul>
<h5 id="3-Columns栅格系统"><a href="#3-Columns栅格系统" class="headerlink" title="(3)Columns栅格系统"></a>(3)Columns栅格系统</h5><p><code>Columns栅格系统</code>往往需要依赖某个UI库，如<code>Bootstrip</code>或者是<code>Element UI</code>等。</p>
<ul>
<li><code>Bootstrap</code>来自Twitter，是一个用于快速开发 Web 应用程序和网站的前端框架。它提供了一套响应式、移动设备优先的流式网格系统，随着屏幕或视口（viewport）尺寸的改变，系统会自动将视口分为最多12列。它根据当前视口的大小添加多个媒体查询断点，可以让开发者方便的根据视口大小调整每个网格所占整体视口的宽度。</li>
<li><code>Bootstrap(5.0)</code>有六种默认响应尺寸：<code>xs</code>、<code>sm</code>、<code>md</code>、<code>lg</code>、<code>xl</code>、<code>xxl</code>,对应关系如下<br><img src="https://i.loli.net/2021/07/20/gkKNdREl3FcjPGz.png" alt="duandian"></li>
</ul>
<p>它的基本的网格结构</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-*-*&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-*-*&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>      </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用规则</p>
<ul>
<li>行必须放置在 <code>.container</code>class 内，以便获得适当的对齐（alignment）和内边距（padding）</li>
<li>使用行来创建列的水平组，内容应该放置在列内，且唯有列可以是行的直接子元素</li>
<li>预定义的网格类，比如 .row 和 .col-xs-4，可用于快速创建网格布局。</li>
<li>网格系统是通过指定您想要横跨的十二个可用的列来创建的。例如，要创建三个相等的列，则使用三个 .col-xs-4。</li>
</ul>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 必须的 meta 标签 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap 的 CSS 文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">50px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row g-1&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12 col-sm-6 col-md-4 col-lg-3 item bg-light border&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12 col-sm-6 col-md-4 col-lg-3 item bg-light border&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12 col-sm-12 col-md-4 col-lg-3 item bg-light border&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12 col-sm-12 col-md-12 col-lg-3 item bg-light border&quot;</span>&gt;</span>item0<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果<br><img src="https://i.loli.net/2021/07/20/yuNS6VdK95GkBt4.gif" alt="pic"><br>其他<a target="_blank" rel="noopener" href="https://v5.bootcss.com/docs/examples/">官方示例</a>,Element UI的响应式布局与Bootstrap是相似的工作原理，这里不再赘述。<br>想了解更多关于<a target="_blank" rel="noopener" href="https://getbootstrap.com/">Bootstrap</a>和<a target="_blank" rel="noopener" href="https://element.eleme.cn/">Element UI</a>相关内容点击他们</p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>作为前端小白，学习完Html、CSS、JavaScript等一堆东西，等到真正开始写Web页面还是一头雾水，回忆刚学习写客户端时肯定要从基础的页面布局来入手，于是有了这篇文章。因此这篇文章主要面向的是前端初学者，还请大神勿喷。当然由于作者水平有限，难免出现纰漏，如有问题还请不吝赐教。文章涉及<a target="_blank" rel="noopener" href="https://github.com/chenXming/CSS_Layout">源码</a><br>参考资料：<br><a target="_blank" rel="noopener" href="https://getbootstrap.com/">Bootstrap</a><br><a target="_blank" rel="noopener" href="https://element-plus.gitee.io/">Element UI</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011358507">CSS布局</a><br><a target="_blank" rel="noopener" href="https://shanyue.tech/post/Grid-Guide/#%E7%AE%80%E4%BB%8B">Grid 布局完全指南</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/08/05/Web%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E5%B8%83%E5%B1%80%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/" data-id="cllniud7z0005xbexd3yocn4a" data-title="Web开发常用布局方式总结" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-iOS架构浅谈从 MVC、MVP 到 MVVM" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/05/17/iOS%E6%9E%B6%E6%9E%84%E6%B5%85%E8%B0%88%E4%BB%8E%20MVC%E3%80%81MVP%20%E5%88%B0%20MVVM/" class="article-date">
  <time class="dt-published" datetime="2021-05-17T12:46:25.000Z" itemprop="datePublished">2021-05-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/05/17/iOS%E6%9E%B6%E6%9E%84%E6%B5%85%E8%B0%88%E4%BB%8E%20MVC%E3%80%81MVP%20%E5%88%B0%20MVVM/">iOS-架构浅谈 从 MVC、MVP 到 MVVM</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>做了这么多年的客户端研发一直在使用苹果爸爸推荐的MVC架构模式。MVC从应用层面进行分层开发，极大优化了我们的代码结构，简单易上手，很容易被程序员所接受。程序员刚接手一个新项目，如果是MVC的架构模式，会减少代码熟悉时间，快速的进行开发和维护工作，实际上对于多人开发维护的项目，MVC仍然是非常好的架构模式，这也是这种架构模式经久不衰的原因。<br>但是任何事物都有两面性，随着项目需求的增加，业务逻辑、网络请求、代理方法等都往Controller层加塞，导致Controller层变得越来越臃肿，动辄上千行的代码量绝对是维护人员的噩梦，因此在MVC基础上逐渐衍生出来了MVP、MVVM等架构模式。<br><br>本文是基于<code>OC</code>代码进行阐述的，使用iOS开发经典的 <code>TableView</code> 列表来分析每个架构模式。相信看了这篇文章你会有所领悟。当然一千个人眼中有一千种哈姆雷特，具体在业务开发中使用哪种模式需要你自己去衡量。</p>
<h3 id="1-传统的MVC设计模式"><a href="#1-传统的MVC设计模式" class="headerlink" title="1.传统的MVC设计模式"></a>1.传统的<code>MVC</code>设计模式</h3><p><img src="https://i.loli.net/2021/05/14/4r1hM8dXbIi2DoW.png" alt="MVC"><br><br><code>M</code>: Model 数据层，负责网络数据的处理，数据持久化存储和读取等工作<br><br><code>V</code>: View 视图层，负责呈现从数据层传递的数据渲染工作，以及与用户的交互工作<br><br><code>C</code>: Controller控制器，负责连接Model层跟View层，响应View的事件和作为View的代理，以及界面跳转和生命周期的处理等任务</p>
<h4 id="用户的交互逻辑"><a href="#用户的交互逻辑" class="headerlink" title="用户的交互逻辑"></a>用户的交互逻辑</h4><p>用户点击 View(视图) –&gt; 视图响应事件 –&gt;通过代理传递事件到Controller–&gt;发起网络请求更新Model—&gt;Model处理完数据–&gt;代理或通知给Controller–&gt;改变视图样式–&gt;完成</p>
<blockquote>
<p>可以看到Controller强引用View与Model，而View与Model是分离的，所以就可以保证Model和View的可测试性和复用性，但是Controller不行，因为Controller是Model和View的中介，所以不能复用，或者说很难复用。</p>
</blockquote>
<h4 id="iOS开发实际使用的MVC架构"><a href="#iOS开发实际使用的MVC架构" class="headerlink" title="iOS开发实际使用的MVC架构"></a>iOS开发实际使用的MVC架构</h4><p><img src="https://i.loli.net/2021/05/14/duZsN7whafP2ilp.png" alt="实际MVC"><br>在我们实际开发中使用的MVC模式可以看到，View与Controller耦合在一起了。这是由于每一个界面的创建都需要一个Controller，而每一个Controller里面必然会带一个View，这就导致了C和V的耦合。这种结构确实可以提高开发效率，但是一旦界面建复杂就会造成Controller变得非常臃肿和难以维护。</p>
<h4 id="MVC代码示例"><a href="#MVC代码示例" class="headerlink" title="MVC代码示例"></a>MVC代码示例</h4><p>我们要实现一个简单的列表页面，每行cell都一个按钮，点击按钮前面数字➕1操作。<br><br><img src="https://i.loli.net/2021/05/14/P6JDxH1Oon3Kbhv.gif" alt="mvcexamp"><br>核心代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// Controller</span><br><span class="line">- (UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) wealSelf = self;</span><br><span class="line">    MVCTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    if(cell == nil)&#123;</span><br><span class="line">        cell = [[MVCTableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    DemoModel *model = self.dataArray[indexPath.row];</span><br><span class="line">    [cell loadDataWithModel:model];</span><br><span class="line">    cell.clickBtn = ^&#123;</span><br><span class="line">        NSLog(@&quot;id===%ld&quot;,model.num);</span><br><span class="line">        [wealSelf changeNumWithModel:model];</span><br><span class="line">    &#125;;</span><br><span class="line">    cell.selectionStyle = UITableViewCellSelectionStyleNone;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line">/*</span><br><span class="line">* 用户点击事件通过Block传递过来后，在Controller层处理更新Mdoel以及更新视图的逻辑</span><br><span class="line">*/</span><br><span class="line">- (void)changeNumWithModel:(DemoModel*)model&#123;</span><br><span class="line">    </span><br><span class="line">    model.num++;</span><br><span class="line">    NSIndexPath *path = [NSIndexPath indexPathForRow:model.Id inSection:0];</span><br><span class="line">    [self.mainTabelView reloadRowsAtIndexPaths:@[path] withRowAnimation:UITableViewRowAnimationLeft];</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>可以看到用户点击事件通过Block传递过来后，在Controller层处理更新Mdoel以及更新视图的逻辑</li>
</ul>
<h3 id="2-MVP设计模式"><a href="#2-MVP设计模式" class="headerlink" title="2.MVP设计模式"></a>2.<code>MVP</code>设计模式</h3><p><img src="https://i.loli.net/2021/05/14/F6PMRtE8hq4vSXx.png" alt="MVP"><br><code>M</code>: Model 数据层，负责网络数据的处理，数据持久化存储和读取等工作<br><br><code>V</code>: View 视图层，负责呈现从数据层传递的数据渲染工作，以及与用户的交互，这里把Controller层也合并到视图层<br><br><code>P</code>: Presenter层，负责视图需要数据的获取，获取到数据后刷新视图。响应View的事件和作为View的代理。</p>
<p>可以看到 MVP模式跟原始的MVC模式非常相似，完全实现了View与Model层的分离，而且把业务逻辑放在了Presenter层中，视图需要的所有数据都从Presenter获取，而View与 Presenter通过协议进行事件的传递。</p>
<h4 id="用户的交互逻辑-1"><a href="#用户的交互逻辑-1" class="headerlink" title="用户的交互逻辑"></a>用户的交互逻辑</h4><p>用户点击 View(视图) –&gt; 视图响应事件 –&gt;通过代理传递事件到Presenter–&gt;发起网络请求更新Model–&gt;Model处理完数据–&gt;代理或通知给视图(View或是Controller)–&gt;改变视图样式–&gt;完成</p>
<h4 id="MVP代码示例"><a href="#MVP代码示例" class="headerlink" title="MVP代码示例"></a>MVP代码示例</h4><p><img src="https://i.loli.net/2021/05/14/RnhykDzO638YPIU.png" alt="项目结构"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//DemoProtocal</span><br><span class="line">import &lt;Foundation/Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@protocol DemoProtocal &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">//用户点击按钮 触发事件： UI改变传值到model数据改变  UI --- &gt; Model 点击cell 按钮</span><br><span class="line">-(void)didClickCellAddBtnWithIndexPathRow:(NSInteger)index;</span><br><span class="line">//model数据改变传值到UI界面刷新 Model --- &gt; UI</span><br><span class="line">-(void)reloadUI;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li>我们把所有的代理抽象出来，成为一个Protocal文件。这两个方法的作用：</li>
<li><code>-(void)didClickCellAddBtnWithIndexPathRow:(NSInteger)index;</code>:Cell视图调用它去Presenter层实现点击逻辑的处理</li>
<li><code>-(void)reloadUI;</code>: Presenter调用它去更新主视图View或者Controller</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//Presenter.h</span><br><span class="line">#import &lt;Foundation/Foundation.h&gt;</span><br><span class="line">#import &lt;UIKit/UIKit.h&gt;</span><br><span class="line">#import &quot;DemoProtocal.h&quot;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface Presenter : NSObject</span><br><span class="line">@property (nonatomic, strong,readonly) NSMutableArray *dataArray;</span><br><span class="line">@property (nonatomic, weak) id&lt;DemoProtocal&gt;delegate;//协议，去更新主视图UI</span><br><span class="line">// 更新 TableView UI 根据需求</span><br><span class="line">- (void)requestDataAndUpdateUI;</span><br><span class="line">//更新 cell UI</span><br><span class="line">- (void)updateCell:(UITableViewCell*)cell withIndex:(NSInteger)index;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>dataArray </code>: 视图需要的数据源</li>
<li><code>- (void)requestDataAndUpdateUI;</code>:主视图Controller调用，去更新自己的UI</li>
<li><code>- (void)updateCell:(UITableViewCell*)cell withIndex:(NSInteger)index;</code>:更新 Cell的UI</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//Controller 层</span><br><span class="line">- (void)iniData&#123;</span><br><span class="line">    self.presenter = [[Presenter alloc] init];</span><br><span class="line">    self.presenter.delegate = self;</span><br><span class="line">    [self.presenter requestDataAndUpdateUI];</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section&#123;</span><br><span class="line">    return self.presenter.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line">- (UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line">    </span><br><span class="line">    MVPTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    if(cell == nil)&#123;</span><br><span class="line">        cell = [[MVPTableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    //更新cell UI 数据</span><br><span class="line">    [self.presenter updateCell:cell withIndex:indexPath.row];</span><br><span class="line">    cell.selectionStyle = UITableViewCellSelectionStyleNone;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - DemoProtocal</span><br><span class="line">//Presenter 的代理回调 数据更新了通知View去更新视图</span><br><span class="line">- (void)reloadUI&#123;</span><br><span class="line">    [self.mainTabelView reloadData];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Controller层初始化Presenter，调用其方法更新自己的UI，可以看到网络数据的获取，处理都在Presenter中，处理完成后通过协议回调给Controller去reload数据</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//Cell</span><br><span class="line">- (void)addBtnDown:(UIButton*)btn&#123;</span><br><span class="line">    NSLog(@&quot;%s&quot;,__func__);</span><br><span class="line">    if([self.delegate respondsToSelector:@selector(didClickCellAddBtnWithIndexPathRow:)])&#123;</span><br><span class="line">        [self.delegate didClickCellAddBtnWithIndexPathRow:self.index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Cell层点击事件通过协议调用，而这个协议方法的实现是在Presenter中实现的。</li>
</ul>
<blockquote>
<p>MVP模式也有自身的缺点，所有的用户操作和更新UI的回调需要定义，随着交互越来越复杂，这些定义都要有很大一坨代码。逻辑过于复杂的情况下，Present本身也会变得臃肿。所以衍生出了MVVM模式。</p>
</blockquote>
<h3 id="3-MVVM-RAC设计模式"><a href="#3-MVVM-RAC设计模式" class="headerlink" title="3.MVVM+RAC设计模式"></a>3.<code>MVVM+RAC</code>设计模式</h3><p><img src="https://i.loli.net/2021/05/14/8dJYU67qnSvBQwf.png" alt="MVVM"><br><br><code>M</code>: Model 数据层，负责网络数据的处理，数据持久化存储和读取等工作<br><br><code>V</code>: View 视图层，此时的视图层包括Controller，负责呈现从数据层传递的数据渲染工作，以及与用户的交互<br><br><code>VM</code>:ViewModel层，负责视图需要数据的获取，获取到数据后刷新视图。响应View的事件和作为View的代理等工作。<br><br>通过架构图可以看到，MVVM模式跟MVP模式基本类似。主要区别是在MVP基础上加入了双向绑定机制。当被绑定对象某个值的变化时，绑定对象会自动感知，无需被绑定对象主动通知绑定对象。可以使用KVO和RAC实现。我们这里采用了RAC的实现方式。关于RAC如果不熟悉的小伙伴可以点<a target="_blank" rel="noopener" href="https://juejin.cn/post/6953808004307222564">这里</a>,我们这篇文章不在涉及。</p>
<h4 id="MVVM代码示例"><a href="#MVVM代码示例" class="headerlink" title="MVVM代码示例"></a>MVVM代码示例</h4><p><img src="https://i.loli.net/2021/05/14/wkuAR8XNDgU2BSt.png" alt="项目结构">)</p>
<blockquote>
<p>我们这里包括两层视图：主视图Controller以及Cell，分别对应两层ViewModel：ViewModel和CellViewModel</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ViewModel.h</span><br><span class="line"></span><br><span class="line">@interface ViewModel : NSObject</span><br><span class="line">//发送数据请求的Rac，可以去订阅获取 请求结果</span><br><span class="line">@property (nonatomic,strong,readonly) RACCommand *requestCommand;</span><br><span class="line">@property (nonatomic,strong) NSArray *dataArr;//返回子级对象的ViewModel</span><br><span class="line">- (CellViewModel *)itemViewModelForIndex:(NSInteger)index;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RACCommand *requestCommand</code>:提供供主视图调用的命令，调用它去获取网络数据 </li>
<li><code>NSArray *dataArr</code>: 提供供主视图使用的数据源，注意这里不能用NSMutableArray，因为NSMutableArray不支持KVO，不能被RACObserve。</li>
<li><code>- (CellViewModel *)itemViewModelForIndex:(NSInteger)index;</code> 根据Cell的index返回它需要的的ViewModel</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@interface CellViewModel : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy,readonly) NSString *titleStr;</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy,readonly) NSString *numStr;</span><br><span class="line"></span><br><span class="line">@property (nonatomic,copy,readonly) RACCommand *addCommand;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithModel:(DemoModel *)model;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<ul>
<li><code>CellViewModel</code>: 暴露出Cell渲染需要的所有数据</li>
<li><code>RACCommand *addCommand;</code>: 按钮点击事件的指令，触发后需要在CellViewModel里面做处理。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//controller</span><br><span class="line">- (void)iniData&#123;</span><br><span class="line">    self.viewModel = [[ViewModel alloc] init];</span><br><span class="line">    // 发送请求</span><br><span class="line">    RACSignal *signal = [self.viewModel.requestCommand execute:@&#123;@&quot;page&quot;:@&quot;1&quot;&#125;];</span><br><span class="line">    [signal subscribeNext:^(id x) &#123;</span><br><span class="line">        NSLog(@&quot;x=======%@&quot;,x);</span><br><span class="line">        if([x boolValue] == 1)&#123;//请求成功</span><br><span class="line">            [self.mainTabelView reloadData];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line">- (UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath&#123;</span><br><span class="line">    </span><br><span class="line">    MVVMTableVIewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    if(cell == nil)&#123;</span><br><span class="line">        cell = [[MVVMTableVIewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;Cell_identifer&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    //更新cell UI 数据</span><br><span class="line">    cell.cellViewModel = [self.viewModel itemViewModelForIndex:indexPath.row];</span><br><span class="line">    cell.selectionStyle = UITableViewCellSelectionStyleNone;</span><br><span class="line">        </span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>iniData</code>:初始化ViewModel，并发送请求命令。这里可以监听这个完成信号，进行刷新视图操作</li>
<li><code>cell.cellViewModel = [self.viewModel itemViewModelForIndex:indexPath.row];</code> 根据主视图的ViewModel去获取Cell的ViewModel，实现cell的数据绑定。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//TableViewCell</span><br><span class="line"></span><br><span class="line">    RAC(self.titleLabel,text) = RACObserve(self, cellViewModel.titleStr);</span><br><span class="line">    RAC(self.numLabel,text) = RACObserve(self, cellViewModel.numStr);</span><br><span class="line"></span><br><span class="line">    [[self.addBtn rac_signalForControlEvents:UIControlEventTouchUpInside] subscribeNext:^(id x) &#123;</span><br><span class="line">        NSLog(@&quot;&gt;&gt;&gt;&gt;&gt;&quot;);</span><br><span class="line">        [self.cellViewModel.addCommand execute:nil];</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>在Cell里面进行与ViewModel的数据绑定，这边有个注意Racobserve左边只有self右边才有viewModel.titleStr这样就避Cell重用的问题。</li>
<li><code>[self.cellViewModel.addCommand execute:nil];</code>:按钮的点击方法触发，事件的处理在CellViewModel中。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>经过几十年的发展和演变MVC模式出现了各种各样的变种，并在不同的平台上有着自己的实现。在实际项目开发中，根据具体的业务需求找到适合的架构才是最好的，架构本身并没有好坏之分。</li>
<li>最后对文中的MVC、MVP、MVVM架构的描述也掺杂了作者的主观意见，如果对文中的内容有疑问，欢迎提出不同的意见进行讨论。</li>
<li>本文的Demo已上传<a target="_blank" rel="noopener" href="https://github.com/chenXming/MVVMDemo">作者GitHub</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/05/17/iOS%E6%9E%B6%E6%9E%84%E6%B5%85%E8%B0%88%E4%BB%8E%20MVC%E3%80%81MVP%20%E5%88%B0%20MVVM/" data-id="cllniud7z0006xbex0at91pjs" data-title="iOS-架构浅谈 从 MVC、MVP 到 MVVM" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-iOS滤镜那些事儿" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/25/iOS%E6%BB%A4%E9%95%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" class="article-date">
  <time class="dt-published" datetime="2021-04-25T12:46:25.000Z" itemprop="datePublished">2021-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/25/iOS%E6%BB%A4%E9%95%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/">iOS-滤镜那些事儿</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="一-GPUImage-框架的介绍及基本使用"><a href="#一-GPUImage-框架的介绍及基本使用" class="headerlink" title="一. GPUImage 框架的介绍及基本使用"></a>一. <code>GPUImage</code> 框架的介绍及基本使用</h3><h4 id="1-GPUImage-的介绍"><a href="#1-GPUImage-的介绍" class="headerlink" title="1.GPUImage 的介绍"></a>1.<code>GPUImage</code> 的介绍</h4><p>  GPUImage是基于<code>OpenGL ES</code>的一套图像、视频处理开源框架，它里面提供了大量的滤镜，使用者可以通过这些滤镜的组合实现很好的效果，同时也很方便在原有基础上实现自定义的滤镜。对于大规模并行操作（如处理图像或实时视频帧），GPU具有比CPU更显着的性能优势。而 GPUImage 所有滤镜是基于<code>OpenGL Shader</code>实现的，所以滤镜效果、图像处理是在GPU上执行的，处理效率比较高，在iPhone4及其以上手机，可以做到实时流畅的效果。而且它隐藏了<code>Objective-C</code>与<code>OpenGL ES</code> API交互的复杂性。目前市面上的图像视频处理App，95%以上在使用GPUImage，所以学习它的使用及原理还是很有必要的。GPUImage 同时支持iOS跟Andorid平台，地址：<a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage">iOS版本</a> <a target="_blank" rel="noopener" href="https://github.com/cats-oss/android-gpuimage/blob/master/README.md">Android版本</a> 也支持 <a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage2">Swift版本</a>，本文主要介绍它的 OC 版本，核心类的功能以及原理跟 Andorid 版本是相通的。<br>iOS开发者使用方式：直接 CocaPods 集成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod &#x27;GPUImage&#x27;</span><br></pre></td></tr></table></figure>
<p>首先来看下它的基本结构图：<img src="https://i.loli.net/2021/04/19/ORQtClgUzNJPyj2.png" alt="架构图"></p>
<p>从这张图中我们可以看到GPUImage的几个核心类:<code>GPUImageOutput</code> <code>GPUImageFilter</code> <code>GPUImageInput 协议</code> <code>GPUImageFrameBuffer</code>,接下来我们重点讲解这几个类。</p>
<h4 id="2-核心功能类说明"><a href="#2-核心功能类说明" class="headerlink" title="2.核心功能类说明"></a>2.核心功能类说明</h4><h5 id="GPUImageOutput"><a href="#GPUImageOutput" class="headerlink" title="GPUImageOutput"></a><code>GPUImageOutput</code></h5><p>  <code>GPUImageOutput</code> 是所有滤镜输入源的基类，也就是滤镜链的起点，先看下他的继承关系：</p>
<p><img src="https://i.loli.net/2021/04/19/SOLKPabrFE2okIM.png" alt="GPUImageOutput"><br><br>分别解释一下这几种类型：<br></p>
<ul>
<li><code>GPUImagePicture</code><br>通过图片来初始化，本质上是先将图片转化为 CGImageRef，然后将 CGImageRef 转化为纹理。<br></li>
<li><code>GPUImageVideoCamera</code>:通过相机来初始化,本质是封装了AVCaptureVideoDataOutput来获取持续的视频流数据输出，在代理方法<code>captureOutput:didOutputSampleBuffer:fromConnection:</code>拿到 CMSampleBufferRef，将其转化为纹理的过程。<code>GPUImageStillCamera</code>是 GPUImageVideoCamera 的子类，可以用它来实现拍照功能。<br></li>
<li><code>GPUImageUIElement</code>:可以通过 UIView 或者 CALayer 来初始化。这个类可以用来实现在视频上添加文字水印的功能。<br></li>
<li><code>GPUImageTextureInput</code>:通过已经存在的纹理来初始化.<br></li>
<li><code>GPUImageRawDataInput</code>:通过二进制数据初始化，然后将二进制数据转化为纹理.<br></li>
<li><code>GPUImageMovie</code>:通过本地的视频来初始化。首先通过 AVAssetReader 来逐帧读取视频,然后将帧数据转化为纹理。</li>
<li><code>GPUImageFilter</code>:比较特殊，它既继承自 GPUImageOutput,又遵守协议 GPUImageInput 协议,所以它既可以作为滤镜链的源头，又可以把渲染的纹理输出给遵守 GPUImageInput 协议的类。是滤镜的核心，后面会单独介绍。<br></li>
</ul>
<h6 id="核心功能与方法："><a href="#核心功能与方法：" class="headerlink" title="核心功能与方法："></a>核心功能与方法：</h6><p>想象一下，一个滤镜链的源头能做什么呢：</p>
<ol>
<li>需要产出一个渲染对象，这个需要渲染的对象就是<code>GPUImageFrameBuffer</code>.几个关于frameBuffer的方法：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (GPUImageFramebuffer *)framebufferForOutput;</span><br></pre></td></tr></table></figure>
<p>这个方法可以获得当前正在渲染的frameBuffer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)removeOutputFramebuffer;</span><br></pre></td></tr></table></figure>
<p>这个方法用来移除当前渲染的frameBuffer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setInputFramebufferForTarget:(id&lt;GPUImageInput&gt;)target atIndex:(NSInteger)inputTextureIndex;</span><br></pre></td></tr></table></figure>
<p>这个方法的调用发生在当前output渲染完毕后，需要通知下一个receiver可以开始渲染的时候，把当前Output的FrameBuffer传递给下一个Input，让它可以使用这个FrameBuffer的结果进行渲染。</p>
<ol start="2">
<li>Target的添加以及管理，用来生成整个FilterChain.<br><br>GPUImageOutput 既然作为一个滤镜的源头，相对应的就得有接受者接受它输出的 FrameBuffer ,这些接受者就是Target,而且有可能有多个接受者。管理这些target的主要方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)addTarget:(id&lt;GPUImageInput&gt;)newTarget;</span><br><span class="line">- (void)addTarget:(id&lt;GPUImageInput&gt;)newTarget atTextureLocation:(NSInteger)textureLocation;</span><br></pre></td></tr></table></figure>
这两个addTarget方法的作用都是将下一个实现了GPUImageInput协议的对象添加到FilterChain当中来.一旦添加到滤镜链后，在当前Output渲染完成后就会收到通知，从而进行下一步的处理。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray*)targets;</span><br></pre></td></tr></table></figure>
<p>每个Output都可以添加多个target,这个方法可以获取到当前Output所有的target.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)removeTarget:(id&lt;GPUImageInput&gt;)targetToRemove;</span><br><span class="line">- (void)removeAllTargets;</span><br></pre></td></tr></table></figure>
<p>这两个方法的作用是将某一个或者所有的target都移出FilterChain。当一个target被移出FilterChain之后，它将不会再收到任何当前Output渲染完成的通知。</p>
<ol start="3">
<li>获取当前的GPUImageOutput对FrameBuffer的处理结果<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (CGImageRef)newCGImageFromCurrentlyProcessedOutput;</span><br><span class="line">- (CGImageRef)newCGImageByFilteringCGImage:(CGImageRef)imageToFilter;</span><br><span class="line">- (UIImage *)imageFromCurrentFramebuffer;</span><br><span class="line">- (UIImage *)imageFromCurrentFramebufferWithOrientation:(UIImageOrientation)imageOrientation;</span><br><span class="line">- (UIImage *)imageByFilteringImage:(UIImage *)imageToFilter;</span><br><span class="line">- (CGImageRef)newCGImageByFilteringImage:(UIImage *)imageToFilter;</span><br></pre></td></tr></table></figure>
其中最核心的方法是<code>newCGImageFromCurrentlyProcessedOutput</code>，基本上所有的方法最终都调用了这个方法。但是GPUImageOutput并没有为这个方法提供默认的实现，而是提供了一个方法定义。具体的实现在它的两个重要的子类 GPUImageFilter 和 GPUImageFilterGroup 中。而实际上最终调用的方法都在 GPUImageFilter 中实现了.</li>
</ol>
<h5 id="GPUImageInput协议"><a href="#GPUImageInput协议" class="headerlink" title="GPUImageInput协议"></a><code>GPUImageInput</code>协议</h5><p> <code>GPUImageInput</code> 是一个协议，它定义了一个能够接收 FrameBuffer 的 receiver 所必须实现的基本功能。实现这个协议的类可以作为渲染的终点使用。<br>实现了 GPUImageInput 接口的类：</p>
<p><img src="https://i.loli.net/2021/04/20/Hh4ltZmq3gxapL1.png" alt="GPUImageInput协议"><br>对这几个类进行解释：<br></p>
<ul>
<li><code>GPUImageMovieWriter</code>：封装了 AVAssetWriter，可以逐帧从帧缓存的渲染结果中读取数据，最后通过 AVAssetWriter 将视频文件保存到指定的路径。<br></li>
<li><code>GPUImageView</code>：继承自 UIView，通过输入的纹理，执行一遍渲染流程。我们一般使用它来呈现渲染结果。<br></li>
<li><code>GPUImageTextureOutput</code>：它可以获取到输入的Framebuffer中的纹理对象.<br></li>
<li><code>GPUImageRawDataOutput</code>：通过 rawBytesForImage 属性，可以获取到当前输入纹理的二进制数据。</li>
</ul>
<h6 id="核心功能与方法：-1"><a href="#核心功能与方法：-1" class="headerlink" title="核心功能与方法："></a>核心功能与方法：</h6><p>可以作为滤镜链的终点。基本功能主要包括：</p>
<ul>
<li>接收 GPUmageOutput 的输出信息;</li>
<li>接收上一个GPUImageOutput渲染完成的通知,并且完成自己的处理;</li>
</ul>
<ol>
<li>接收GPUmageOutput的输出信息对应方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)setInputFramebuffer:(GPUImageFramebuffer *)newInputFramebuffer atIndex:(NSInteger)textureIndex;</span><br><span class="line">- (NSInteger)nextAvailableTextureIndex;</span><br><span class="line">- (void)setInputSize:(CGSize)newSize atIndex:(NSInteger)textureIndex;</span><br><span class="line">- (void)setInputRotation:(GPUImageRotationMode)newInputRotation atIndex:(NSInteger)textureIndex;</span><br></pre></td></tr></table></figure>
根据这些方法可以看到，GPUImageInput 可以接收的信息包括上一个Output输出的FrameBuffer，FrameBuffer的size以及rotation。这些 textureIndex 都是为了提供个需要多个input的Filter准备的。</li>
<li>接收GPUImageOutput渲染完成的通知对应方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)newFrameReadyAtTime:(CMTime)frameTime atIndex:(NSInteger)textureIndex;</span><br></pre></td></tr></table></figure>
上一个 GPUImageOutput 渲染完成后会通知它所有的 Target，可以参考下它在<code>GPUImageFilter</code>里面的实现。</li>
</ol>
<h5 id="GPUImageFrameBuffer"><a href="#GPUImageFrameBuffer" class="headerlink" title="GPUImageFrameBuffer"></a><code>GPUImageFrameBuffer</code></h5><p>GPUImageFrameBuffer 提供了在 GPUImageOutput 和 GPUImageInput 进行数据传递的媒介。在整个渲染流程中，GPUImageFrameBuffer作为一个纽带，将各个不同的元素串联起来；每个GPUImageFrameBuffer 都有一个自己的OpenGL Texture，每个 GPUImageOutput 都会输出一个 GPUImageFrameBuffer 对象，而每个 GPUImageInput都实现了一个<code>setInputFramebuffer:atIndex:</code>方法，来接收上一个Output处理完的纹理.</p>
<ul>
<li>GPUImageFrameBuffer 的获取逻辑，是由<code>GPUImageFrameBufferCache</code> 进行管理的，需要时从BufferCache中获取，使用完成后，被BufferCache回收。FrameBuffer 的创建跟存储是需要消耗资源的，所以 GPUImage 为了尽量减少资源的消耗，会将使用完成的 FrameBuffer 存储在缓存中，每次通过 输入的纹理size 跟 TextureOptions 作为 key 从hash map 中获取。</li>
</ul>
<h5 id="GPUImageFilter"><a href="#GPUImageFilter" class="headerlink" title="GPUImageFilter"></a><code>GPUImageFilter</code></h5><p>GPUImageFilter 是整个GPUImage框架的核心,GPUImage所内置的100多种滤镜效果都继承于此类。例如我们经常用到的一些滤镜：</p>
<ul>
<li><code>GPUImageBrightnessFilter</code>:亮度调整滤镜</li>
<li><code>GPUImageExposureFilter</code>:曝光调整滤镜</li>
<li><code>GPUImageContrastFilter</code>:对比度调整滤镜</li>
<li><code>GPUImageSaturationFilter</code>:饱和度调整滤镜</li>
<li><code>GPUImageWhiteBalanceFilter</code>:白平衡调整滤镜</li>
<li><code>GPUImageColorInvertFilter</code>:反转图像的颜色</li>
<li><code>GPUImageCropFilter</code>:将图像裁剪到特定区域</li>
<li><code>GPUImageGaussianBlurFilter</code>:可变半径高斯模糊</li>
<li><code>GPUImageSketchFilter</code>:素描滤镜</li>
<li><code>GPUImageToonFilter</code>:卡通效果</li>
<li><code>GPUImageDissolveBlendFilter</code>:两个图像的混合</li>
<li><code>GPUImageFilterPipeline</code> : 链式组合滤镜<br>…</li>
</ul>
<h6 id="核心功能与方法：-2"><a href="#核心功能与方法：-2" class="headerlink" title="核心功能与方法："></a>核心功能与方法：</h6><ol>
<li><p>GPUImageFilter是GPUImageOutput的子类，但是同时它也实现了GPUImageInput协议。因此，它包含了一个Input和Output的所有功能。既它可以接受一个待渲染对象，渲染完成后继续传递给下一个实现GPUImageInput协议的接受者。具体的方法调用我们在下一小节的 滤镜底层源码分析中讲解。</p>
</li>
<li><p>提供根据不同的顶点着色器(VertexShader)与片元着色器(FragmentShader)来初始化渲染程序(GLProgram)的方法，但是整个渲染过程是一样的，因此这个过程都被封装到了基类中；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithVertexShaderFromString:(NSString *)vertexShaderString fragmentShaderFromString:(NSString *)fragmentShaderString;</span><br><span class="line">- (id)initWithFragmentShaderFromString:(NSString *)fragmentShaderString;</span><br><span class="line">- (id)initWithFragmentShaderFromFile:(NSString *)fragmentShaderFilename;</span><br></pre></td></tr></table></figure>
<p>这里简单介绍一下这几个<code>OPenGL</code>的术语</p>
</li>
</ol>
<ul>
<li><code>VertexShader</code>:顶点着色器，<code>OPenGL</code> 接收用户传递的几何数据（顶点信息和几何图元），这些数据经过顶点着色器后可以确定图形的形状以及位置。顶点着色器是 OPenGL 渲染过程的第一个着色器。</li>
<li>光栅化：是将图形的立体位置转换成在屏幕上显示的像素片元的过程；</li>
<li><code>FragmentShader</code>:对光栅化的像素点进行着色就要使用片元着色器。它是<code>OPenGL</code>渲染过程的最后一个着色器。</li>
<li><code>GLProgram</code>: <code>OpenGL ES</code>的program的面向对象封装,包括了VertexShader，FragmentShader的加载，program的link以及对attribute和uniform的获取和管理.<br>这里主要是一些根据不同的着色器进行创建Program的方法。</li>
</ul>
<ol start="3">
<li>作为基类提供给子类可以进行覆盖的方法。</li>
</ol>
<blockquote>
<p>用一句话来总结GPUImageFilter的作用：就是用来接收源图像(FrameBuffer)，通过自定义的顶点、片元着色器来渲染新的图像，并在绘制完成后通知响应链的下一个对象。</p>
</blockquote>
<h4 id="3-GPUImage滤镜的使用"><a href="#3-GPUImage滤镜的使用" class="headerlink" title="3.GPUImage滤镜的使用"></a>3.GPUImage滤镜的使用</h4><p>我们先来看它的应用效果<br><br><img src="https://i.loli.net/2021/04/25/tqfzpyXRsLCEOUv.gif" alt="效果"><img src="https://i.loli.net/2021/04/25/i3n5zfF8POqR4EG.gif" alt="效果2"></p>
<h5 id="1-为图片添加滤镜"><a href="#1-为图片添加滤镜" class="headerlink" title="(1) 为图片添加滤镜"></a>(1) 为图片添加滤镜</h5><p>直接上代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**初始化滤镜源头*/</span><br><span class="line"> GPUImagePicture *imagePic = [[GPUImagePicture alloc] initWithImage:[UIImage imageNamed:@&quot;picOne.jpg&quot;]];</span><br><span class="line"> /**创建滤镜*/</span><br><span class="line"> GPUImageGaussianBlurFilter *gaussianBlur = [[GPUImageGaussianBlurFilter alloc] init];</span><br><span class="line"> gaussianBlur.blurRadiusInPixels = 10;</span><br><span class="line"> /**添加接受者，即target*/</span><br><span class="line"> [imagePic addTarget:gaussianBlur];</span><br><span class="line"> /**增加frameBUffer 计数防止被移除*/</span><br><span class="line"> [gaussianBlur useNextFrameForImageCapture];</span><br><span class="line"> /**开始处理图片*/</span><br><span class="line"> [imagePic processImage];</span><br><span class="line"> /**根据frameBuffer 获取图片*/</span><br><span class="line"> self.showImageView.image = [gaussianBlur imageFromCurrentFramebuffer];</span><br></pre></td></tr></table></figure>
<h6 id="流程说明："><a href="#流程说明：" class="headerlink" title="流程说明："></a>流程说明：</h6><ul>
<li>使用图片初始化滤镜源头<code>GPUImagePicture</code></li>
<li>初始化滤镜效果<code>GPUImageGaussianBlurFilter</code></li>
<li>为当前滤镜源添加接收者Target <code>addTarget</code></li>
<li><code>useNextFrameForImageCapture</code>:方法是防止帧缓存被移除，如果不调用这个方法会导致Framebuffer被移除，从而导致Crash</li>
<li>根据滤镜的渲染结果FrameBuffer导出图片<code>[gaussianBlur imageFromCurrentFramebuffer]</code></li>
</ul>
<h5 id="2-摄像头捕获视频流添加滤镜"><a href="#2-摄像头捕获视频流添加滤镜" class="headerlink" title="(2) 摄像头捕获视频流添加滤镜"></a>(2) 摄像头捕获视频流添加滤镜</h5><p>核心代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (void)setupCamera</span><br><span class="line">&#123;</span><br><span class="line">    //videoCamera</span><br><span class="line">    self.gpuVideoCamera = [[GPUImageVideoCamera alloc] initWithSessionPreset:AVCaptureSessionPreset640x480 cameraPosition:AVCaptureDevicePositionBack];</span><br><span class="line">    self.gpuVideoCamera.outputImageOrientation = [[UIApplication sharedApplication] statusBarOrientation];</span><br><span class="line">    //GPUImageView填充模式</span><br><span class="line">    self.gpuImageView.fillMode = kGPUImageFillModePreserveAspectRatioAndFill;</span><br><span class="line">    //空白效果</span><br><span class="line">    GPUImageFilter *clearFilter = [[GPUImageFilter alloc] init];</span><br><span class="line">    [self.gpuVideoCamera addTarget:clearFilter];</span><br><span class="line">    [clearFilter addTarget:self.gpuImageView];</span><br><span class="line">    //Start camera capturing, 里面封装的是AVFoundation的session的startRunning</span><br><span class="line">    [self.gpuVideoCamera startCameraCapture];</span><br><span class="line">&#125;</span><br><span class="line">#pragma mark - Action &amp;&amp; Notification</span><br><span class="line">- (IBAction)originalBtnDown:(id)sender &#123;</span><br><span class="line">    /**先移除target*/</span><br><span class="line">    [self.gpuVideoCamera removeAllTargets];</span><br><span class="line">    //空白效果</span><br><span class="line">    GPUImageFilter *clearFilter = [[GPUImageFilter alloc] init];</span><br><span class="line">    [self.gpuVideoCamera addTarget:clearFilter];</span><br><span class="line">    [clearFilter addTarget:self.gpuImageView];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-混合滤镜的使用"><a href="#3-混合滤镜的使用" class="headerlink" title="(3) 混合滤镜的使用"></a>(3) 混合滤镜的使用</h5><p>核心代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">GPUImageView *filterView = [[GPUImageView alloc] initWithFrame:self.view.frame];</span><br><span class="line">filterView.center = self.view.center;</span><br><span class="line">filterView.fillMode = kGPUImageFillModePreserveAspectRatioAndFill;</span><br><span class="line">[self.view addSubview:filterView];</span><br><span class="line">/*初始化混合滤镜*/</span><br><span class="line">filter = [[GPUImageDissolveBlendFilter alloc] init];</span><br><span class="line">/*设置滤镜混合度*/</span><br><span class="line">[(GPUImageDissolveBlendFilter *)filter setMix:0.5];</span><br><span class="line">/*初始化视频输出源*/</span><br><span class="line">NSURL *sampleURL = [[NSBundle mainBundle] URLForResource:@&quot;IMG_4278&quot; withExtension:@&quot;MOV&quot;];</span><br><span class="line">movieFile = [[GPUImageMovie alloc] initWithURL:sampleURL];</span><br><span class="line">movieFile.runBenchmark = YES;</span><br><span class="line">movieFile.playAtActualSpeed = YES;</span><br><span class="line">/*初始化摄像头输出源*/</span><br><span class="line">videoCamera = [[GPUImageVideoCamera alloc] initWithSessionPreset:AVCaptureSessionPreset640x480 cameraPosition:AVCaptureDevicePositionBack];</span><br><span class="line">videoCamera.outputImageOrientation = UIInterfaceOrientationPortrait;</span><br><span class="line">NSString *pathToMovie = [NSHomeDirectory() stringByAppendingPathComponent:@&quot;Documents/Movie.m4v&quot;];</span><br><span class="line">unlink([pathToMovie UTF8String]);</span><br><span class="line">NSURL *movieURL = [NSURL fileURLWithPath:pathToMovie];</span><br><span class="line">//初始化接受者</span><br><span class="line">movieWriter = [[GPUImageMovieWriter alloc] initWithMovieURL:movieURL size:CGSizeMake(480.0, 640.0)];</span><br><span class="line">GPUImageFilter* progressFilter = [[GPUImageFilter alloc] init];</span><br><span class="line">[movieFile addTarget:progressFilter];</span><br><span class="line">//设置输出方向</span><br><span class="line">[progressFilter setInputRotation:kGPUImageRotateRight atIndex:0];</span><br><span class="line">// 响应链</span><br><span class="line">[progressFilter addTarget:filter];</span><br><span class="line">[videoCamera addTarget:filter];</span><br><span class="line">//设置音源</span><br><span class="line"> movieWriter.shouldPassthroughAudio = YES;</span><br><span class="line"> movieFile.audioEncodingTarget = movieWriter;</span><br><span class="line"> [movieFile enableSynchronizedEncodingUsingMovieWriter:movieWriter];</span><br><span class="line"> // 显示到界面</span><br><span class="line">[filter addTarget:filterView];</span><br><span class="line">//添加到接收者</span><br><span class="line">[filter addTarget:movieWriter];</span><br><span class="line">[videoCamera startCameraCapture];</span><br><span class="line">[movieWriter startRecording];</span><br><span class="line">[movieFile startProcessing];</span><br><span class="line">  /*写入结束后保存视频*/</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">[movieWriter setCompletionBlock:^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = weakSelf;</span><br><span class="line">    [strongSelf-&gt;filter removeTarget:strongSelf-&gt;movieWriter];</span><br><span class="line">    [strongSelf-&gt;movieWriter finishRecording];</span><br><span class="line">     /*根据movieURL保存视频到本地*/</span><br><span class="line">     // ...</span><br><span class="line"> &#125;];</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="流程说明：-1"><a href="#流程说明：-1" class="headerlink" title="流程说明："></a>流程说明：</h6><ul>
<li>混合滤的核心是<code>GPUImageDissolveBlendFilter</code>的使用，它继承自<code>GPUImageTwoInputFilter</code>,它需要有两个输入源</li>
<li>初始化两个输入源<code>GPUImageVideoCamera</code>跟<code>GPUImageMovie</code></li>
<li>添加输入源到DissolveBlendFilter</li>
<li>添加filter到输出数据源<code>GPUImageMovieWriter</code></li>
</ul>
<h5 id="4-为视频添加水印"><a href="#4-为视频添加水印" class="headerlink" title="(4) 为视频添加水印"></a>(4) 为视频添加水印</h5><p>核心代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">GPUImageView *filterView = [[GPUImageView alloc] initWithFrame:self.view.frame];</span><br><span class="line">self.view = filterView;</span><br><span class="line">// 混合滤镜初始化</span><br><span class="line">filter = [[GPUImageDissolveBlendFilter alloc] init];</span><br><span class="line">//混合度</span><br><span class="line">[(GPUImageDissolveBlendFilter *)filter setMix:0.5];</span><br><span class="line">// 本地视频播放源</span><br><span class="line">NSURL *sampleURL = [[NSBundle mainBundle] URLForResource:@&quot;IMG_4278&quot; withExtension:@&quot;MOV&quot;];</span><br><span class="line">AVAsset *asset = [AVAsset assetWithURL:sampleURL];</span><br><span class="line">CGSize size = self.view.bounds.size;</span><br><span class="line">//设置moive源头</span><br><span class="line">movieFile = [[GPUImageMovie alloc] initWithAsset:asset];</span><br><span class="line">movieFile.runBenchmark = YES;</span><br><span class="line">movieFile.playAtActualSpeed = YES;</span><br><span class="line">// 水印</span><br><span class="line">UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];</span><br><span class="line">label.text = @&quot;我是水印&quot;;</span><br><span class="line">label.font = [UIFont systemFontOfSize:30];</span><br><span class="line">label.textColor = [UIColor redColor];</span><br><span class="line">[label sizeToFit];</span><br><span class="line">UIImage *image = [UIImage imageNamed:@&quot;watermark.png&quot;];</span><br><span class="line">UIImageView *imageView = [[UIImageView alloc] initWithImage:image];</span><br><span class="line">UIView *subView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, size.width, size.height)];</span><br><span class="line">subView.backgroundColor = [UIColor clearColor];</span><br><span class="line">imageView.center = CGPointMake(subView.bounds.size.width / 2, subView.bounds.size.height / 2);</span><br><span class="line">[subView addSubview:imageView];</span><br><span class="line">[subView addSubview:label];</span><br><span class="line">//设置UI源头</span><br><span class="line">GPUImageUIElement *uielement = [[GPUImageUIElement alloc] initWithView:subView];</span><br><span class="line">//GPUImageTransformFilter 动画的filter</span><br><span class="line">NSString *pathToMovie = [NSHomeDirectory() stringByAppendingPathComponent:@&quot;Documents/Movie.m4v&quot;];</span><br><span class="line">unlink([pathToMovie UTF8String]);</span><br><span class="line">NSURL *movieURL = [NSURL fileURLWithPath:pathToMovie];</span><br><span class="line">//初始化接受者</span><br><span class="line">movieWriter = [[GPUImageMovieWriter alloc] initWithMovieURL:movieURL size:CGSizeMake(480.0, 640.0)];</span><br><span class="line">//为调整视频方向添加一个空白滤镜</span><br><span class="line">GPUImageFilter* progressFilter = [[GPUImageFilter alloc] init];</span><br><span class="line">[movieFile addTarget:progressFilter];</span><br><span class="line">//设置方向</span><br><span class="line">[progressFilter setInputRotation:kGPUImageRotateRight atIndex:0];</span><br><span class="line"></span><br><span class="line">[progressFilter addTarget:filter];</span><br><span class="line">[uielement addTarget:filter];</span><br><span class="line">movieWriter.shouldPassthroughAudio = YES;</span><br><span class="line">movieFile.audioEncodingTarget = movieWriter;</span><br><span class="line">[movieFile enableSynchronizedEncodingUsingMovieWriter:movieWriter];</span><br><span class="line"> // 显示到界面</span><br><span class="line">[filter addTarget:filterView];</span><br><span class="line">[filter addTarget:movieWriter];</span><br><span class="line">//开始记录</span><br><span class="line">[movieWriter startRecording];</span><br><span class="line">[movieFile startProcessing];</span><br><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">//每一帧处理完成 大约30帧/秒</span><br><span class="line">[progressFilter setFrameProcessingCompletionBlock:^(GPUImageOutput *output, CMTime time)&#123;</span><br><span class="line">    CGRect frame = imageView.frame;</span><br><span class="line">    frame.origin.x += 1;</span><br><span class="line">    frame.origin.y += 1;</span><br><span class="line">    imageView.frame = frame;</span><br><span class="line">    //更新UIElement</span><br><span class="line">    [uielement updateWithTimestamp:time];</span><br><span class="line">&#125;];</span><br><span class="line">[movieWriter setCompletionBlock:^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = weakSelf;</span><br><span class="line">    [strongSelf-&gt;filter removeTarget:strongSelf-&gt;movieWriter];</span><br><span class="line">    [strongSelf-&gt;movieWriter finishRecording];</span><br><span class="line">      /*根据movieURL保存视频到本地*/</span><br><span class="line">     // ... </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h6 id="流程说明：-2"><a href="#流程说明：-2" class="headerlink" title="流程说明："></a>流程说明：</h6><ul>
<li>混合滤镜的核心是<code>GPUImageDissolveBlendFilter</code>的使用，它继承自<code>GPUImageTwoInputFilter</code>,它需要有两个输入源</li>
<li>初始化两个输入源<code>GPUImageVideoCamera</code>跟<code>GPUImageUIElement</code></li>
<li>其他同上</li>
</ul>
<h5 id="5-滤镜组的使用"><a href="#5-滤镜组的使用" class="headerlink" title="(5) 滤镜组的使用"></a>(5) 滤镜组的使用</h5><p>核心代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//创建摄像头视图</span><br><span class="line">GPUImageView *filterView = [[GPUImageView alloc]initWithFrame:self.view.bounds];</span><br><span class="line">//显示模式充满整个边框</span><br><span class="line">filterView.fillMode = kGPUImageFillModePreserveAspectRatioAndFill;</span><br><span class="line">[self.view addSubview:filterView];</span><br><span class="line">//初始化滤镜源</span><br><span class="line">self.stillCamera = [[GPUImageStillCamera alloc]initWithSessionPreset:AVCaptureSessionPresetPhoto cameraPosition:AVCaptureDevicePositionBack];</span><br><span class="line">//输出图像旋转方式</span><br><span class="line">self.stillCamera.outputImageOrientation = UIInterfaceOrientationPortrait;</span><br><span class="line">//反色滤镜</span><br><span class="line">GPUImageColorInvertFilter *filter1 = [[GPUImageColorInvertFilter alloc]init];</span><br><span class="line">//浮雕滤镜</span><br><span class="line">GPUImageEmbossFilter *filter2 = [[GPUImageEmbossFilter alloc]init];</span><br><span class="line">//GPUImageToonFilter *filter3 = [[GPUImageToonFilter alloc] init];</span><br><span class="line">GPUImageFilterGroup *groupFilter = [[GPUImageFilterGroup alloc]init];</span><br><span class="line">[groupFilter addFilter:filter1];</span><br><span class="line">[groupFilter addFilter:filter2];</span><br><span class="line">//[groupFilter addFilter:filter3];</span><br><span class="line">[filter1 addTarget:filter2];</span><br><span class="line">//[filter2 addTarget:filter3];</span><br><span class="line">//定义了一个变量来保存filter-chain上的最后一个filter,后面保存图片时调用的方法里要用到。</span><br><span class="line">self.lastFilter = filter2;</span><br><span class="line">//设置第一个滤镜</span><br><span class="line">groupFilter.initialFilters = @[filter1];</span><br><span class="line">//设置最后一个滤镜</span><br><span class="line">groupFilter.terminalFilter = filter2;</span><br><span class="line">[self.stillCamera addTarget:groupFilter];</span><br><span class="line">[groupFilter addTarget:filterView];</span><br><span class="line">//解决第一帧黑屏,音频缓冲区是在视频缓冲区之前写入的。</span><br><span class="line">[self.stillCamera addAudioInputsAndOutputs];</span><br><span class="line">[self.view bringSubviewToFront:self.catchBtn];</span><br><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    //开始捕捉</span><br><span class="line">    [self.stillCamera startCameraCapture];</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="流程说明：-3"><a href="#流程说明：-3" class="headerlink" title="流程说明："></a>流程说明：</h6><ul>
<li>混合滤的核心是<code>GPUImageFilterGroup</code>的使用</li>
<li>初始化多个滤镜并且添加到滤镜组</li>
<li>设置Group的第一个以及最后一个滤镜</li>
<li>输出</li>
</ul>
<h3 id="二-GPUImage-底层源码分析"><a href="#二-GPUImage-底层源码分析" class="headerlink" title="二. GPUImage 底层源码分析"></a>二. <code>GPUImage</code> 底层源码分析</h3><h4 id="1-滤镜链加载流程分析"><a href="#1-滤镜链加载流程分析" class="headerlink" title="1.滤镜链加载流程分析"></a>1.滤镜链加载流程分析</h4><p>通过上面的Demo例子我们能够分析滤镜链的使用流程：</p>
<p><img src="https://i.loli.net/2021/04/19/eZsjc9pNyTGOlzW.png" alt="GPUImageFilter流"></p>
<p>接下来我们以图片添加滤镜的例子分析GPUImage的滤镜方法调用流程：</p>
<ul>
<li>使用图片初始化滤镜源头<code>GPUImagePicture</code>,调用方法：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithImage:(UIImage *)newImageSource;</span><br></pre></td></tr></table></figure>
这个方法里面又会调用<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">outputFramebuffer = [[GPUImageContext sharedFramebufferCache] fetchFramebufferForSize:pixelSizeToUseForTexture onlyTexture:YES];</span><br></pre></td></tr></table></figure>
这个方法最主要的作用是根据图片的大小去<code>GPUImageFramebufferCache</code>中去获取一块 FrameBuffer,也就是<code>outputFramebuffer</code></li>
<li>滤镜的初始化，根据当前自己的顶点着色器以及片元着色器初始化滤镜，以及创建OPenGL ES的渲染程序 <code>GLProgram</code></li>
<li>为滤镜源添加Target：<code>- (void)addTarget:(id&lt;GPUImageInput&gt;)newTarget;</code>. 在这个方法里面会调用<br><code>[self setInputFramebufferForTarget:newTarget atIndex:textureLocation];</code><br>最终会调用<code>[target setInputFramebuffer:[self framebufferForOutput] atIndex:inputTextureIndex];</code>方法.这个方法最主要的作用是把当前Output的输出 Framebuffer 传递给接受者.</li>
<li><code>- (void)useNextFrameForImageCapture;</code>设置成员变量<code>usingNextFrameForImageCapture = YES</code>代表着输出的结果会被用于获取图像,所以在渲染的核心方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)renderToTextureWithVertices:(const GLfloat *)vertices textureCoordinates:(const GLfloat *)textureCoordinates;</span><br></pre></td></tr></table></figure>
对<code>outputFramebuffer</code>加锁，因为默认情况下，当下一个input渲染完成之后，就会释放这个 FrameBuffer。如果你需要对当前的Filter的输出进行截图的话，则需要保留住这个 FrameBuffer。</li>
<li>接下来调用方法<code>[imagePic processImage];</code>: 开始进入滤镜处理流程，接着调用方法<code>-(BOOL)processImageWithCompletionHandler:(void (^)(void))completion;</code>在这个方法内部调用了Target的两个方法，进行OutputFrameBuffer的渲染与向下传递.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[currentTarget setInputFramebuffer:outputFramebuffer atIndex:textureIndexOfTarget];</span><br><span class="line">[currentTarget newFrameReadyAtTime:kCMTimeIndefinite atIndex:textureIndexOfTarget];</span><br></pre></td></tr></table></figure>
<p>第一个方法的作用是获取从上个Output传递过来的 Framebuffer，并进行加锁操作。<br><br>第二个方法的作用是利用自身<code>GLProgram</code>进行渲染，并且调用<code>- (void)informTargetsAboutNewFrameAtTime:(CMTime)frameTime;</code>把渲染结果向下一个实现<code>GPUImageInput</code>协议的滤镜传递。</p>
<ul>
<li><code>[gaussianBlur imageFromCurrentFramebuffer];</code> 方法：根据 Framebuffer 获取图片，里面调用<code>- (CGImageRef)newCGImageFromCurrentlyProcessedOutput</code> 方法，完成图片获取以及释放GCD信号量。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (dispatch_semaphore_wait(imageCaptureSemaphore, convertedTimeout) != 0)</span><br><span class="line">  &#123;</span><br><span class="line">        return NULL;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
这里信号量的作用是等待渲染完成。完成后走下面的获取图片流程。整个的方法调用流程可以参考下面的图片：</li>
</ul>
<p><img src="https://i.loli.net/2021/04/21/hu3EyHDFx8voZWq.png" alt="方法调用栈"></p>
<h4 id="2-滤镜渲染流程分析"><a href="#2-滤镜渲染流程分析" class="headerlink" title="2.滤镜渲染流程分析"></a>2.滤镜渲染流程分析</h4><p>渲染是整个<code>GPUImageFilter</code> 的核心，在初始化方法中完成了<code>OpenGL ES Program</code>的创建好并且link成功了之后，我们就可以使用这个Program进行渲染了。整个渲染的过程发生在<code>- (void)renderToTextureWithVertices:textureCoordinates:</code>中。我们也借着解析这个方法来了解一下<code>OpenGL ES</code>的渲染过程：</p>
<ul>
<li><code>[GPUImageContext setActiveShaderProgram:filterProgram];</code>: 将初始化后得到Progrm 上下文设置为默认的context，并且激活。调用的<code>GPUImageContext</code>方法<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (void)setActiveShaderProgram:(GLProgram *)shaderProgram;</span><br><span class="line">&#123;</span><br><span class="line">    GPUImageContext *sharedContext = [GPUImageContext sharedImageProcessingContext];</span><br><span class="line">    [sharedContext setContextShaderProgram:shaderProgram];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>获取一个待渲染的<code>GPUImageFrameBuffer</code>,这个FrameBuffer 会根据输入纹理的尺寸(inputTextureSize)以及纹理信息(outputTextureOptions) 去<code>GPUImageFrameBufferCahe</code>中获取。大致流程为：存在符合要求的Framebuffer就返回一个，没有就去创建。</li>
<li>根据<code>usingNextFrameForImageCapture</code>判断当前Framebuffer是否用于获取图片，如果是则进行加锁。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (usingNextFrameForImageCapture)</span><br><span class="line">   &#123; //将这个outputFrameBuffer进行lock。</span><br><span class="line">       [outputFramebuffer lock];</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li>将整个FrameBuffer的数据使用backgroundColor进行清空：<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glClearColor(backgroundColorRed, backgroundColorGreen, backgroundColorBlue, backgroundColorAlpha);</span><br><span class="line">glClear(GL_COLOR_BUFFER_BIT);</span><br></pre></td></tr></table></figure></li>
<li>将上一个Output传递过来的FrameBuffer作为texture用来渲染：<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">glActiveTexture(GL_TEXTURE2);</span><br><span class="line">glBindTexture(GL_TEXTURE_2D, [firstInputFramebuffer <span class="built_in">texture</span>]);</span><br><span class="line">glUniform1i(filterInputTextureUniform, <span class="number">2</span>);</span><br></pre></td></tr></table></figure></li>
<li>将顶点的位置信息以及顶点的纹理坐标信息作为attribute传递给GPU：<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">glVertexAttribPointer(filterPositionAttribute, <span class="number">2</span>, GL_FLOAT, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">vertices</span>);</span><br><span class="line">glVertexAttribPointer(filterTextureCoordinateAttribute, <span class="number">2</span>, GL_FLOAT, <span class="number">0</span>, <span class="number">0</span>, textureCoordinates);</span><br></pre></td></tr></table></figure></li>
<li>进行渲染：<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">glDrawArrays(GL_TRIANGLE_STRIP, <span class="number">0</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure></li>
<li>最后将上一个<code>GPUImageOutput</code>传递过来的FrameBuffer使命已经完成，对其进行解锁释放：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[firstInputFramebuffer unlock];</span><br></pre></td></tr></table></figure>
整个渲染过程完成。</li>
</ul>
<h3 id="三-自定义滤镜"><a href="#三-自定义滤镜" class="headerlink" title="三. 自定义滤镜"></a>三. 自定义滤镜</h3><h4 id="1-如何加载一个自定义滤镜"><a href="#1-如何加载一个自定义滤镜" class="headerlink" title="1.如何加载一个自定义滤镜"></a>1.如何加载一个自定义滤镜</h4><p>通过上面的学习我们知道，滤镜的效果实际是根据不同的顶点着色器以及片元着色器来实现的。是定义滤镜实际就是自定义这两种着色器。有两种方式来加载我们的自定义滤镜</p>
<ul>
<li>自定义滤镜类，继承自<code>GPUImageFilter</code>,然后用字符串常量形式加载我们的Shader代码例如：<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">NSString *<span class="keyword">const</span> kGPUImageBrightnessFragmentShaderString = SHADER_STRING</span><br><span class="line">(</span><br><span class="line"> <span class="keyword">varying</span> <span class="keyword">highp</span> <span class="type">vec2</span> textureCoordinate;</span><br><span class="line"> <span class="keyword">uniform</span> <span class="type">sampler2D</span> inputImageTexture;</span><br><span class="line"> <span class="keyword">uniform</span> <span class="keyword">lowp</span> <span class="type">float</span> brightness;</span><br><span class="line"> </span><br><span class="line"> <span class="type">void</span> main()</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">lowp</span> <span class="type">vec4</span> textureColor = <span class="built_in">texture2D</span>(inputImageTexture, textureCoordinate);</span><br><span class="line">     <span class="built_in">gl_FragColor</span> = <span class="type">vec4</span>((textureColor.rgb + <span class="type">vec3</span>(brightness)), textureColor.w);</span><br><span class="line"> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
然后根据<code>GPUImageFilter</code>提供的初始化方法进行加载。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithVertexShaderFromString:(NSString *)vertexShaderString fragmentShaderFromString:(NSString *)fragmentShaderString;</span><br><span class="line">- (id)initWithFragmentShaderFromString:(NSString *)fragmentShaderString;</span><br><span class="line">- (id)initWithFragmentShaderFromFile:(NSString *)fragmentShaderFilename;</span><br></pre></td></tr></table></figure></li>
<li>另一种方式:如果只是自定义<code>FragmentShader</code>，可以是将Shader语句封装为fsh结尾的文件，然后调用下面方法进行加载<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (id)initWithFragmentShaderFromFile:(NSString *)fragmentShaderFilename;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-一些特殊的自定义滤镜效果"><a href="#2-一些特殊的自定义滤镜效果" class="headerlink" title="2. 一些特殊的自定义滤镜效果"></a>2. 一些特殊的自定义滤镜效果</h4><p><img src="https://i.loli.net/2021/04/25/EFdt6xioV8rGTbw.gif" alt="自定义滤镜"><br><br>一些特殊的滤镜效果,比如抖音的滤镜效果（闪白、灵魂出窍、抖动、缩放、毛刺、眩晕等）可以查看我的<a target="_blank" rel="noopener" href="https://github.com/chenXming/GPUIamage_demo.git">GitHub</a>.<br>关于自定义滤镜部分需要你对<code>OPenGL ES</code>、线性代数以及算法有基础的了解，并且熟悉<code>GLSL着色语言</code>,如果想进一步学习可以参考GLSL的官方快速入门指导<a target="_blank" rel="noopener" href="https://www.khronos.org/opengles/sdk/docs/reference_cards/OpenGL-ES-2_0-Reference-card.pdf">OpenGL ES</a>,我们这篇文章不在涉及。</p>
<h3 id="四-总结"><a href="#四-总结" class="headerlink" title="四. 总结"></a>四. 总结</h3><p>这篇文章主要是介绍了<code>GPUImage</code>的使用、滤镜链加载流程、渲染逻辑，还有一些模块未涉及到，比如<code>GLProgram</code>的创建、link过程,<code>GPUImageMovieComposition</code>视频编辑模块，滤镜的自定义流程等，需要感兴趣的同学自己探究。</p>
<h4 id="1-进一步学习需要掌握的内容"><a href="#1-进一步学习需要掌握的内容" class="headerlink" title="1.进一步学习需要掌握的内容"></a>1.进一步学习需要掌握的内容</h4><p><a target="_blank" rel="noopener" href="http://www.amazon.com/OpenGL-Shading-Language-Randi-Rost/dp/0321637631/ref=sr_1_1?s=books&ie=UTF8&qid=1422896457&sr=1-1&keywords=opengl+shading+language">The OpenGL Shading Language</a><br><br><a target="_blank" rel="noopener" href="http://www.shaderific.com/glsl-functions">GLSL内建的函数介绍</a></p>
<h4 id="2-一些参考引用"><a href="#2-一些参考引用" class="headerlink" title="2.一些参考引用"></a>2.一些参考引用</h4><p><a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage">https://github.com/BradLarson/GPUImage</a><br><br><a target="_blank" rel="noopener" href="https://www.khronos.org/opengles/sdk/docs/reference_cards/OpenGL-ES-2_0-Reference-card.pdf">https://www.khronos.org/opengles/sdk/docs/reference_cards/OpenGL-ES-2_0-Reference-card.pdf</a><br><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/8367278ff6cf">https://www.jianshu.com/u/8367278ff6cf</a><br></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chenxming.github.io/2021/04/25/iOS%E6%BB%A4%E9%95%9C%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" data-id="cllniud800008xbexf3niey2v" data-title="iOS-滤镜那些事儿" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">八月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">五月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">四月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/16/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%8F%91%E4%B8%80%E6%AC%BEChatGPT%20VSCode%E6%8F%92%E4%BB%B6/">(no title)</a>
          </li>
        
          <li>
            <a href="/2023/05/26/%E6%B5%85%E8%B0%88Vue3%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86%E4%B8%8E%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">浅谈Vue3响应式原理与源码解读</a>
          </li>
        
          <li>
            <a href="/2023/04/01/setState%E4%B8%8EuseState%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E9%A1%B9/">setState与useState使用注意项</a>
          </li>
        
          <li>
            <a href="/2023/02/06/%E4%BD%BF%E7%94%A8useReducer%20+%20useContext%20%E4%BB%A3%E6%9B%BF%20react-redux/">使用useReducer + useContext 代替 react-redux</a>
          </li>
        
          <li>
            <a href="/2022/11/15/GitHub%20Actions%20%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%20Vue%20%E9%A1%B9%E7%9B%AE/">GitHub Actions 自动部署前端 Vue 项目</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 chenXming<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>